<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>六合彩數據分析系統 - 進階版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tab-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-button {
            flex: 1;
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            padding: 30px;
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* 結果表格 */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .results-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .results-table tr:hover {
            background-color: #f8f9fa;
        }

        .number-ball {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            line-height: 35px;
            margin: 2px;
            font-weight: bold;
            text-align: center;
        }

        .extra-number-ball {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        /* 統計控制 */
        .stats-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .range-selection {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 600px;
        }

        .range-title {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .range-inputs {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .input-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
        }

        .period-input {
            width: 100px;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .period-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .range-separator {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            margin: 0 10px;
        }

        .quick-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .apply-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .apply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .apply-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .range-info {
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        /* 統計網格 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .number-stat {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .number-stat:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
            padding-bottom: 10px;
        }

        .stat-number {
            font-size: 1.7rem;
            font-weight: bold;
            color: #333;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-info {
            text-align: right;
        }

        .stat-frequency {
            font-size: 1.2rem;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-rank {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
        }

        /* 共現分析區域 */
        .co-occurrence {
            margin-top: 15px;
        }

        .co-occurrence-title {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .co-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .co-number {
            display: inline-flex;
            align-items: center;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 4px 8px;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .co-number:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .co-number-ball {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            margin-right: 6px;
        }

        .co-frequency {
            color: #666;
            font-weight: 500;
        }

        /* 統計顏色等級 */
        .rank-1 { background: #dc3545; }
        .rank-2 { background: #fd7e14; }
        .rank-3 { background: #ffc107; }
        .rank-4 { background: #20c997; }
        .rank-5 { background: #6f42c1; }
        .rank-6 { background: #e83e8c; }
        .rank-7 { background: #6c757d; }

        /* 響應式設計 */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
                max-width: 100%;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tab-button {
                padding: 12px 15px;
                font-size: 1rem;
            }

            .tab-content {
                padding: 15px 5px;
            }

            .results-table {
                font-size: 0.9rem;
            }

            .results-table th,
            .results-table td {
                padding: 8px 5px;
            }

            .number-ball {
                width: 30px;
                height: 30px;
                line-height: 30px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin: 0;
            }

            .number-stat {
                padding: 25px;
                margin: 0 3px;
                border-radius: 15px;
            }

            .stat-header {
                margin-bottom: 20px;
                padding-bottom: 15px;
            }

            .stat-number {
                width: 40px;
                height: 40px;
                font-size: 1.8rem;
            }

            .stat-info {
                flex: 1;
                margin-left: 15px;
            }

            .stat-frequency {
                font-size: 1.3rem;
                margin-bottom: 8px;
            }

            .stat-rank {
                font-size: 1rem;
                padding: 6px 12px;
            }

            .co-occurrence-title {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }

            .co-numbers {
                gap: 10px;
            }

            .co-number {
                font-size: 1rem;
                padding: 8px 12px;
                border-radius: 25px;
            }

            .co-number-ball {
                width: 24px;
                height: 24px;
                font-size: 0.9rem;
                margin-right: 8px;
            }

            .range-inputs {
                flex-direction: column;
                gap: 15px;
            }

            .quick-select {
                gap: 8px;
            }

            .quick-btn {
                padding: 8px 14px;
                font-size: 0.9rem;
            }

            .apply-btn {
                padding: 10px 25px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 2px;
            }

            .tab-content {
                padding: 10px 2px;
            }

            .results-table {
                font-size: 0.8rem;
            }

            .number-ball {
                width: 22px;
                height: 22px;
                line-height: 22px;
                font-size: 0.8rem;
                margin: 1px;
            }

            .stats-grid {
                gap: 12px;
            }

            .number-stat {
                padding: 30px 20px;
                margin: 0 1px;
                border-radius: 18px;
            }

            .stat-header {
                margin-bottom: 25px;
                padding-bottom: 20px;
            }

            .stat-number {
                width: 55px;
                height: 55px;
                font-size: 2rem;
            }

            .stat-frequency {
                font-size: 1.4rem;
                margin-bottom: 10px;
            }

            .stat-rank {
                font-size: 1.1rem;
                padding: 8px 15px;
            }

            .co-occurrence-title {
                font-size: 1.2rem;
                margin-bottom: 18px;
            }

            .co-numbers {
                gap: 12px;
            }

            .co-number {
                font-size: 1.1rem;
                padding: 10px 15px;
                border-radius: 30px;
            }

            .co-number-ball {
                width: 26px;
                height: 26px;
                font-size: 1rem;
                margin-right: 10px;
            }

            .stats-controls {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .range-inputs {
                flex-direction: column;
                gap: 12px;
            }

            .period-input {
                width: 120px;
                padding: 12px;
                font-size: 1.1rem;
            }

            .quick-btn {
                padding: 10px 16px;
                font-size: 1rem;
            }

            .apply-btn {
                padding: 14px 28px;
                font-size: 1.1rem;
            }

            /* 號碼選擇響應式 */
            .number-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
                max-width: 350px;
            }

            .number-cell {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }

            .selection-controls {
                flex-direction: column;
                gap: 10px;
            }

            .control-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .quick-options {
                gap: 8px;
            }

            .quick-option-btn {
                padding: 10px 14px;
                font-size: 0.9rem;
            }

            .calculation-controls {
                flex-direction: column;
                gap: 15px;
            }

            .calculate-btn, .analysis-btn {
                padding: 14px 30px;
                font-size: 1rem;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 95%;
            }

            /* 膽腳投注響應式 */
            .betting-mode-tabs {
                max-width: 250px;
            }

            .mode-tab {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .banker-selection-status {
                flex-direction: column;
                gap: 10px;
            }

            .section-title {
                font-size: 1rem;
            }

            .banker-section, .runner-section {
                margin-bottom: 20px;
            }
        }

        /* 號碼選擇介面樣式 */
        .number-selection-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* 投注模式切換標籤 */
        .betting-mode-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            background: #e9ecef;
            border-radius: 25px;
            padding: 5px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-tab {
            flex: 1;
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .mode-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .mode-tab:hover:not(.active) {
            color: #495057;
            background: rgba(255,255,255,0.5);
        }

        /* 投注模式內容 */
        .betting-mode-content {
            width: 100%;
        }

        /* 膽腳投注樣式 */
        .banker-selection-status {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
            font-weight: 600;
            color: #333;
        }

        .banker-section, .runner-section {
            margin-bottom: 25px;
        }

        .section-title {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .banker-grid .number-cell {
            border-color: #dc3545;
        }

        .banker-grid .number-cell:hover {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .banker-grid .number-cell.selected {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border-color: #dc3545;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        .runner-grid .number-cell {
            border-color: #28a745;
        }

        .runner-grid .number-cell:hover {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }

        .runner-grid .number-cell.selected {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-color: #28a745;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .runner-grid .number-cell.disabled {
            background: #f8f9fa;
            color: #6c757d;
            border-color: #dee2e6;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .selection-status {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            font-weight: 600;
            color: #333;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .number-cell {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #333;
        }

        .number-cell:hover {
            border-color: #007bff;
            transform: scale(1.05);
        }

        .number-cell.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .selection-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .quick-selection {
            text-align: center;
        }

        .quick-selection h4 {
            color: #666;
            margin-bottom: 15px;
        }

        .quick-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-option-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-option-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(116, 185, 255, 0.4);
        }

        .verification-controls {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .verification-controls .range-selection {
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .calculation-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .calculate-btn {
            padding: 15px 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analysis-btn {
            padding: 15px 35px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculate-btn:hover, .analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* 彈窗樣式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .loading {
            text-align: center;
            padding: 14px;
            color: #666;
            font-size: 1.2rem;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #ff4757;
            font-size: 1.2rem;
        }

        /* 江恩螺旋四方圖樣式 */
        .gann-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .gann-cell {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .gann-cell:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
            z-index: 10;
        }

        .gann-cell.highlight {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.5);
            animation: pulse 2s infinite;
        }

        .gann-cell.highlight:hover {
            transform: scale(1.15) translateY(-3px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.7);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(240, 147, 251, 0.5);
            }
            50% {
                box-shadow: 0 6px 20px rgba(240, 147, 251, 0.8);
            }
        }

        /* 江恩圖期數選擇器樣式增強 */
        #gann-period-select:hover {
            border-color: #764ba2;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        #gann-period-select:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .gann-cell {
                width: 45px;
                height: 45px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .gann-cell {
                width: 38px;
                height: 38px;
                font-size: 12px;
            }
            
            .gann-grid {
                gap: 5px;
                padding: 10px;
            }
        }

        /* ========== 高頻號碼篩選結果區域樣式 ========== */
        .high-frequency-result {
            margin-top: 20px;
            display: none;
        }

        .hf-flex-container {
            display: flex;
            gap: 20px;
        }

        .hf-panel {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .hf-panel-title {
            color: #333;
            margin-bottom: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .hf-filter-info {
            margin-bottom: 15px;
        }

        .hf-highlight-text {
            color: #667eea;
        }

        .hf-highlight-bold {
            color: #667eea;
            font-weight: bold;
            margin-left: 5px;
        }

        .hf-result-box {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .hf-result-box-green {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }

        .hf-result-box-purple {
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #764ba2;
        }

        .hf-numbers-display {
            margin-top: 8px;
            font-size: 16px;
            color: #333;
            line-height: 1.8;
        }

        .hf-probability-info {
            margin-top: 10px;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.6;
        }

        .hf-random-numbers {
            margin-top: 8px;
            font-size: 18px;
            font-weight: bold;
            color: #764ba2;
        }

        .hf-refresh-btn {
            margin-top: 10px;
            padding: 5px 15px;
            background: #764ba2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .hf-refresh-btn:hover {
            background: #5a3d7a;
            transform: translateY(-1px);
        }

        /* 抽號模式樣式 */
        .hf-draw-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px dashed rgba(118, 75, 162, 0.3);
        }

        .draw-mode-select-sm {
            padding: 5px 10px;
            border: 1px solid #764ba2;
            border-radius: 5px;
            font-size: 0.85rem;
            color: #333;
            background: white;
            cursor: pointer;
        }

        .draw-mode-select-sm:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(118, 75, 162, 0.2);
        }

        .draw-mode-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .draw-mode-option label {
            font-size: 0.85rem;
            color: #555;
        }

        .complex-count-select-sm {
            padding: 5px 8px;
            border: 1px solid #e83e8c;
            border-radius: 5px;
            font-size: 0.85rem;
            color: #333;
            background: white;
            cursor: pointer;
        }

        .complex-count-select-sm:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(232, 62, 140, 0.2);
        }

        .core-checkbox-label {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            font-weight: 500;
            color: #764ba2;
        }

        .core-checkbox-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #764ba2;
        }

        .random-bet-label {
            color: #28a745;
            margin-left: 10px;
            padding-left: 10px;
            border-left: 1px solid #ddd;
        }

        .random-bet-label input[type="checkbox"] {
            accent-color: #28a745;
        }

        /* 隨機注數顯示區域 */
        .random-bet-section {
            margin-top: 12px;
            padding: 10px;
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(32, 201, 151, 0.1));
            border-radius: 8px;
            border-left: 3px solid #28a745;
        }

        .random-bet-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #28a745;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .random-bet-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .hf-ball--random {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            font-weight: bold;
        }

        .smart-core-select-sm {
            padding: 5px 8px;
            border: 1px solid #fd7e14;
            border-radius: 5px;
            font-size: 0.85rem;
            color: #333;
            background: white;
            cursor: pointer;
        }

        .smart-core-select-sm:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(253, 126, 20, 0.2);
        }

        .hf-draw-result-label {
            margin-bottom: 8px;
        }

        /* 5膽拖全餐樣式 */
        .five-banker-info {
            margin-top: 12px;
            padding: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .five-banker-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .five-banker-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .five-banker-stats {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #dee2e6;
        }

        .five-banker-bets-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .five-banker-bet-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 6px;
        }

        .five-banker-bet-label {
            font-weight: bold;
            font-size: 0.85rem;
            color: #495057;
            min-width: 50px;
        }

        .five-banker-bet-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        /* 歷史記錄中的5膽拖全餐樣式 */
        .hf-history-five-banker {
            width: 100%;
        }

        /* 聰明組合多注顯示 */
        .smart-bets-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .smart-bet-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: rgba(118, 75, 162, 0.05);
            border-radius: 6px;
            border-left: 3px solid #764ba2;
        }

        .smart-bet-row.has-remainder {
            border-left-color: #fd7e14;
            background: rgba(253, 126, 20, 0.05);
        }

        .smart-bet-label {
            font-weight: bold;
            font-size: 0.85rem;
            color: #764ba2;
            min-width: 50px;
        }

        .smart-bet-row.has-remainder .smart-bet-label {
            color: #fd7e14;
        }
        
        .smart-bet-row.extra-random {
            border-left-color: #e83e8c;
            background: rgba(232, 62, 140, 0.08);
        }
        
        .smart-bet-row.extra-random .smart-bet-label {
            color: #e83e8c;
        }

        .smart-bet-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .hf-ball--core {
            background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%) !important;
            box-shadow: 0 2px 8px rgba(253, 126, 20, 0.4);
        }

        .hf-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .hf-history-title {
            color: #333;
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .hf-clear-btn {
            padding: 3px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .hf-clear-btn:hover {
            background: #c82333;
        }

        .hf-history-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .hf-empty-message {
            color: #999;
            text-align: center;
            padding: 20px;
        }

        .hf-highlight-box {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .hf-highlight-header {
            color: white;
            margin: 0 0 12px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
        }

        .hf-highlight-icon {
            font-size: 20px;
            margin-right: 8px;
        }

        .hf-highlight-content {
            min-height: 60px;
            background: rgba(255,255,255,0.95);
            border-radius: 6px;
            padding: 12px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .hf-highlight-footer {
            margin-top: 8px;
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            text-align: center;
        }

        /* 江恩圖區域樣式 */
        .gann-container {
            text-align: center;
            margin: 30px auto;
            max-width: 800px;
        }

        .gann-description {
            color: #666;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .gann-selector-box {
            margin-bottom: 25px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .gann-selector-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .gann-selector-label {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .gann-period-select {
            padding: 10px 20px;
            font-size: 16px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #333;
            cursor: pointer;
            min-width: 200px;
            outline: none;
            transition: all 0.3s ease;
        }

        .gann-period-select:hover {
            border-color: #764ba2;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .gann-period-select:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .gann-selected-info {
            margin-top: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            display: none;
        }

        .gann-info-label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .gann-selected-numbers {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .gann-grid-wrapper {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .gann-info-box {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: left;
        }

        .gann-info-title {
            color: #333;
            margin-bottom: 15px;
        }

        .gann-info-list {
            color: #666;
            line-height: 1.8;
        }

        .gann-highlight-color {
            color: #f5576c;
        }

        /* 其他區域樣式 */
        .section-heading {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-summary {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
        }

        /* 篩選按鈕樣式 */
        .filter-btn {
            margin-top: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* 下10期按鈕樣式 */
        .next-period-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .next-period-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(238, 90, 36, 0.3);
        }

        /* 高頻號碼篩選模式選擇器樣式（緊湊內聯版） */
        .hf-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .hf-mode-inline {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-mode-select-sm {
            padding: 5px 10px;
            border: 1px solid #667eea;
            border-radius: 5px;
            font-size: 0.85rem;
            color: #333;
            background: white;
            cursor: pointer;
        }

        .filter-mode-select-sm:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .filter-count-select-sm {
            padding: 5px 8px;
            border: 1px solid #20c997;
            border-radius: 5px;
            font-size: 0.85rem;
            color: #333;
            background: white;
            cursor: pointer;
        }

        .filter-count-select-sm:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(32, 201, 151, 0.2);
        }

        /* 排名+搭配模式顯示樣式 */
        .hf-pairing-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .hf-pairing-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .hf-pairing-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
        }

        .hf-pairing-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .hf-pairing-rank {
            font-size: 0.85rem;
            font-weight: 600;
            color: #667eea;
            min-width: 50px;
        }

        .hf-pairing-arrow {
            color: #20c997;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .hf-pairing-no-pair {
            font-size: 0.8rem;
            color: #999;
            font-style: italic;
        }

        .hf-pairing-summary {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .hf-pairing-summary strong {
            display: block;
            margin-bottom: 10px;
            color: #333;
        }

        /* 派彩獎金彈窗樣式 */
        .winnings-section {
            margin-bottom: 25px;
        }

        .winnings-section-title {
            color: #333;
            margin-bottom: 15px;
        }

        .winnings-info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .winnings-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .winnings-table-header {
            background: #007bff;
            color: white;
        }

        .winnings-table th {
            padding: 12px;
        }

        .winnings-table th:first-child,
        .winnings-table th:nth-child(2) {
            text-align: left;
        }

        .winnings-table th:nth-child(3) {
            text-align: center;
        }

        .winnings-table th:nth-child(4),
        .winnings-table th:nth-child(5) {
            text-align: right;
        }

        .winnings-row-highlight {
            background-color: #e8f5e8;
        }

        .winnings-cell-bold {
            font-weight: 600;
        }

        .winnings-cell-success {
            color: #28a745;
            font-weight: bold;
        }

        .winnings-cell-muted {
            color: #6c757d;
            font-weight: bold;
        }

        .winnings-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .winnings-summary-title {
            margin-bottom: 15px;
        }

        .winnings-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .winnings-summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .winnings-summary-value {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .winnings-summary-positive {
            color: #90EE90;
        }

        .winnings-summary-negative {
            color: #FFB6C1;
        }

        .winnings-summary-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .winnings-summary-note {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* 號碼球變體 */
        .number-ball-banker {
            margin: 2px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .number-ball-runner {
            margin: 2px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .number-ball-margin {
            margin: 2px;
        }

        /* 統計摘要區域 */
        .stats-intro {
            text-align: center;
            margin-bottom: 30px;
        }

        .stats-intro-text {
            color: #666;
            font-size: 1.1rem;
        }

        .stats-highlight-box {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stats-highlight-primary {
            color: #007bff;
            font-weight: bold;
        }

        .stats-highlight-success {
            color: #28a745;
            font-weight: bold;
        }

        .stats-cards-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stats-card {
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 120px;
        }

        .stats-card-first {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .stats-card-second {
            background: linear-gradient(135deg, #fd7e14 0%, #e55a00 100%);
        }

        .stats-card-third {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .stats-card-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .stats-card-label {
            font-size: 0.9rem;
        }

        .margin-bottom-10 {
            margin-bottom: 10px;
        }

        /* 統計卡片擴展樣式 */
        .stats-card-fourth,
        .stats-card-fifth,
        .stats-card-sixth,
        .stats-card-seventh {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .stats-card-total {
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
        }

        /* 表格結果顏色 */
        .result-first-prize {
            color: #dc3545;
            font-weight: bold;
        }

        .result-second-prize {
            color: #fd7e14;
            font-weight: bold;
        }

        .result-other-prize {
            color: #ffc107;
            font-weight: bold;
        }

        .result-no-prize {
            color: #6c757d;
            font-weight: bold;
        }

        /* 核對統計區域樣式 */
        .verification-intro {
            text-align: center;
            margin-bottom: 30px;
        }

        .verification-text {
            color: #666;
            font-size: 1.1rem;
        }

        .verification-details {
            margin: 15px 0;
            color: #666;
        }

        .profit-positive {
            color: #28a745;
            font-weight: bold;
        }

        .profit-negative {
            color: #dc3545;
            font-weight: bold;
        }

        /* 統計摘要網格 - 七獎擴展 */
        .stats-grid-compact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
        }

        .stat-card-compact {
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card-compact-first {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .stat-card-compact-second {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        }

        .stat-card-compact-third {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
        }

        .stat-card-compact-fourth {
            background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
        }

        .stat-card-compact-fifth {
            background: linear-gradient(135deg, #26c6da 0%, #00acc1 100%);
        }

        .stat-card-compact-sixth {
            background: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
        }

        .stat-card-compact-seventh {
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
        }

        .stat-card-value-lg {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card-label-sm {
            font-size: 0.8rem;
        }

        /* 結果表格單元格顏色 */
        .result-prize-first-alt {
            color: #ff4757;
            font-weight: bold;
        }

        .result-prize-second-alt {
            color: #ffa502;
            font-weight: bold;
        }

        .result-prize-third-alt {
            color: #3742fa;
            font-weight: bold;
        }

        .result-prize-fourth-alt {
            color: #8e44ad;
            font-weight: bold;
        }

        .result-prize-fifth-alt {
            color: #00cec9;
            font-weight: bold;
        }

        .result-prize-sixth-alt {
            color: #ffc107;
            font-weight: bold;
        }

        .result-prize-seventh-alt {
            color: #2ecc71;
            font-weight: bold;
        }

        /* 響應式設計 - 統計網格 */
        @media (max-width: 768px) {
            .stats-grid-compact {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 8px;
            }

            .stat-card-compact {
                padding: 12px 10px;
            }

            .stat-card-value-lg {
                font-size: 1.3rem;
            }

            .stat-card-label-sm {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid-compact {
                grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
                gap: 6px;
            }

            .stat-card-compact {
                padding: 10px 8px;
                border-radius: 8px;
            }

            .stat-card-value-lg {
                font-size: 1.1rem;
            }

            .stat-card-label-sm {
                font-size: 0.7rem;
            }
        }

        /* ========== 響應式設計 - 高頻號碼區域 ========== */
        @media (max-width: 1024px) {
            .hf-flex-container {
                flex-direction: column;
            }

            .hf-panel {
                width: 100%;
            }

            .gann-selector-inner {
                flex-direction: column;
                gap: 10px;
            }

            .gann-period-select {
                width: 100%;
                max-width: 300px;
            }
        }

        @media (max-width: 768px) {
            .hf-flex-container {
                gap: 15px;
            }

            .hf-panel {
                padding: 12px;
            }

            .hf-panel-title {
                font-size: 0.95rem;
            }

            .hf-numbers-display {
                font-size: 14px;
            }

            .hf-random-numbers {
                font-size: 16px;
            }

            .hf-highlight-box {
                padding: 12px;
            }

            .hf-highlight-header {
                font-size: 14px;
            }

            .hf-highlight-content {
                padding: 10px;
                gap: 6px;
            }

            .gann-container {
                margin: 20px auto;
                padding: 0 10px;
            }

            .gann-description {
                font-size: 14px;
            }

            .gann-selector-box {
                padding: 15px;
            }

            .gann-grid-wrapper {
                padding: 15px;
            }

            .gann-info-box {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .high-frequency-result {
                margin-top: 15px;
            }

            .hf-flex-container {
                gap: 12px;
            }

            .hf-panel {
                padding: 10px;
                border-radius: 6px;
            }

            .hf-panel-title {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .hf-result-box,
            .hf-result-box-green,
            .hf-result-box-purple {
                padding: 8px;
                margin-bottom: 10px;
            }

            .hf-numbers-display {
                font-size: 13px;
                line-height: 1.6;
            }

            .hf-probability-info {
                font-size: 12px;
                padding: 6px;
            }

            .hf-random-numbers {
                font-size: 15px;
            }

            .hf-refresh-btn {
                padding: 8px 16px;
                font-size: 13px;
            }

            .hf-history-list {
                max-height: 300px;
            }

            .hf-highlight-box {
                padding: 10px;
                margin-top: 12px;
            }

            .hf-highlight-header {
                font-size: 13px;
                margin-bottom: 8px;
            }

            .hf-highlight-icon {
                font-size: 16px;
            }

            .hf-highlight-content {
                min-height: 50px;
                padding: 8px;
            }

            .hf-highlight-footer {
                font-size: 10px;
            }

            .gann-container {
                margin: 15px auto;
            }

            .gann-selector-box {
                padding: 12px;
            }

            .gann-period-select {
                padding: 8px 15px;
                font-size: 14px;
            }

            .gann-grid-wrapper {
                padding: 10px;
                border-radius: 10px;
            }

            .gann-info-box {
                padding: 12px;
            }

            .gann-info-list {
                font-size: 14px;
                line-height: 1.6;
            }
        }

        /* ========== 動態生成元素的CSS Classes ========== */
        
        /* 號碼球基礎樣式 */
        .hf-ball {
            display: inline-block;
            text-align: center;
            color: white;
            border-radius: 50%;
            font-weight: bold;
        }

        .hf-ball--sm {
            width: 28px;
            height: 28px;
            line-height: 28px;
            margin: 2px;
            font-size: 13px;
        }

        .hf-ball--md {
            width: 35px;
            height: 35px;
            line-height: 35px;
            margin: 3px;
        }

        .hf-ball--lg {
            width: 40px;
            height: 40px;
            line-height: 40px;
            margin: 5px;
            font-size: 18px;
        }

        .hf-ball--xl {
            width: 42px;
            height: 42px;
            line-height: 42px;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* 號碼球顏色變體 */
        .hf-ball--primary {
            background: #667eea;
        }

        .hf-ball--primary-glow {
            background: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.6);
        }

        .hf-ball--secondary {
            background: #764ba2;
        }

        .hf-ball--success {
            background: #28a745;
        }

        .hf-ball--warning {
            background: #ffb74d;
        }

        .hf-ball--warning-glow {
            background: #667eea;
            box-shadow: 0 0 8px rgba(255, 152, 0, 0.6);
        }

        .hf-ball--orange {
            background: #ff9800;
        }
        
        .hf-ball--pink {
            background: linear-gradient(135deg, #e83e8c, #d63384);
            box-shadow: 0 2px 4px rgba(232, 62, 140, 0.3);
        }

        .hf-ball--highlight {
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        /* 漸層號碼球 */
        .hf-ball--gradient-1 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .hf-ball--gradient-2 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .hf-ball--gradient-3 {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .hf-ball--gradient-4 {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .hf-ball--gradient-5 {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .hf-ball--gradient-6 {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        /* 文字樣式 */
        .hf-text--muted {
            color: #999;
        }

        .hf-text--success {
            color: #28a745;
            font-weight: bold;
        }

        .hf-text--danger {
            color: #dc3545;
            font-weight: bold;
        }

        .hf-text--secondary {
            color: #666;
            font-size: 12px;
        }

        .hf-text--small {
            color: #666;
            font-size: 11px;
        }

        /* 分隔符號 */
        .hf-separator {
            margin: 0 5px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        /* 概率信息區域 */
        .hf-prob-item {
            margin-bottom: 5px;
        }

        .hf-prob-box {
            margin-top: 8px;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 12px;
            line-height: 1.6;
        }

        .hf-prob-title {
            margin-bottom: 4px;
        }

        .hf-prob-text {
            margin-bottom: 3px;
        }

        .hf-prob-indent {
            margin-bottom: 3px;
            margin-left: 10px;
        }

        .hf-prob-divider {
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid #ddd;
        }

        .hf-prob-section {
            margin-top: 6px;
            margin-bottom: 3px;
        }

        /* 歷史記錄項目 */
        .hf-history-card {
            margin-bottom: 15px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #ddd;
        }

        .hf-history-card--active {
            border-left-color: #667eea;
        }

        .hf-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .hf-history-time {
            font-size: 12px;
            color: #666;
        }

        .hf-history-actions {
            display: flex;
            gap: 5px;
        }

        .hf-history-btn {
            padding: 2px 8px;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        .hf-history-btn--load {
            background: #667eea;
        }

        .hf-history-btn--remove {
            background: #dc3545;
        }

        .hf-history-meta {
            font-size: 13px;
            color: #555;
            margin-bottom: 6px;
        }

        .hf-history-random {
            margin-bottom: 6px;
        }

        .hf-history-random-label {
            font-size: 12px;
            color: #764ba2;
            font-weight: bold;
        }

        .hf-history-random-label--green {
            color: #28a745;
        }

        .hf-history-random-bet {
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px dashed #e0e0e0;
        }

        .hf-history-count {
            font-size: 11px;
            color: #999;
        }

        /* 歷史記錄聰明組合多注樣式 */
        .hf-history-smart-bets {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 4px;
        }

        .hf-history-bet-row {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 6px;
            background: rgba(118, 75, 162, 0.05);
            border-radius: 4px;
            border-left: 2px solid #764ba2;
        }

        .hf-history-bet-row--remainder {
            border-left-color: #fd7e14;
            background: rgba(253, 126, 20, 0.05);
        }

        .hf-history-bet-label {
            font-size: 10px;
            font-weight: bold;
            color: #764ba2;
            min-width: 40px;
        }

        .hf-history-bet-row--remainder .hf-history-bet-label {
            color: #fd7e14;
        }
        
        .hf-history-bet-row--extra {
            border-left-color: #e83e8c;
            background: rgba(232, 62, 140, 0.05);
        }
        
        .hf-history-bet-row--extra .hf-history-bet-label {
            color: #e83e8c;
        }

        /* 高頻號碼容器 */
        .hf-top-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .hf-top-freq {
            font-size: 10px;
            color: #666;
            margin-top: 4px;
        }

        /* 空狀態 */
        .hf-empty {
            color: #999;
            text-align: center;
            padding: 20px;
        }

        .hf-empty--inline {
            color: #999;
            text-align: center;
            margin: 0;
            width: 100%;
        }

        /* 江恩圖號碼球 */
        .gann-ball {
            display: inline-block;
            width: 32px;
            height: 32px;
            line-height: 32px;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            font-size: 14px;
        }

        .gann-ball--regular {
            background: white;
            color: #667eea;
        }

        .gann-ball--extra {
            background: #ffd700;
            color: #333;
            border: 2px solid white;
        }

        /* ========== 動態元素的Responsive設計 ========== */
        @media (max-width: 768px) {
            .hf-ball--md {
                width: 32px;
                height: 32px;
                line-height: 32px;
                font-size: 14px;
            }

            .hf-ball--lg {
                width: 36px;
                height: 36px;
                line-height: 36px;
                font-size: 16px;
            }

            .hf-ball--xl {
                width: 38px;
                height: 38px;
                line-height: 38px;
                font-size: 16px;
            }

            .hf-prob-box {
                font-size: 11px;
                padding: 6px;
            }

            .hf-history-card {
                padding: 10px;
            }

            .hf-history-time {
                font-size: 11px;
            }

            .gann-ball {
                width: 28px;
                height: 28px;
                line-height: 28px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .hf-ball--sm {
                width: 24px;
                height: 24px;
                line-height: 24px;
                font-size: 11px;
            }

            .hf-ball--md {
                width: 28px;
                height: 28px;
                line-height: 28px;
                font-size: 12px;
                margin: 2px;
            }

            .hf-ball--lg {
                width: 32px;
                height: 32px;
                line-height: 32px;
                font-size: 14px;
                margin: 3px;
            }

            .hf-ball--xl {
                width: 34px;
                height: 34px;
                line-height: 34px;
                font-size: 14px;
            }

            .hf-separator {
                font-size: 14px;
                margin: 0 3px;
            }

            .hf-prob-box {
                font-size: 10px;
                padding: 5px;
                line-height: 1.5;
            }

            .hf-prob-indent {
                margin-left: 6px;
            }

            .hf-history-card {
                padding: 8px;
                margin-bottom: 10px;
            }

            .hf-history-btn {
                padding: 2px 6px; 
                font-size: 10px;
            }

            .hf-history-meta {
                font-size: 12px;
            }

            .hf-top-freq {
                font-size: 9px;
            }

            .gann-ball {
                width: 24px;
                height: 24px;
                line-height: 24px;
                font-size: 11px;
            }
        }

        @media (max-width: 360px) {
            .hf-ball--md {
                width: 26px;
                height: 26px;
                line-height: 26px;
                font-size: 11px;
            }

            .hf-ball--lg {
                width: 28px;
                height: 28px;
                line-height: 28px;
                font-size: 12px;
            }

            .hf-history-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        /* 輔助類別 */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎰 六合彩數據分析系統 - 進階版</h1>
            <p>專業彩票數據分析與統計工具 | 包含數字共現分析</p>
        </div>

        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-button active" onclick="switchTab('results')">開獎結果</button>
                <button class="tab-button" onclick="switchTab('statistics')">統計分析</button>
                <button class="tab-button" onclick="switchTab('verification')">核對中獎</button>
                <button class="tab-button" onclick="switchTab('gann-square')">江恩螺旋四方圖</button>
            </div>

            <div class="tab-content">
                <!-- 結果標籤頁 -->
                <div id="results" class="tab-pane active">
                    <h2>近期開獎結果</h2>
                    <div id="results-content" class="loading">正在載入開獎數據...</div>
                </div>

                <!-- 統計標籤頁 -->
                <div id="statistics" class="tab-pane">
                    <h2>號碼統計分析</h2>
                    <div class="stats-controls">
                        <div class="range-selection">
                            <div class="range-title">📊 期數範圍選擇</div>

                            <div class="range-inputs">
                                <div class="input-group">
                                    <label class="input-label">開始期數</label>
                                    <input type="number" id="start-period" class="period-input" min="1" max="999" value="1" placeholder="1">
                                </div>

                                <div class="range-separator">至</div>

                                <div class="input-group">
                                    <label class="input-label">結束期數</label>
                                    <input type="number" id="end-period" class="period-input" min="1" max="999" value="100" placeholder="100">
                                </div>
                            </div>

                            <div class="range-info">
                                <span id="period-count">統計期數：100期</span> |
                                <span id="period-range">範圍：第1期 至 第100期</span>
                            </div>

                            <div class="quick-select">
                                <button class="next-period-btn" onclick="shiftRangeForward('stats')">下10期 ➡️</button>
                                <button class="quick-btn" onclick="setQuickRange(1, 10)">近10期</button>
                                <button class="quick-btn" onclick="setQuickRange(1, 20)">近20期</button>
                                <button class="quick-btn" onclick="setQuickRange(1, 30)">近30期</button>
                                <button class="quick-btn" onclick="setQuickRange(1, 50)">近50期</button>
                                <button class="quick-btn" onclick="setQuickRange(1, 75)">近75期</button>
                                <button class="quick-btn" onclick="setQuickRange(1, 100)">近100期</button>
                            </div>

                            <button class="apply-btn" onclick="applyRangeSelection()">🔍 應用範圍統計</button>
                            <button class="apply-btn filter-btn" onclick="filterHighFrequencyNumbers()">🎲 篩選高頻號碼</button>
                        </div>
                        
                        <!-- 高頻號碼篩選結果顯示區域 -->
                        <div id="high-frequency-result" class="high-frequency-result">
                            <div class="hf-flex-container">
                                <!-- 左側：當前篩選結果 -->
                                <div class="hf-panel">
                                    <div class="hf-panel-header">
                                        <h4 class="hf-panel-title">📊 高頻號碼篩選結果</h4>
                                        <div class="hf-mode-inline">
                                            <select id="filter-mode-select" class="filter-mode-select-sm" onchange="updateFilterModeDescription()">
                                                <option value="default">預設模式</option>
                                                <option value="rank">排名模式</option>
                                                <option value="rank_with_pair">排名+搭配</option>
                                            </select>
                                            <select id="filter-count-select" class="filter-count-select-sm">
                                                <option value="3">3個</option>
                                                <option value="4">4個</option>
                                                <option value="5">5個</option>
                                                <option value="6" selected>6個</option>
                                                <option value="7">7個</option>
                                                <option value="8">8個</option>
                                                <option value="9">9個</option>
                                                <option value="10">10個</option>
                                                <option value="11">11個</option>
                                                <option value="12">12個</option>
                                                <option value="13">13個</option>
                                                <option value="14">14個</option>
                                                <option value="15">15個</option>
                                                <option value="16">16個</option>
                                                <option value="17">17個</option>
                                                <option value="18">18個</option>
                                                <option value="19">19個</option>
                                                <option value="20">20個</option>
                                                <option value="25">25個</option>
                                                <option value="30">30個</option>
                                                <option value="35">35個</option>
                                                <option value="40">40個</option>
                                                <option value="49">49個</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="hf-filter-info">
                                        <strong>篩選條件：</strong>
                                        <span id="filter-threshold-info" class="hf-highlight-text"></span>
                                    </div>
                                    <div class="hf-result-box">
                                        <strong>符合條件的號碼：</strong>
                                        <span id="filtered-numbers-count" class="hf-highlight-bold"></span>
                                        <div id="filtered-numbers" class="hf-numbers-display"></div>
                                    </div>
                                    <div class="hf-result-box-green">
                                        <strong>上一期：</strong>
                                        <div id="previous-period-numbers" class="hf-numbers-display"></div>
                                        <div id="probability-info" class="hf-probability-info"></div>
                                    </div>
                                    <div class="hf-result-box-purple">
                                        <div class="hf-draw-header">
                                            <strong>抽號模式：</strong>
                                            <select id="draw-mode-select" class="draw-mode-select-sm" onchange="updateDrawModeUI()">
                                                <option value="single">單式（6個號碼）</option>
                                                <option value="complex">復式（7-15個號碼）</option>
                                                <option value="smart">聰明組合</option>
                                                <option value="smartComplex">聰明組合+復式</option>
                                                <option value="fiveBankerFullMeal">5膽拖全餐</option>
                                            </select>
                                            
                                            <!-- 復式模式：數量選擇器 -->
                                            <div id="complex-count-container" class="draw-mode-option" style="display: none;">
                                                <label>號碼數量：</label>
                                                <select id="complex-count-select" class="complex-count-select-sm" onchange="onComplexCountChange()">
                                                    <option value="7">7個</option>
                                                    <option value="8">8個</option>
                                                    <option value="9">9個</option>
                                                    <option value="10">10個</option>
                                                    <option value="11">11個</option>
                                                    <option value="12">12個</option>
                                                    <option value="13">13個</option>
                                                    <option value="14">14個</option>
                                                    <option value="15">15個</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 聰明組合模式：核心號碼選項 -->
                                            <div id="smart-core-container" class="draw-mode-option" style="display: none;">
                                                <label class="core-checkbox-label">
                                                    <input type="checkbox" id="smart-core-checkbox" onchange="updateSmartCoreUI()">
                                                    核心號碼
                                                </label>
                                                <select id="smart-core-number" class="smart-core-select-sm" style="display: none;" onchange="onSmartCoreNumberChange()">
                                                    <!-- 選項會根據高頻號碼動態生成 -->
                                                </select>
                                            </div>
                                            
                                            <!-- 聰明組合+復式模式：號碼數量選項 -->
                                            <div id="smart-complex-container" class="draw-mode-option" style="display: none;">
                                                <label>每注號碼數：</label>
                                                <select id="smart-complex-count-select" class="complex-count-select-sm" onchange="onSmartComplexCountChange()">
                                                    <option value="7">7個</option>
                                                    <option value="8">8個</option>
                                                    <option value="9">9個</option>
                                                    <option value="10">10個</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 隨機注數選項 -->
                                            <div id="random-bet-container" class="draw-mode-option">
                                                <label class="core-checkbox-label random-bet-label">
                                                    <input type="checkbox" id="random-bet-checkbox" onchange="onRandomBetChange()">
                                                    🎰 隨機注數
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="hf-draw-result-label">
                                            <strong id="draw-result-title">隨機抽取 6 個號碼：</strong>
                                        </div>
                                        <div id="random-6-numbers" class="hf-random-numbers"></div>
                                        <button onclick="refreshRandom6()" class="hf-refresh-btn">🔄 重新隨機抽取</button>
                                    </div>
                                </div>
                                
                                <!-- 右側：歷史記錄 -->
                                <div class="hf-panel">
                                    <div class="hf-history-header">
                                        <h4 class="hf-history-title">📜 篩選歷史記錄</h4>
                                        <button onclick="clearFilterHistory()" class="hf-clear-btn">清除歷史</button>
                                    </div>
                                    <div id="filter-history" class="hf-history-list">
                                        <p class="hf-empty-message">尚無篩選記錄</p>
                                    </div>
                                    
                                    <!-- 歷史高頻號碼 -->
                                    <div class="hf-highlight-box">
                                        <h4 class="hf-highlight-header">
                                            <span class="hf-highlight-icon">🔥</span>
                                            歷史高頻號碼
                                        </h4>
                                        <div id="historical-high-frequency" class="hf-highlight-content">
                                            <p class="hf-empty-message">尚無歷史數據</p>
                                        </div>
                                        <div class="hf-highlight-footer">
                                            根據歷史篩選記錄統計，按頻率統計排名排序
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="stats-content" class="loading">正在載入統計數據...</div>
                </div>

                <!-- 核對中獎標籤頁 -->
                <div id="verification" class="tab-pane">
                    <h2>核對中獎</h2>

                    <!-- 投注號碼選擇區域 -->
                    <div class="number-selection-container">
                        <h3 class="section-heading">🎯 投注號碼選擇</h3>

                        <!-- 投注模式切換 -->
                        <div class="betting-mode-tabs">
                            <button class="mode-tab active" onclick="switchBettingMode('complex')">複式投注</button>
                            <button class="mode-tab" onclick="switchBettingMode('banker')">膽腳投注</button>
                        </div>

                        <!-- 複式投注模式 -->
                        <div id="complex-betting-mode" class="betting-mode-content">
                            <!-- 號碼選擇狀態 -->
                            <div class="selection-status">
                                <span id="selected-count">已選擇：0個號碼</span>
                                <span id="combination-count">可組合：0注</span>
                            </div>

                            <!-- 號碼表格 -->
                            <div class="number-grid" id="number-grid">
                                <!-- 1-49的號碼將由JavaScript動態生成 -->
                            </div>
                        </div>

                        <!-- 膽腳投注模式 -->
                        <div id="banker-betting-mode" class="betting-mode-content hidden">
                            <!-- 膽腳投注狀態 -->
                            <div class="banker-selection-status">
                                <span id="banker-count">膽碼：0個</span>
                                <span id="runner-count">腳碼：0個</span>
                                <span id="banker-combination-count">總組合：0注</span>
                            </div>

                            <!-- 膽碼選擇區 -->
                            <div class="banker-section">
                                <h4 class="section-title">膽碼選擇（1-5個號碼）</h4>
                                <div class="number-grid banker-grid" id="banker-grid">
                                    <!-- 1-49的號碼將由JavaScript動態生成 -->
                                </div>
                            </div>

                            <!-- 腳碼選擇區 -->
                            <div class="runner-section">
                                <h4 class="section-title">腳碼選擇（至少1個號碼）</h4>
                                <div class="number-grid runner-grid" id="runner-grid">
                                    <!-- 1-49的號碼將由JavaScript動態生成 -->
                                </div>
                            </div>
                        </div>

                        <!-- 控制按鈕 -->
                        <div class="selection-controls">
                            <button class="control-btn reset-btn" onclick="resetSelection()">🔄 重置</button>
                            <button class="control-btn save-btn" onclick="saveSelection()">💾 保存選擇</button>
                        </div>

                        <!-- 快速選擇選項 -->
                        <div class="quick-selection">
                            <h4>快速選擇預設組合：</h4>
                            <div class="quick-options">
                                <button class="quick-option-btn" onclick="loadQuickSelection('hot')">熱門號碼</button>
                                <button class="quick-option-btn" onclick="loadQuickSelection('custom1')">組合一</button>
                                <button class="quick-option-btn" onclick="loadQuickSelection('custom2')">組合二</button>
                                <button class="quick-option-btn" onclick="loadQuickSelection('saved')">我的保存</button>
                            </div>
                        </div>
                    </div>

                    <!-- 期數範圍選擇區域 -->
                    <div class="verification-controls">
                        <div class="range-selection">
                            <div class="range-title">📊 期數範圍選擇</div>

                            <div class="range-inputs">
                                <div class="input-group">
                                    <label class="input-label">開始期數</label>
                                    <input type="number" id="verification-start-period" class="period-input" min="1" max="999" value="1" placeholder="1">
                                </div>

                                <div class="range-separator">至</div>

                                <div class="input-group">
                                    <label class="input-label">結束期數</label>
                                    <input type="number" id="verification-end-period" class="period-input" min="1" max="999" value="50" placeholder="40">
                                </div>
                            </div>

                            <div class="range-info">
                                <span id="verification-period-count">統計期數：40期</span> |
                                <span id="verification-period-range">範圍：第1期 至 第40期</span>
                            </div>

                            <div class="quick-select">
                                <button class="next-period-btn" onclick="shiftRangeForward('verification')">下10期 ➡️</button>
                                <button class="quick-btn" onclick="setVerificationQuickRange(1, 10)">近10期</button>
                                <button class="quick-btn" onclick="setVerificationQuickRange(1, 20)">近20期</button>
                                <button class="quick-btn" onclick="setVerificationQuickRange(1, 30)">近30期</button>
                                <button class="quick-btn" onclick="setVerificationQuickRange(1, 40)">近40期</button>
                            </div>
                        </div>
                    </div>

                    <!-- 計算按鈕 -->
                    <div class="calculation-controls">
                        <button class="calculate-btn" onclick="calculateComplexWinnings()">🎰 派彩獎金</button>
                        <button class="analysis-btn" onclick="loadVerification()">📊 統計分析</button>
                    </div>

                    <div id="verification-content" class="loading">正在載入統計分析數據...</div>
                </div>

                <!-- 江恩螺旋四方圖標籤頁 -->
                <div id="gann-square" class="tab-pane">
                    <h2>江恩螺旋四方圖</h2>
                    <div class="gann-container">
                        <p class="gann-description">
                            江恩螺旋四方圖是由威廉·江恩（William D. Gann）創造的數字排列方法。<br>
                            49個號碼按順時針方向由內向外螺旋排列，從中心的01開始，向右、向下、向左、向上依次展開。
                        </p>
                        
                        <!-- 期數選擇器 -->
                        <div class="gann-selector-box">
                            <div class="gann-selector-inner">
                                <label class="gann-selector-label">🎯 選擇期數：</label>
                                <select id="gann-period-select" class="gann-period-select" onchange="updateGannSquareHighlight()">
                                    <option value="">請選擇期數</option>
                                </select>
                            </div>
                            <div id="gann-selected-info" class="gann-selected-info">
                                <div class="gann-info-label">開獎號碼：</div>
                                <div id="gann-selected-numbers" class="gann-selected-numbers"></div>
                            </div>
                        </div>
                        
                        <!-- 7x7 螺旋網格 -->
                        <div id="gann-square-grid" class="gann-grid-wrapper">
                            <!-- 將由 JavaScript 生成 -->
                        </div>
                        
                        <div class="gann-info-box">
                            <h3 class="gann-info-title">📖 說明</h3>
                            <ul class="gann-info-list">
                                <li>中心位置為 <strong>01</strong>，代表起始點</li>
                                <li>數字按照 <strong>右→下→左→上</strong> 的順時針方向螺旋排列</li>
                                <li>每個數字都有其獨特的空間位置，可用於號碼分析</li>
                                <li>選擇期數後，該期開出的號碼將以<strong class="gann-highlight-color">粉紅色漸變</strong>高亮顯示</li>
                                <li>江恩理論認為，這種排列方式能揭示數字間的內在關聯</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 派彩獎金彈窗 -->
    <div id="winnings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🎰 派彩獎金詳情</h2>
                <span class="close" onclick="closeWinningsModal()">&times;</span>
            </div>
            <div id="winnings-details">
                <!-- 獎金詳情將由JavaScript動態生成 -->
            </div>
        </div>
    </div>

    <script>
        // 全局變量
        let selectedNumbers = [];
        const maxSelections = 20; // 最多選擇20個號碼

        // 膽腳投注變量
        let currentBettingMode = 'complex'; // 'complex' 或 'banker'
        let bankerNumbers = []; // 膽碼
        let runnerNumbers = []; // 腳碼
        const maxBankerNumbers = 5; // 最多5個膽碼

        // 預設投注組合
        const quickSelections = {
            hot: [3, 7, 11, 13, 20, 21, 22, 23, 24, 27, 30], // 熱門號碼
            custom1: [5, 6, 9, 13, 19, 25, 26, 30, 32, 35, 36, 39, 40, 44, 45, 46], // 組合一
            custom2: [4, 6, 12, 19, 25, 26, 27, 29, 32, 34, 46], // 組合二
            saved: [] // 用戶保存的組合
        };

        // 嵌入真實六合彩數據
        const lotteryData = [
        {draw_number: "25/130", draw_date: "2025-12-16", numbers: [3, 12, 23, 28, 35, 38], extra_number: 24},
        {draw_number: "25/129", draw_date: "2025-12-13", numbers: [10, 17, 19, 28, 45, 49], extra_number: 1},
        {draw_number: "25/128", draw_date: "2025-12-11", numbers: [1, 5, 6, 25, 30, 42], extra_number: 43},
        {draw_number: "25/127", draw_date: "2025-12-06", numbers: [4, 6, 26, 28, 34, 40], extra_number: 25},
        {draw_number: "25/126", draw_date: "2025-12-02", numbers: [6, 18, 29, 34, 37, 38], extra_number: 39},
        {draw_number: "25/125", draw_date: "2025-11-25", numbers: [1, 2, 17, 35, 37, 48], extra_number: 8},
        {draw_number: "25/124", draw_date: "2025-11-20", numbers: [19, 26, 33, 35, 36, 39], extra_number: 5},
        {draw_number: "25/123", draw_date: "2025-11-18", numbers: [2, 4, 10, 26, 28, 36], extra_number: 23},
        {draw_number: "25/122", draw_date: "2025-11-16", numbers: [2, 11, 13, 28, 38, 47], extra_number: 7},
        {draw_number: "25/121", draw_date: "2025-11-13", numbers: [10, 11, 28, 30, 37, 39], extra_number: 15},
        {draw_number: "25/120", draw_date: "2025-11-11", numbers: [18, 20, 28, 37, 38, 40], extra_number: 41},
        {draw_number: "25/119", draw_date: "2025-11-08", numbers: [7, 9, 16, 17, 33, 46], extra_number: 49},
        {draw_number: "25/118", draw_date: "2025-11-06", numbers: [10, 17, 22, 33, 40, 41], extra_number: 31},
        {draw_number: "25/117", draw_date: "2025-11-04", numbers: [19, 20, 26, 28, 39, 44], extra_number: 4},
        {draw_number: "25/116", draw_date: "2025-10-28", numbers: [4, 7, 15, 21, 45, 46], extra_number: 24},
        {draw_number: "25/115", draw_date: "2025-10-25", numbers: [6, 7, 27, 36, 39, 43], extra_number: 1},
        {draw_number: "25/114", draw_date: "2025-10-23", numbers: [4, 19, 24, 25, 26, 46], extra_number: 39},
        {draw_number: "25/113", draw_date: "2025-10-21", numbers: [1, 8, 9, 11, 18, 32], extra_number: 13},
        {draw_number: "25/112", draw_date: "2025-10-18", numbers: [5, 13, 17, 18, 31, 44], extra_number: 2},
        {draw_number: "25/111", draw_date: "2025-10-16", numbers: [2, 11, 32, 40, 43, 48], extra_number: 12},
        {draw_number: "25/110", draw_date: "2025-10-14", numbers: [3, 15, 17, 24, 32, 44], extra_number: 20},
        {draw_number: "25/109", draw_date: "2025-10-11", numbers: [5, 6, 18, 19, 30, 39], extra_number: 7},
        {draw_number: "25/108", draw_date: "2025-10-09", numbers: [1, 3, 24, 31, 39, 45], extra_number: 7},
        {draw_number: "25/107", draw_date: "2025-10-06", numbers: [15, 17, 19, 23, 24, 34], extra_number: 33},
        {draw_number: "25/106", draw_date: "2025-09-30", numbers: [13, 21, 33, 41, 44, 46], extra_number: 43},
        {draw_number: "25/105", draw_date: "2025-09-27", numbers: [8, 14, 16, 18, 26, 48], extra_number: 44},
        {draw_number: "25/104", draw_date: "2025-09-25", numbers: [2, 11, 22, 27, 46, 47], extra_number: 32},
        {draw_number: "25/103", draw_date: "2025-09-20", numbers: [8, 13, 17, 24, 36, 43], extra_number: 41},
        {draw_number: "25/102", draw_date: "2025-09-18", numbers: [22, 33, 35, 36, 37, 48], extra_number: 30},
        {draw_number: "25/101", draw_date: "2025-09-16", numbers: [14, 21, 22, 28, 32, 33], extra_number: 25},
        {draw_number: "25/100", draw_date: "2025-09-13", numbers: [15, 21, 23, 37, 47, 49], extra_number: 30},
        {draw_number: "25/099", draw_date: "2025-09-11", numbers: [11, 21, 22, 25, 32, 44], extra_number: 38},
        {draw_number: "25/098", draw_date: "2025-09-09", numbers: [7, 15, 32, 40, 42, 44], extra_number: 9},
        {draw_number: "25/097", draw_date: "2025-09-06", numbers: [6, 19, 22, 23, 34, 43], extra_number: 11},
        {draw_number: "25/096", draw_date: "2025-09-02", numbers: [5, 18, 23, 24, 29, 49], extra_number: 11},
        {draw_number: "25/095", draw_date: "2025-08-30", numbers: [6, 18, 31, 33, 44, 49], extra_number: 2},
        {draw_number: "25/094", draw_date: "2025-08-28", numbers: [5, 36, 39, 44, 48, 49], extra_number: 32},
        {draw_number: "25/093", draw_date: "2025-08-26", numbers: [2, 3, 16, 25, 38, 48], extra_number: 6},
        {draw_number: "25/092", draw_date: "2025-08-23", numbers: [17, 22, 26, 36, 39, 45], extra_number: 14},
        {draw_number: "25/091", draw_date: "2025-08-21", numbers: [6, 8, 10, 23, 32, 45], extra_number: 3},
        {draw_number: "25/090", draw_date: "2025-08-19", numbers: [28, 32, 34, 37, 45, 49], extra_number: 7},
        {draw_number: "25/089", draw_date: "2025-08-16", numbers: [4, 10, 15, 20, 32, 38], extra_number: 26},
        {draw_number: "25/088", draw_date: "2025-08-14", numbers: [1, 13, 25, 27, 31, 34], extra_number: 33},
        {draw_number: "25/087", draw_date: "2025-08-12", numbers: [8, 16, 18, 28, 29, 32], extra_number: 20},
        {draw_number: "25/086", draw_date: "2025-08-09", numbers: [25, 36, 44, 45, 48, 49], extra_number: 13},
        {draw_number: "25/085", draw_date: "2025-08-07", numbers: [3, 7, 25, 29, 37, 39], extra_number: 8},
        {draw_number: "25/084", draw_date: "2025-08-02", numbers: [10, 14, 18, 21, 34, 44], extra_number: 24},
        {draw_number: "25/083", draw_date: "2025-07-31", numbers: [10, 21, 23, 27, 35, 47], extra_number: 39},
        {draw_number: "25/082", draw_date: "2025-07-29", numbers: [9, 11, 17, 28, 35, 43], extra_number: 42},
        {draw_number: "25/081", draw_date: "2025-07-26", numbers: [19, 22, 25, 32, 33, 45], extra_number: 36},
        {draw_number: "25/080", draw_date: "2025-07-21", numbers: [17, 20, 28, 31, 35, 48], extra_number: 32},
        {draw_number: "25/079", draw_date: "2025-07-19", numbers: [6, 25, 29, 40, 48, 49], extra_number: 42},
        {draw_number: "25/078", draw_date: "2025-07-17", numbers: [12, 19, 31, 37, 42, 45], extra_number: 15},
            {draw_number: "25/077", draw_date: "2025-07-15", numbers: [9, 12, 23, 30, 31, 44], extra_number: 5},
            {draw_number: "25/076", draw_date: "2025-07-12", numbers: [5, 17, 20, 24, 27, 35], extra_number: 38},
            {draw_number: "25/075", draw_date: "2025-07-10", numbers: [6, 13, 23, 25, 32, 39], extra_number: 34},
            {draw_number: "25/074", draw_date: "2025-07-08", numbers: [13, 16, 17, 22, 23, 35], extra_number: 41},
            {draw_number: "25/073", draw_date: "2025-07-06", numbers: [5, 9, 22, 33, 46, 47], extra_number: 36},
            {draw_number: "25/072", draw_date: "2025-07-03", numbers: [7, 17, 24, 35, 37, 45], extra_number: 30},
            {draw_number: "25/071", draw_date: "2025-06-29", numbers: [19, 29, 32, 34, 42, 46], extra_number: 20},
            {draw_number: "25/070", draw_date: "2025-06-26", numbers: [9, 11, 23, 24, 29, 49], extra_number: 30},
            {draw_number: "25/069", draw_date: "2025-06-24", numbers: [3, 21, 28, 33, 45, 49], extra_number: 29},
            {draw_number: "25/068", draw_date: "2025-06-21", numbers: [2, 4, 19, 27, 31, 39], extra_number: 13},
            {draw_number: "25/067", draw_date: "2025-06-19", numbers: [7, 12, 13, 18, 34, 35], extra_number: 6},
            {draw_number: "25/066", draw_date: "2025-06-17", numbers: [5, 19, 30, 40, 44, 45], extra_number: 26},
            {draw_number: "25/065", draw_date: "2025-06-12", numbers: [6, 25, 32, 36, 39, 45], extra_number: 13},
            {draw_number: "25/064", draw_date: "2025-06-10", numbers: [9, 13, 35, 40, 45, 46], extra_number: 26},
            {draw_number: "25/063", draw_date: "2025-06-07", numbers: [9, 15, 27, 30, 34, 39], extra_number: 19},
            {draw_number: "25/062", draw_date: "2025-06-05", numbers: [18, 22, 24, 33, 39, 44], extra_number: 3},
            {draw_number: "25/061", draw_date: "2025-06-03", numbers: [1, 2, 13, 15, 41, 46], extra_number: 27},
            {draw_number: "25/060", draw_date: "2025-06-01", numbers: [12, 16, 28, 29, 38, 47], extra_number: 26},
            {draw_number: "25/059", draw_date: "2025-05-29", numbers: [5, 6, 16, 21, 24, 35], extra_number: 33},
            {draw_number: "25/058", draw_date: "2025-05-24", numbers: [6, 14, 15, 19, 45, 47], extra_number: 17},
            {draw_number: "25/057", draw_date: "2025-05-22", numbers: [4, 11, 26, 29, 34, 35], extra_number: 18},
            {draw_number: "25/056", draw_date: "2025-05-20", numbers: [10, 15, 28, 31, 34, 40], extra_number: 48},
            {draw_number: "25/055", draw_date: "2025-05-17", numbers: [12, 22, 27, 29, 32, 34], extra_number: 9},
            {draw_number: "25/054", draw_date: "2025-05-15", numbers: [6, 12, 29, 32, 34, 46], extra_number: 16},
            {draw_number: "25/053", draw_date: "2025-05-13", numbers: [13, 26, 27, 41, 45, 49], extra_number: 46},
            {draw_number: "25/052", draw_date: "2025-05-11", numbers: [19, 26, 28, 29, 46, 49], extra_number: 32},
            {draw_number: "25/051", draw_date: "2025-05-08", numbers: [6, 11, 17, 22, 27, 43], extra_number: 24},
            {draw_number: "25/050", draw_date: "2025-05-06", numbers: [12, 15, 25, 26, 29, 41], extra_number: 42},
            {draw_number: "25/049", draw_date: "2025-05-03", numbers: [18, 20, 30, 35, 47, 49], extra_number: 44},
            {draw_number: "25/048", draw_date: "2025-05-01", numbers: [4, 7, 21, 32, 41, 47], extra_number: 28},
            {draw_number: "25/047", draw_date: "2025-04-29", numbers: [20, 21, 24, 30, 32, 38], extra_number: 47},
            {draw_number: "25/046", draw_date: "2025-04-26", numbers: [11, 15, 18, 21, 29, 40], extra_number: 8},
            {draw_number: "25/045", draw_date: "2025-04-24", numbers: [12, 16, 21, 35, 44, 48], extra_number: 32},
            {draw_number: "25/044", draw_date: "2025-04-22", numbers: [3, 7, 11, 20, 23, 27], extra_number: 29},
            {draw_number: "25/043", draw_date: "2025-04-19", numbers: [1, 11, 24, 37, 45, 49], extra_number: 22},
            {draw_number: "25/042", draw_date: "2025-04-15", numbers: [10, 20, 21, 22, 23, 42], extra_number: 49},
            {draw_number: "25/041", draw_date: "2025-04-12", numbers: [19, 21, 34, 36, 47, 49], extra_number: 14},
            {draw_number: "25/040", draw_date: "2025-04-10", numbers: [11, 22, 23, 26, 32, 35], extra_number: 2},
            {draw_number: "25/039", draw_date: "2025-04-08", numbers: [11, 17, 20, 27, 36, 48], extra_number: 21},
            {draw_number: "25/038", draw_date: "2025-04-05", numbers: [7, 11, 22, 26, 39, 44], extra_number: 8},
            {draw_number: "25/037", draw_date: "2025-04-03", numbers: [2, 4, 7, 29, 32, 40], extra_number: 44},
            {draw_number: "25/036", draw_date: "2025-04-01", numbers: [6, 14, 17, 30, 35, 42], extra_number: 49},
            {draw_number: "25/035", draw_date: "2025-03-29", numbers: [3, 5, 12, 13, 45, 47], extra_number: 46},
            {draw_number: "25/034", draw_date: "2025-03-27", numbers: [10, 19, 35, 44, 47, 49], extra_number: 15},
            {draw_number: "25/033", draw_date: "2025-03-25", numbers: [8, 11, 17, 36, 43, 48], extra_number: 25},
            {draw_number: "25/032", draw_date: "2025-03-22", numbers: [12, 23, 24, 27, 36, 46], extra_number: 43},
            {draw_number: "25/031", draw_date: "2025-03-20", numbers: [16, 20, 21, 24, 39, 43], extra_number: 34},
            {draw_number: "25/030", draw_date: "2025-03-18", numbers: [6, 8, 24, 26, 29, 45], extra_number: 39},
            {draw_number: "25/029", draw_date: "2025-03-16", numbers: [29, 30, 36, 41, 48, 49], extra_number: 14},
            {draw_number: "25/028", draw_date: "2025-03-13", numbers: [4, 16, 19, 21, 26, 29], extra_number: 13},
            {draw_number: "25/027", draw_date: "2025-03-11", numbers: [1, 4, 9, 14, 21, 37], extra_number: 45},
            {draw_number: "25/026", draw_date: "2025-03-08", numbers: [19, 25, 26, 29, 32, 39], extra_number: 4},
            {draw_number: "25/025", draw_date: "2025-03-06", numbers: [4, 11, 19, 20, 30, 39], extra_number: 45},
            {draw_number: "25/024", draw_date: "2025-03-04", numbers: [1, 9, 14, 38, 42, 43], extra_number: 23},
            {draw_number: "25/023", draw_date: "2025-03-01", numbers: [4, 15, 22, 25, 29, 42], extra_number: 1},
            {draw_number: "25/022", draw_date: "2025-02-27", numbers: [7, 11, 15, 17, 25, 28], extra_number: 9},
            {draw_number: "25/021", draw_date: "2025-02-25", numbers: [1, 2, 6, 11, 40, 47], extra_number: 32},
            {draw_number: "25/020", draw_date: "2025-02-22", numbers: [14, 15, 20, 27, 41, 44], extra_number: 33},
            {draw_number: "25/019", draw_date: "2025-02-20", numbers: [13, 20, 22, 27, 41, 44], extra_number: 36},
            {draw_number: "25/018", draw_date: "2025-02-18", numbers: [3, 7, 13, 35, 37, 39], extra_number: 23},
            {draw_number: "25/017", draw_date: "2025-02-15", numbers: [1, 8, 21, 25, 29, 34], extra_number: 4},
            {draw_number: "25/016", draw_date: "2025-02-13", numbers: [5, 26, 29, 32, 42, 45], extra_number: 36},
            {draw_number: "25/015", draw_date: "2025-02-11", numbers: [5, 15, 20, 26, 30, 40], extra_number: 39},
            {draw_number: "25/014", draw_date: "2025-02-08", numbers: [1, 7, 21, 27, 33, 45], extra_number: 17},
            {draw_number: "25/013", draw_date: "2025-02-06", numbers: [1, 4, 18, 25, 38, 45], extra_number: 23},
            {draw_number: "25/012", draw_date: "2025-02-04", numbers: [3, 13, 15, 18, 19, 24], extra_number: 37},
            {draw_number: "25/011", draw_date: "2025-02-02", numbers: [14, 18, 30, 36, 40, 42], extra_number: 1},
            {draw_number: "25/010", draw_date: "2025-01-25", numbers: [7, 14, 19, 31, 36, 45], extra_number: 24},
            {draw_number: "25/009", draw_date: "2025-01-23", numbers: [3, 6, 24, 25, 34, 37], extra_number: 45},
            {draw_number: "25/008", draw_date: "2025-01-21", numbers: [16, 22, 33, 43, 48, 49], extra_number: 8},
            {draw_number: "25/007", draw_date: "2025-01-18", numbers: [3, 4, 6, 12, 18, 32], extra_number: 28},
            {draw_number: "25/006", draw_date: "2025-01-16", numbers: [1, 3, 4, 19, 38, 45], extra_number: 39},
            {draw_number: "25/005", draw_date: "2025-01-14", numbers: [3, 5, 11, 12, 18, 48], extra_number: 6},
            {draw_number: "25/004", draw_date: "2025-01-11", numbers: [8, 15, 26, 27, 30, 35], extra_number: 2},
            {draw_number: "25/003", draw_date: "2025-01-09", numbers: [1, 19, 28, 33, 35, 41], extra_number: 11},
            {draw_number: "25/002", draw_date: "2025-01-07", numbers: [8, 13, 18, 23, 31, 47], extra_number: 16},
            {draw_number: "25/001", draw_date: "2025-01-02", numbers: [9, 23, 42, 44, 45, 46], extra_number: 22},
            {draw_number: "24/140", draw_date: "2024-12-28", numbers: [1, 3, 5, 18, 26, 35], extra_number: 14},
            {draw_number: "24/139", draw_date: "2024-12-24", numbers: [8, 11, 18, 23, 25, 41], extra_number: 45},
            {draw_number: "24/138", draw_date: "2024-12-21", numbers: [14, 20, 21, 22, 23, 30], extra_number: 18},
            {draw_number: "24/137", draw_date: "2024-12-19", numbers: [1, 2, 3, 36, 37, 41], extra_number: 10},
            {draw_number: "24/136", draw_date: "2024-12-17", numbers: [9, 11, 23, 26, 30, 48], extra_number: 28},
            {draw_number: "24/135", draw_date: "2024-12-14", numbers: [1, 16, 18, 36, 37, 46], extra_number: 38},
            {draw_number: "24/134", draw_date: "2024-12-12", numbers: [10, 14, 16, 21, 37, 49], extra_number: 22},
            {draw_number: "24/133", draw_date: "2024-12-10", numbers: [3, 18, 24, 33, 43, 44], extra_number: 4},
            {draw_number: "24/132", draw_date: "2024-12-07", numbers: [1, 15, 18, 33, 34, 39], extra_number: 22},
            {draw_number: "24/131", draw_date: "2024-12-05", numbers: [5, 12, 27, 29, 38, 40], extra_number: 22},
            {draw_number: "24/130", draw_date: "2024-12-03", numbers: [2, 13, 15, 17, 22, 28], extra_number: 23},
            {draw_number: "24/129", draw_date: "2024-11-30", numbers: [10, 14, 23, 24, 33, 41], extra_number: 38},
            {draw_number: "24/128", draw_date: "2024-11-28", numbers: [9, 15, 26, 32, 33, 44], extra_number: 1},
            {draw_number: "24/127", draw_date: "2024-11-26", numbers: [8, 11, 12, 28, 29, 44], extra_number: 34},
            {draw_number: "24/126", draw_date: "2024-11-23", numbers: [1, 2, 7, 14, 15, 25], extra_number: 35},
            {draw_number: "24/125", draw_date: "2024-11-21", numbers: [1, 3, 6, 14, 32, 34], extra_number: 12},
            {draw_number: "24/124", draw_date: "2024-11-19", numbers: [19, 32, 36, 38, 39, 47], extra_number: 29},
            {draw_number: "24/123", draw_date: "2024-11-16", numbers: [1, 3, 7, 19, 31, 38], extra_number: 23},
            {draw_number: "24/122", draw_date: "2024-11-14", numbers: [8, 14, 20, 28, 36, 39], extra_number: 30},
            {draw_number: "24/121", draw_date: "2024-11-12", numbers: [5, 13, 22, 27, 45, 46], extra_number: 7},
            {draw_number: "24/120", draw_date: "2024-11-10", numbers: [3, 20, 24, 27, 30, 42], extra_number: 17},
            {draw_number: "24/119", draw_date: "2024-11-07", numbers: [11, 17, 33, 36, 40, 44], extra_number: 2},
            {draw_number: "24/118", draw_date: "2024-11-05", numbers: [7, 11, 13, 24, 27, 31], extra_number: 35},
            {draw_number: "24/117", draw_date: "2024-11-02", numbers: [14, 16, 25, 40, 41, 45], extra_number: 27},
            {draw_number: "24/116", draw_date: "31/10/2024", numbers: [7, 13, 16, 22, 23, 31], extra_number: 6},
            {draw_number: "24/115", draw_date: "28/10/2024", numbers: [5, 6, 13, 15, 36, 49], extra_number: 23},
            {draw_number: "24/114", draw_date: "22/10/2024", numbers: [13, 21, 28, 30, 41, 49], extra_number: 3},
            {draw_number: "24/113", draw_date: "17/10/2024", numbers: [11, 17, 22, 26, 33, 46], extra_number: 35},
            {draw_number: "24/112", draw_date: "15/10/2024", numbers: [19, 36, 37, 43, 44, 49], extra_number: 8},
            {draw_number: "24/111", draw_date: "12/10/2024", numbers: [4, 8, 9, 19, 20, 48], extra_number: 21},
            {draw_number: "24/110", draw_date: "10/10/2024", numbers: [10, 33, 35, 40, 44, 48], extra_number: 6},
            {draw_number: "24/109", draw_date: "08/10/2024", numbers: [10, 16, 24, 32, 37, 40], extra_number: 19},
            {draw_number: "24/108", draw_date: "02/10/2024", numbers: [8, 15, 21, 32, 43, 47], extra_number: 41},
            {draw_number: "24/107", draw_date: "26/09/2024", numbers: [2, 4, 29, 35, 38, 49], extra_number: 14},
            {draw_number: "24/106", draw_date: "24/09/2024", numbers: [9, 17, 28, 31, 40, 49], extra_number: 25},
            {draw_number: "24/105", draw_date: "21/09/2024", numbers: [2, 3, 14, 25, 27, 36], extra_number: 45},
            {draw_number: "24/104", draw_date: "19/09/2024", numbers: [5, 18, 21, 24, 44, 47], extra_number: 20},
            {draw_number: "24/103", draw_date: "17/09/2024", numbers: [5, 18, 21, 24, 27, 44], extra_number: 10},
            {draw_number: "24/102", draw_date: "12/09/2024", numbers: [14, 18, 20, 25, 32, 43], extra_number: 45},
            {draw_number: "24/101", draw_date: "10/09/2024", numbers: [1, 12, 16, 20, 21, 30], extra_number: 27},
            {draw_number: "24/100", draw_date: "07/09/2024", numbers: [5, 24, 26, 32, 35, 40], extra_number: 16},
            {draw_number: "24/099", draw_date: "03/09/2024", numbers: [2, 3, 7, 25, 46, 48], extra_number: 13},
            {draw_number: "24/098", draw_date: "31/08/2024", numbers: [2, 21, 34, 36, 41, 47], extra_number: 31},
            {draw_number: "24/097", draw_date: "29/08/2024", numbers: [6, 7, 18, 24, 28, 29], extra_number: 1},
            {draw_number: "24/096", draw_date: "27/08/2024", numbers: [2, 15, 23, 33, 34, 39], extra_number: 19},
            {draw_number: "24/095", draw_date: "24/08/2024", numbers: [9, 15, 19, 28, 31, 41], extra_number: 42},
            {draw_number: "24/094", draw_date: "22/08/2024", numbers: [8, 9, 16, 21, 32, 33], extra_number: 34},
            {draw_number: "24/093", draw_date: "20/08/2024", numbers: [1, 4, 16, 26, 39, 49], extra_number: 7},
            {draw_number: "24/092", draw_date: "17/08/2024", numbers: [6, 13, 19, 21, 26, 28], extra_number: 9},
            {draw_number: "24/091", draw_date: "15/08/2024", numbers: [3, 16, 33, 35, 39, 44], extra_number: 8},
            {draw_number: "24/090", draw_date: "13/08/2024", numbers: [7, 9, 20, 21, 30, 35], extra_number: 26},
            {draw_number: "24/089", draw_date: "10/08/2024", numbers: [8, 12, 21, 35, 44, 45], extra_number: 2},
            {draw_number: "24/088", draw_date: "08/08/2024", numbers: [3, 6, 7, 8, 11, 29], extra_number: 49},
            {draw_number: "24/087", draw_date: "06/08/2024", numbers: [3, 4, 7, 13, 27, 41], extra_number: 38},
            {draw_number: "24/086", draw_date: "03/08/2024", numbers: [5, 6, 8, 22, 26, 44], extra_number: 40},
            {draw_number: "24/085", draw_date: "01/08/2024", numbers: [2, 9, 16, 39, 43, 46], extra_number: 20},
            {draw_number: "24/084", draw_date: "30/07/2024", numbers: [6, 7, 17, 20, 21, 25], extra_number: 26},
            {draw_number: "24/083", draw_date: "25/07/2024", numbers: [3, 16, 18, 26, 43, 45], extra_number: 9},
            {draw_number: "24/082", draw_date: "23/07/2024", numbers: [12, 13, 24, 25, 27, 34], extra_number: 4},
            {draw_number: "24/081", draw_date: "20/07/2024", numbers: [17, 18, 31, 33, 39, 41], extra_number: 14},
            {draw_number: "24/080", draw_date: "18/07/2024", numbers: [11, 12, 18, 28, 29, 30], extra_number: 39},
            {draw_number: "24/079", draw_date: "16/07/2024", numbers: [11, 13, 17, 34, 40, 47], extra_number: 21},
            {draw_number: "24/078", draw_date: "13/07/2024", numbers: [17, 21, 24, 27, 29, 48], extra_number: 8},
            {draw_number: "24/077", draw_date: "11/07/2024", numbers: [8, 20, 29, 33, 34, 44], extra_number: 12},
            {draw_number: "24/076", draw_date: "09/07/2024", numbers: [18, 25, 30, 35, 36, 40], extra_number: 44},
            {draw_number: "24/075", draw_date: "07/07/2024", numbers: [1, 2, 17, 27, 34, 41], extra_number: 22},
            {draw_number: "24/074", draw_date: "02/07/2024", numbers: [5, 8, 15, 21, 27, 37], extra_number: 2},
            {draw_number: "24/073", draw_date: "29/06/2024", numbers: [7, 21, 29, 30, 36, 46], extra_number: 42},
            {draw_number: "24/072", draw_date: "27/06/2024", numbers: [2, 17, 24, 30, 32, 40], extra_number: 16},
            {draw_number: "24/071", draw_date: "25/06/2024", numbers: [21, 30, 34, 40, 48, 49], extra_number: 16},
            {draw_number: "24/070", draw_date: "22/06/2024", numbers: [18, 25, 28, 34, 42, 49], extra_number: 14},
            {draw_number: "24/069", draw_date: "20/06/2024", numbers: [14, 21, 26, 27, 42, 46], extra_number: 45},
            {draw_number: "24/068", draw_date: "18/06/2024", numbers: [9, 16, 31, 33, 38, 48], extra_number: 23},
            {draw_number: "24/067", draw_date: "16/06/2024", numbers: [3, 7, 13, 17, 21, 49], extra_number: 4},
            {draw_number: "24/066", draw_date: "13/06/2024", numbers: [1, 5, 15, 19, 25, 39], extra_number: 46},
            {draw_number: "24/065", draw_date: "09/06/2024", numbers: [6, 9, 12, 17, 19, 42], extra_number: 13},
            {draw_number: "24/064", draw_date: "04/06/2024", numbers: [6, 11, 19, 21, 27, 43], extra_number: 44},
            {draw_number: "24/063", draw_date: "01/06/2024", numbers: [6, 18, 28, 33, 36, 48], extra_number: 11},
            {draw_number: "24/062", draw_date: "30/05/2024", numbers: [1, 24, 25, 27, 30, 32], extra_number: 13},
            {draw_number: "24/061", draw_date: "28/05/2024", numbers: [33, 37, 38, 43, 44, 46], extra_number: 32},
            {draw_number: "24/060", draw_date: "25/05/2024", numbers: [7, 26, 30, 37, 46, 49], extra_number: 25},
            {draw_number: "24/059", draw_date: "23/05/2024", numbers: [5, 9, 18, 21, 36, 40], extra_number: 13},
            {draw_number: "24/058", draw_date: "21/05/2024", numbers: [2, 3, 4, 15, 37, 40], extra_number: 8},
            {draw_number: "24/057", draw_date: "18/05/2024", numbers: [8, 17, 19, 27, 33, 45], extra_number: 37},
            {draw_number: "24/056", draw_date: "16/05/2024", numbers: [21, 32, 40, 43, 44, 49], extra_number: 1},
            {draw_number: "24/055", draw_date: "14/05/2024", numbers: [14, 37, 38, 41, 45, 49], extra_number: 5},
            {draw_number: "24/054", draw_date: "12/05/2024", numbers: [3, 9, 25, 30, 36, 41], extra_number: 19},
            {draw_number: "24/053", draw_date: "09/05/2024", numbers: [5, 14, 15, 18, 23, 48], extra_number: 13},
            {draw_number: "24/052", draw_date: "07/05/2024", numbers: [8, 19, 27, 30, 36, 42], extra_number: 2},
            {draw_number: "24/051", draw_date: "04/05/2024", numbers: [1, 3, 7, 21, 28, 30], extra_number: 45},
            {draw_number: "24/050", draw_date: "02/05/2024", numbers: [6, 18, 21, 39, 42, 46], extra_number: 17},
            {draw_number: "24/049", draw_date: "30/04/2024", numbers: [11, 12, 28, 35, 37, 39], extra_number: 30},
            {draw_number: "24/048", draw_date: "27/04/2024", numbers: [9, 18, 28, 40, 47, 48], extra_number: 23},
            {draw_number: "24/047", draw_date: "25/04/2024", numbers: [3, 17, 25, 32, 36, 38], extra_number: 46},
            {draw_number: "24/046", draw_date: "23/04/2024", numbers: [5, 6, 16, 27, 37, 47], extra_number: 24},
            {draw_number: "24/045", draw_date: "21/04/2024", numbers: [7, 8, 10, 12, 17, 27], extra_number: 25},
            {draw_number: "24/044", draw_date: "18/04/2024", numbers: [17, 25, 26, 30, 38, 48], extra_number: 28},
            {draw_number: "24/043", draw_date: "16/04/2024", numbers: [12, 14, 17, 18, 23, 44], extra_number: 27},
            {draw_number: "24/042", draw_date: "13/04/2024", numbers: [6, 10, 12, 14, 17, 41], extra_number: 47},
            {draw_number: "24/041", draw_date: "11/04/2024", numbers: [2, 7, 9, 13, 33, 35], extra_number: 49},
            {draw_number: "24/040", draw_date: "09/04/2024", numbers: [13, 20, 29, 30, 34, 48], extra_number: 3},
            {draw_number: "24/039", draw_date: "06/04/2024", numbers: [15, 16, 17, 30, 34, 35], extra_number: 25},
            {draw_number: "24/038", draw_date: "04/04/2024", numbers: [4, 8, 12, 22, 24, 26], extra_number: 1},
            {draw_number: "24/037", draw_date: "02/04/2024", numbers: [16, 25, 31, 42, 43, 44], extra_number: 7},
            {draw_number: "24/036", draw_date: "30/03/2024", numbers: [2, 6, 18, 22, 36, 39], extra_number: 21},
            {draw_number: "24/035", draw_date: "28/03/2024", numbers: [2, 9, 15, 20, 39, 48], extra_number: 43},
            {draw_number: "24/034", draw_date: "26/03/2024", numbers: [6, 11, 12, 18, 24, 42], extra_number: 38},
            {draw_number: "24/033", draw_date: "23/03/2024", numbers: [11, 18, 24, 35, 42, 46], extra_number: 3},
            {draw_number: "24/032", draw_date: "21/03/2024", numbers: [6, 19, 20, 34, 39, 42], extra_number: 44},
            {draw_number: "24/031", draw_date: "19/03/2024", numbers: [7, 8, 29, 30, 36, 48], extra_number: 28},
            {draw_number: "24/030", draw_date: "17/03/2024", numbers: [1, 8, 13, 23, 40, 44], extra_number: 15},
            {draw_number: "24/029", draw_date: "14/03/2024", numbers: [6, 23, 24, 31, 34, 49], extra_number: 1},
            {draw_number: "24/028", draw_date: "12/03/2024", numbers: [13, 16, 18, 24, 32, 43], extra_number: 44},
            {draw_number: "24/027", draw_date: "09/03/2024", numbers: [4, 5, 8, 21, 32, 42], extra_number: 45},
            {draw_number: "24/026", draw_date: "07/03/2024", numbers: [5, 22, 30, 31, 32, 39], extra_number: 44},
            {draw_number: "24/025", draw_date: "05/03/2024", numbers: [11, 24, 34, 36, 39, 42], extra_number: 38},
            {draw_number: "24/024", draw_date: "02/03/2024", numbers: [7, 23, 31, 35, 43, 46], extra_number: 10},
            {draw_number: "24/023", draw_date: "29/02/2024", numbers: [5, 13, 16, 36, 39, 41], extra_number: 38},
            {draw_number: "24/022", draw_date: "27/02/2024", numbers: [3, 11, 12, 22, 24, 26], extra_number: 21},
            {draw_number: "24/021", draw_date: "24/02/2024", numbers: [2, 7, 24, 29, 30, 36], extra_number: 6},
            {draw_number: "24/020", draw_date: "22/02/2024", numbers: [22, 25, 33, 34, 35, 39], extra_number: 5},
            {draw_number: "24/019", draw_date: "20/02/2024", numbers: [10, 26, 27, 29, 30, 45], extra_number: 37},
            {draw_number: "24/018", draw_date: "17/02/2024", numbers: [9, 23, 26, 27, 36, 41], extra_number: 24},
            {draw_number: "24/017", draw_date: "14/02/2024", numbers: [10, 12, 13, 24, 25, 48], extra_number: 15},
            {draw_number: "24/016", draw_date: "08/02/2024", numbers: [5, 7, 9, 20, 22, 25], extra_number: 13},
            {draw_number: "24/015", draw_date: "06/02/2024", numbers: [15, 18, 19, 38, 41, 49], extra_number: 22},
            {draw_number: "24/014", draw_date: "03/02/2024", numbers: [3, 7, 21, 32, 36, 47], extra_number: 23},
            {draw_number: "24/013", draw_date: "01/02/2024", numbers: [4, 12, 15, 23, 24, 31], extra_number: 43},
            {draw_number: "24-012", draw_date: "30/01/2024", numbers: [8, 20, 21, 29, 30, 49], extra_number: 32},
            {draw_number: "24-011", draw_date: "27/01/2024", numbers: [1, 8, 13, 19, 34, 47], extra_number: 12},
            {draw_number: "24-010", draw_date: "25/01/2024", numbers: [2, 5, 15, 32, 45, 49], extra_number: 19},
            {draw_number: "24-009", draw_date: "23/01/2024", numbers: [2, 6, 7, 14, 30, 43], extra_number: 15},
            {draw_number: "24-008", draw_date: "20/01/2024", numbers: [3, 25, 31, 40, 43, 48], extra_number: 45},
            {draw_number: "24-007", draw_date: "18/01/2024", numbers: [2, 10, 17, 46, 47, 49], extra_number: 3},
            {draw_number: "24-006", draw_date: "16/01/2024", numbers: [1, 6, 8, 27, 41, 47], extra_number: 29},
            {draw_number: "24-005", draw_date: "14/01/2024", numbers: [3, 17, 18, 36, 38, 39], extra_number: 21},
            {draw_number: "24-004", draw_date: "11/01/2024", numbers: [3, 6, 8, 26, 29, 38], extra_number: 1},
            {draw_number: "24-003", draw_date: "09/01/2024", numbers: [3, 9, 16, 19, 33, 35], extra_number: 39},
            {draw_number: "24-002", draw_date: "06/01/2024", numbers: [1, 4, 24, 31, 33, 34], extra_number: 2},
            {draw_number: "24-001", draw_date: "03/01/2024", numbers: [2, 3, 19, 34, 37, 46], extra_number: 32},
            {draw_number: "23/146", draw_date: "30/12/2023", numbers: [5, 8, 19, 25, 41, 48], extra_number: 24},
            {draw_number: "23/145", draw_date: "28/12/2023", numbers: [11, 18, 27, 29, 34, 45], extra_number: 28},
            {draw_number: "23/144", draw_date: "24/12/2023", numbers: [2, 8, 16, 19, 37, 49], extra_number: 20},
            {draw_number: "23/143", draw_date: "21/12/2023", numbers: [1, 10, 12, 33, 46, 49], extra_number: 32},
            {draw_number: "23/142", draw_date: "19/12/2023", numbers: [4, 9, 13, 33, 35, 46], extra_number: 6},
            {draw_number: "23/141", draw_date: "14/12/2023", numbers: [3, 4, 11, 37, 44, 48], extra_number: 36},
            {draw_number: "23/140", draw_date: "12/12/2023", numbers: [3, 10, 20, 24, 27, 42], extra_number: 45},
            {draw_number: "23/139", draw_date: "09/12/2023", numbers: [2, 3, 4, 31, 46, 49], extra_number: 34},
            {draw_number: "23/138", draw_date: "07/12/2023", numbers: [27, 28, 37, 38, 43, 45], extra_number: 40},
            {draw_number: "23/137", draw_date: "05/12/2023", numbers: [9, 16, 23, 38, 39, 41], extra_number: 19},
            {draw_number: "23/136", draw_date: "02/12/2023", numbers: [3, 17, 30, 36, 38, 45], extra_number: 8},
            {draw_number: "23/135", draw_date: "30/11/2023", numbers: [7, 12, 32, 34, 36, 39], extra_number: 5},
            {draw_number: "23/134", draw_date: "28/11/2023", numbers: [3, 14, 20, 30, 38, 42], extra_number: 13},
            {draw_number: "23/133", draw_date: "25/11/2023", numbers: [2, 8, 12, 28, 34, 47], extra_number: 7},
            {draw_number: "23/132", draw_date: "23/11/2023", numbers: [11, 16, 24, 27, 28, 32], extra_number: 48},
            {draw_number: "23/131", draw_date: "21/11/2023", numbers: [9, 11, 15, 17, 19, 44], extra_number: 7},
            {draw_number: "23/130", draw_date: "18/11/2023", numbers: [6, 25, 29, 30, 34, 35], extra_number: 20},
            {draw_number: "23/129", draw_date: "16/11/2023", numbers: [3, 5, 8, 16, 26, 33], extra_number: 24},
            {draw_number: "23/128", draw_date: "14/11/2023", numbers: [2, 15, 27, 36, 37, 48], extra_number: 23},
            {draw_number: "23/127", draw_date: "12/11/2023", numbers: [19, 26, 32, 34, 37, 44], extra_number: 11},
            {draw_number: "23/126", draw_date: "09/11/2023", numbers: [1, 4, 18, 25, 30, 49], extra_number: 15},
            {draw_number: "23/125", draw_date: "07/11/2023", numbers: [7, 16, 26, 31, 47, 49], extra_number: 44},
            {draw_number: "23/124", draw_date: "04/11/2023", numbers: [2, 13, 16, 28, 40, 44], extra_number: 46},
            {draw_number: "23/123", draw_date: "02/11/2023", numbers: [3, 14, 32, 37, 43, 47], extra_number: 26},
            {draw_number: "23/122", draw_date: "31/10/2023", numbers: [4, 33, 35, 36, 41, 49], extra_number: 1},
            {draw_number: "23/121", draw_date: "26/10/2023", numbers: [11, 16, 27, 32, 33, 37], extra_number: 24},
            {draw_number: "23/120", draw_date: "24/10/2023", numbers: [19, 20, 29, 45, 48, 49], extra_number: 8},
            {draw_number: "23/119", draw_date: "21/10/2023", numbers: [6, 8, 12, 31, 32, 46], extra_number: 4},
            {draw_number: "23/118", draw_date: "19/10/2023", numbers: [1, 13, 18, 32, 34, 49], extra_number: 44},
            {draw_number: "23/117", draw_date: "17/10/2023", numbers: [8, 18, 24, 34, 41, 42], extra_number: 31},
            {draw_number: "23/116", draw_date: "14/10/2023", numbers: [1, 29, 31, 42, 47, 48], extra_number: 40},
            {draw_number: "23/115", draw_date: "12/10/2023", numbers: [2, 13, 23, 28, 30, 31], extra_number: 3},
            {draw_number: "23/114", draw_date: "10/10/2023", numbers: [1, 12, 22, 23, 34, 39], extra_number: 30},
            {draw_number: "23/113", draw_date: "07/10/2023", numbers: [4, 9, 12, 36, 43, 47], extra_number: 26},
            {draw_number: "23/112", draw_date: "05/10/2023", numbers: [2, 11, 20, 29, 41, 49], extra_number: 45},
            {draw_number: "23/111", draw_date: "03/10/2023", numbers: [8, 16, 32, 39, 40, 43], extra_number: 29},
            {draw_number: "23/110", draw_date: "30/09/2023", numbers: [6, 8, 11, 26, 35, 47], extra_number: 1},
            {draw_number: "23/109", draw_date: "28/09/2023", numbers: [9, 12, 30, 31, 45, 48], extra_number: 46},
            {draw_number: "23/108", draw_date: "23/09/2023", numbers: [3, 27, 28, 35, 44, 46], extra_number: 12},
            {draw_number: "23/107", draw_date: "21/09/2023", numbers: [1, 10, 22, 28, 33, 46], extra_number: 37},
            {draw_number: "23/106", draw_date: "19/09/2023", numbers: [8, 9, 10, 27, 35, 38], extra_number: 46},
            {draw_number: "23/105", draw_date: "16/09/2023", numbers: [10, 24, 34, 40, 41, 45], extra_number: 35},
            {draw_number: "23/104", draw_date: "14/09/2023", numbers: [17, 27, 30, 31, 32, 38], extra_number: 11},
            {draw_number: "23/103", draw_date: "12/09/2023", numbers: [4, 10, 12, 16, 30, 32], extra_number: 14},
            {draw_number: "23/102", draw_date: "09/09/2023", numbers: [4, 6, 19, 32, 39, 42], extra_number: 34},
            {draw_number: "23/101", draw_date: "07/09/2023", numbers: [20, 22, 24, 25, 29, 49], extra_number: 36},
            {draw_number: "23/100", draw_date: "05/09/2023", numbers: [2, 5, 20, 24, 27, 32], extra_number: 12},
            {draw_number: "23/099", draw_date: "03/09/2023", numbers: [15, 20, 25, 39, 45, 48], extra_number: 28},
            {draw_number: "23/098", draw_date: "31/08/2023", numbers: [10, 15, 17, 21, 40, 44], extra_number: 12},
            {draw_number: "23/097", draw_date: "29/08/2023", numbers: [3, 6, 7, 33, 36, 46], extra_number: 4},
            {draw_number: "23/096", draw_date: "26/08/2023", numbers: [16, 26, 31, 35, 39, 46], extra_number: 3},
            {draw_number: "23/095", draw_date: "24/08/2023", numbers: [6, 18, 29, 31, 44, 46], extra_number: 8},
            {draw_number: "23/094", draw_date: "22/08/2023", numbers: [1, 5, 7, 12, 48, 49], extra_number: 16},
            {draw_number: "23/093", draw_date: "19/08/2023", numbers: [8, 14, 18, 20, 23, 25], extra_number: 44},
            {draw_number: "23/092", draw_date: "17/08/2023", numbers: [3, 9, 15, 18, 21, 37], extra_number: 42},
            {draw_number: "23/091", draw_date: "15/08/2023", numbers: [4, 12, 17, 37, 38, 39], extra_number: 41},
            {draw_number: "23/090", draw_date: "12/08/2023", numbers: [3, 12, 13, 17, 24, 36], extra_number: 16},
            {draw_number: "23/089", draw_date: "10/08/2023", numbers: [2, 3, 4, 13, 18, 42], extra_number: 12},
            {draw_number: "23/088", draw_date: "08/08/2023", numbers: [4, 7, 18, 28, 30, 40], extra_number: 29},
            {draw_number: "23/087", draw_date: "05/08/2023", numbers: [2, 8, 24, 39, 41, 44], extra_number: 40},
            {draw_number: "23/086", draw_date: "03/08/2023", numbers: [3, 14, 23, 30, 33, 44], extra_number: 21},
            {draw_number: "23/085", draw_date: "01/08/2023", numbers: [2, 7, 25, 28, 31, 35], extra_number: 11},
            {draw_number: "23/084", draw_date: "29/07/2023", numbers: [13, 23, 26, 40, 41, 43], extra_number: 14},
            {draw_number: "23/083", draw_date: "27/07/2023", numbers: [13, 15, 17, 18, 20, 43], extra_number: 39},
            {draw_number: "23/082", draw_date: "25/07/2023", numbers: [1, 2, 10, 13, 29, 47], extra_number: 9},
            {draw_number: "23/081", draw_date: "20/07/2023", numbers: [4, 16, 18, 34, 35, 46], extra_number: 47},
            {draw_number: "23/080", draw_date: "18/07/2023", numbers: [15, 16, 34, 36, 39, 40], extra_number: 42},
            {draw_number: "23/079", draw_date: "15/07/2023", numbers: [4, 9, 12, 33, 37, 42], extra_number: 3},
            {draw_number: "23/078", draw_date: "13/07/2023", numbers: [3, 8, 11, 23, 36, 38], extra_number: 33},
            {draw_number: "23/077", draw_date: "11/07/2023", numbers: [7, 19, 22, 27, 40, 47], extra_number: 13},
            {draw_number: "23/076", draw_date: "08/07/2023", numbers: [1, 11, 22, 26, 38, 39], extra_number: 27},
            {draw_number: "23/075", draw_date: "04/07/2023", numbers: [5, 15, 20, 29, 32, 37], extra_number: 18},
            {draw_number: "23/074", draw_date: "02/07/2023", numbers: [3, 6, 25, 29, 35, 42], extra_number: 36},
            {draw_number: "23/073", draw_date: "29/06/2023", numbers: [6, 10, 18, 21, 22, 33], extra_number: 4},
            {draw_number: "23/072", draw_date: "27/06/2023", numbers: [7, 10, 16, 18, 29, 45], extra_number: 1},
            {draw_number: "23/071", draw_date: "24/06/2023", numbers: [1, 11, 14, 16, 26, 36], extra_number: 39},
            {draw_number: "23/070", draw_date: "22/06/2023", numbers: [14, 15, 24, 30, 37, 39], extra_number: 26},
            {draw_number: "23/069", draw_date: "20/06/2023", numbers: [8, 18, 31, 34, 35, 47], extra_number: 39},
            {draw_number: "23/068", draw_date: "17/06/2023", numbers: [18, 22, 31, 35, 44, 48], extra_number: 6},
            {draw_number: "23/067", draw_date: "15/06/2023", numbers: [5, 13, 17, 20, 33, 38], extra_number: 14},
            {draw_number: "23/066", draw_date: "13/06/2023", numbers: [14, 16, 22, 26, 36, 42], extra_number: 19},
            {draw_number: "23/065", draw_date: "11/06/2023", numbers: [14, 16, 18, 22, 30, 47], extra_number: 11},
            {draw_number: "23/064", draw_date: "08/06/2023", numbers: [4, 22, 24, 28, 45, 46], extra_number: 7},
            {draw_number: "23/063", draw_date: "06/06/2023", numbers: [6, 12, 34, 42, 45, 48], extra_number: 2},
            {draw_number: "23/062", draw_date: "03/06/2023", numbers: [2, 16, 24, 25, 47, 48], extra_number: 40},
            {draw_number: "23/061", draw_date: "01/06/2023", numbers: [14, 30, 32, 42, 45, 47], extra_number: 4},
            {draw_number: "23/060", draw_date: "30/05/2023", numbers: [3, 9, 15, 30, 32, 41], extra_number: 26},
            {draw_number: "23/059", draw_date: "27/05/2023", numbers: [11, 20, 21, 22, 27, 32], extra_number: 12},
            {draw_number: "23/058", draw_date: "25/05/2023", numbers: [3, 14, 18, 26, 40, 43], extra_number: 15},
            {draw_number: "23/057", draw_date: "23/05/2023", numbers: [4, 14, 15, 37, 41, 49], extra_number: 38},
            {draw_number: "23/056", draw_date: "20/05/2023", numbers: [1, 19, 22, 26, 46, 47], extra_number: 39},
            {draw_number: "23/055", draw_date: "18/05/2023", numbers: [5, 6, 12, 16, 41, 47], extra_number: 7},
            {draw_number: "23/054", draw_date: "16/05/2023", numbers: [2, 18, 27, 31, 32, 46], extra_number: 44},
            {draw_number: "23/053", draw_date: "14/05/2023", numbers: [1, 4, 9, 35, 37, 48], extra_number: 43},
            {draw_number: "23/052", draw_date: "11/05/2023", numbers: [17, 18, 28, 30, 32, 33], extra_number: 1},
            {draw_number: "23/051", draw_date: "09/05/2023", numbers: [7, 10, 22, 25, 32, 35], extra_number: 27},
            {draw_number: "23/050", draw_date: "06/05/2023", numbers: [1, 5, 14, 15, 21, 25], extra_number: 31},
            {draw_number: "23/049", draw_date: "04/05/2023", numbers: [2, 10, 28, 37, 47, 49], extra_number: 7},
            {draw_number: "23/048", draw_date: "02/05/2023", numbers: [4, 10, 20, 32, 38, 49], extra_number: 7},
            {draw_number: "23/047", draw_date: "29/04/2023", numbers: [7, 8, 17, 19, 27, 40], extra_number: 2},
            {draw_number: "23/046", draw_date: "27/04/2023", numbers: [8, 12, 21, 43, 44, 49], extra_number: 27},
            {draw_number: "23/045", draw_date: "25/04/2023", numbers: [20, 26, 38, 43, 46, 47], extra_number: 35},
            {draw_number: "23/044", draw_date: "22/04/2023", numbers: [2, 6, 7, 9, 17, 19], extra_number: 26},
            {draw_number: "23/043", draw_date: "20/04/2023", numbers: [1, 20, 24, 28, 38, 46], extra_number: 40},
            {draw_number: "23/042", draw_date: "18/04/2023", numbers: [20, 23, 27, 28, 30, 46], extra_number: 29},
            {draw_number: "23/041", draw_date: "16/04/2023", numbers: [10, 12, 18, 20, 23, 36], extra_number: 6},
            {draw_number: "23/040", draw_date: "13/04/2023", numbers: [9, 14, 15, 32, 36, 48], extra_number: 25},
            {draw_number: "23/039", draw_date: "11/04/2023", numbers: [12, 23, 29, 40, 42, 43], extra_number: 20},
            {draw_number: "23/038", draw_date: "08/04/2023", numbers: [1, 13, 17, 18, 33, 36], extra_number: 22},
            {draw_number: "23/037", draw_date: "04/04/2023", numbers: [15, 19, 20, 24, 36, 47], extra_number: 4},
            {draw_number: "23/036", draw_date: "01/04/2023", numbers: [8, 9, 12, 19, 21, 40], extra_number: 24},
            {draw_number: "23/035", draw_date: "30/03/2023", numbers: [1, 8, 12, 36, 42, 47], extra_number: 40},
            {draw_number: "23/034", draw_date: "28/03/2023", numbers: [9, 10, 16, 41, 44, 46], extra_number: 39},
            {draw_number: "23/033", draw_date: "25/03/2023", numbers: [11, 15, 18, 26, 31, 37], extra_number: 10},
            {draw_number: "23/032", draw_date: "23/03/2023", numbers: [5, 14, 17, 20, 22, 32], extra_number: 33},
            {draw_number: "23/031", draw_date: "21/03/2023", numbers: [8, 13, 18, 30, 33, 41], extra_number: 20},
            {draw_number: "23/030", draw_date: "18/03/2023", numbers: [4, 7, 17, 34, 42, 48], extra_number: 3},
            {draw_number: "23/029", draw_date: "16/03/2023", numbers: [18, 21, 28, 30, 34, 40], extra_number: 14},
            {draw_number: "23/028", draw_date: "14/03/2023", numbers: [1, 2, 10, 12, 18, 37], extra_number: 43},
            {draw_number: "23/027", draw_date: "12/03/2023", numbers: [11, 12, 13, 20, 35, 43], extra_number: 44},
            {draw_number: "23/026", draw_date: "09/03/2023", numbers: [1, 4, 7, 14, 31, 37], extra_number: 11},
            {draw_number: "23/025", draw_date: "07/03/2023", numbers: [4, 11, 12, 26, 37, 40], extra_number: 7},
            {draw_number: "23/024", draw_date: "04/03/2023", numbers: [1, 9, 15, 26, 42, 44], extra_number: 25},
            {draw_number: "23/023", draw_date: "02/03/2023", numbers: [14, 17, 19, 32, 39, 46], extra_number: 36},
            {draw_number: "23/022", draw_date: "28/02/2023", numbers: [8, 13, 29, 33, 40, 42], extra_number: 3},
            {draw_number: "23/021", draw_date: "25/02/2023", numbers: [14, 25, 27, 28, 44, 47], extra_number: 4},
            {draw_number: "23/020", draw_date: "23/02/2023", numbers: [8, 16, 32, 42, 47, 48], extra_number: 35},
            {draw_number: "23/019", draw_date: "21/02/2023", numbers: [8, 19, 29, 30, 33, 41], extra_number: 4},
            {draw_number: "23/018", draw_date: "18/02/2023", numbers: [4, 12, 20, 28, 34, 49], extra_number: 43},
            {draw_number: "23/017", draw_date: "16/02/2023", numbers: [8, 9, 13, 22, 38, 39], extra_number: 11},
            {draw_number: "23/016", draw_date: "14/02/2023", numbers: [3, 13, 19, 32, 33, 39], extra_number: 24},
            {draw_number: "23/015", draw_date: "11/02/2023", numbers: [13, 18, 22, 29, 34, 41], extra_number: 23},
            {draw_number: "23/014", draw_date: "09/02/2023", numbers: [1, 9, 13, 27, 29, 40], extra_number: 20},
            {draw_number: "23/013", draw_date: "07/02/2023", numbers: [4, 11, 13, 14, 30, 37], extra_number: 20},
            {draw_number: "23/012", draw_date: "04/02/2023", numbers: [14, 18, 25, 29, 31, 42], extra_number: 6},
            {draw_number: "23/011", draw_date: "02/02/2023", numbers: [2, 8, 23, 33, 34, 35], extra_number: 43},
            {draw_number: "23/010", draw_date: "28/01/2023", numbers: [2, 12, 16, 38, 45, 46], extra_number: 14},
            {draw_number: "23/009", draw_date: "26/01/2023", numbers: [2, 3, 23, 31, 32, 43], extra_number: 40},
            {draw_number: "23/008", draw_date: "19/01/2023", numbers: [17, 25, 27, 29, 36, 49], extra_number: 23},
            {draw_number: "23/007", draw_date: "17/01/2023", numbers: [10, 15, 29, 34, 38, 47], extra_number: 18},
            {draw_number: "23/006", draw_date: "14/01/2023", numbers: [3, 5, 16, 26, 35, 38], extra_number: 9},
            {draw_number: "23/005", draw_date: "12/01/2023", numbers: [6, 22, 26, 27, 40, 45], extra_number: 13},
            {draw_number: "23/004", draw_date: "10/01/2023", numbers: [2, 21, 24, 29, 35, 47], extra_number: 18},
            {draw_number: "23/003", draw_date: "07/01/2023", numbers: [10, 31, 33, 34, 43, 49], extra_number: 40},
            {draw_number: "23/002", draw_date: "05/01/2023", numbers: [5, 9, 19, 34, 36, 49], extra_number: 23},
            {draw_number: "23/001", draw_date: "03/01/2023", numbers: [7, 20, 25, 27, 35, 43], extra_number: 1},
            {draw_number: "22/111", draw_date: "29/12/2022", numbers: [1, 2, 21, 33, 41, 45], extra_number: 4},
            {draw_number: "22/110", draw_date: "27/12/2022", numbers: [5, 13, 18, 32, 39, 45], extra_number: 44},
            {draw_number: "22/109", draw_date: "25/12/2022", numbers: [2, 7, 11, 14, 18, 39], extra_number: 29},
            {draw_number: "22/108", draw_date: "22/12/2022", numbers: [16, 18, 19, 33, 41, 46], extra_number: 37},
            {draw_number: "22/107", draw_date: "20/12/2022", numbers: [28, 36, 37, 38, 41, 45], extra_number: 42},
            {draw_number: "22/106", draw_date: "17/12/2022", numbers: [6, 14, 15, 26, 35, 40], extra_number: 8},
            {draw_number: "22/105", draw_date: "15/12/2022", numbers: [5, 7, 18, 26, 31, 45], extra_number: 30},
            {draw_number: "22/104", draw_date: "13/12/2022", numbers: [12, 38, 39, 40, 45, 49], extra_number: 10},
            {draw_number: "22/103", draw_date: "10/12/2022", numbers: [6, 12, 20, 25, 39, 49], extra_number: 7},
            {draw_number: "22/102", draw_date: "08/12/2022", numbers: [17, 19, 35, 39, 44, 46], extra_number: 21},
            {draw_number: "22/101", draw_date: "06/12/2022", numbers: [6, 11, 17, 30, 44, 46], extra_number: 5},
            {draw_number: "22/100", draw_date: "03/12/2022", numbers: [2, 15, 31, 34, 38, 41], extra_number: 21},
            {draw_number: "22/099", draw_date: "01/12/2022", numbers: [14, 18, 27, 32, 39, 42], extra_number: 43},
            {draw_number: "22/098", draw_date: "29/11/2022", numbers: [12, 18, 22, 28, 31, 40], extra_number: 7},
            {draw_number: "22/097", draw_date: "26/11/2022", numbers: [14, 25, 28, 29, 43, 44], extra_number: 10},
            {draw_number: "22/096", draw_date: "24/11/2022", numbers: [3, 12, 14, 19, 25, 28], extra_number: 11},
            {draw_number: "22/095", draw_date: "22/11/2022", numbers: [6, 10, 11, 13, 32, 46], extra_number: 39},
            {draw_number: "22/094", draw_date: "19/11/2022", numbers: [6, 11, 27, 39, 46, 47], extra_number: 15},
            {draw_number: "22/093", draw_date: "17/11/2022", numbers: [1, 9, 27, 32, 33, 35], extra_number: 45},
            {draw_number: "22/092", draw_date: "15/11/2022", numbers: [17, 18, 32, 38, 44, 49], extra_number: 19},
            {draw_number: "22/091", draw_date: "13/11/2022", numbers: [5, 12, 18, 19, 26, 33], extra_number: 46},
            {draw_number: "22/090", draw_date: "10/11/2022", numbers: [11, 12, 14, 18, 29, 30], extra_number: 31},
            {draw_number: "22/089", draw_date: "08/11/2022", numbers: [10, 20, 27, 32, 38, 46], extra_number: 4},
            {draw_number: "22/088", draw_date: "05/11/2022", numbers: [7, 11, 22, 23, 28, 32], extra_number: 29},
            {draw_number: "22/087", draw_date: "03/11/2022", numbers: [10, 13, 19, 21, 27, 49], extra_number: 35},
            {draw_number: "22/086", draw_date: "01/11/2022", numbers: [2, 12, 14, 32, 41, 46], extra_number: 20},
            {draw_number: "22/085", draw_date: "29/10/2022", numbers: [4, 5, 12, 15, 28, 29], extra_number: 20},
            {draw_number: "22/084", draw_date: "25/10/2022", numbers: [27, 28, 30, 34, 35, 48], extra_number: 11},
            {draw_number: "22/083", draw_date: "22/10/2022", numbers: [12, 15, 16, 42, 44, 45], extra_number: 4},
            {draw_number: "22/082", draw_date: "20/10/2022", numbers: [20, 24, 27, 31, 32, 49], extra_number: 36},
            {draw_number: "22/081", draw_date: "18/10/2022", numbers: [7, 25, 26, 39, 44, 45], extra_number: 46},
            {draw_number: "22/080", draw_date: "15/10/2022", numbers: [18, 21, 25, 28, 38, 44], extra_number: 45},
            {draw_number: "22/079", draw_date: "13/10/2022", numbers: [1, 10, 14, 38, 47, 48], extra_number: 40},
            {draw_number: "22/078", draw_date: "11/10/2022", numbers: [1, 5, 10, 25, 36, 47], extra_number: 23},
            {draw_number: "22/077", draw_date: "08/10/2022", numbers: [7, 11, 28, 31, 43, 48], extra_number: 42},
            {draw_number: "22/076", draw_date: "06/10/2022", numbers: [4, 11, 21, 28, 31, 47], extra_number: 5},
            {draw_number: "22/075", draw_date: "04/10/2022", numbers: [7, 8, 12, 13, 26, 43], extra_number: 3},
            {draw_number: "22/074", draw_date: "02/10/2022", numbers: [1, 7, 11, 24, 27, 38], extra_number: 17},
            {draw_number: "22/073", draw_date: "29/09/2022", numbers: [6, 8, 18, 36, 37, 44], extra_number: 30},
            {draw_number: "22/072", draw_date: "27/09/2022", numbers: [2, 18, 29, 30, 32, 47], extra_number: 46},
            {draw_number: "22/071", draw_date: "24/09/2022", numbers: [4, 6, 10, 27, 29, 46], extra_number: 17},
            {draw_number: "22/070", draw_date: "22/09/2022", numbers: [8, 11, 31, 32, 33, 36], extra_number: 46},
            {draw_number: "22/069", draw_date: "20/09/2022", numbers: [4, 7, 14, 18, 27, 31], extra_number: 48},
            {draw_number: "22/068", draw_date: "17/09/2022", numbers: [5, 17, 22, 24, 34, 38], extra_number: 13},
            {draw_number: "22/067", draw_date: "15/09/2022", numbers: [21, 23, 29, 30, 33, 49], extra_number: 40},
            {draw_number: "22/066", draw_date: "13/09/2022", numbers: [2, 4, 20, 38, 40, 46], extra_number: 11},
            {draw_number: "22/065", draw_date: "08/09/2022", numbers: [8, 14, 15, 20, 41, 44], extra_number: 3},
            {draw_number: "22/064", draw_date: "06/09/2022", numbers: [14, 22, 35, 37, 42, 46], extra_number: 24},
            {draw_number: "22/063", draw_date: "03/09/2022", numbers: [2, 8, 12, 19, 35, 45], extra_number: 33},
            {draw_number: "22/062", draw_date: "01/09/2022", numbers: [23, 24, 30, 31, 45, 46], extra_number: 26},
            {draw_number: "22/061", draw_date: "30/08/2022", numbers: [7, 8, 9, 17, 24, 25], extra_number: 20},
            {draw_number: "22/060", draw_date: "27/08/2022", numbers: [12, 22, 34, 35, 39, 45], extra_number: 7},
            {draw_number: "22/059", draw_date: "25/08/2022", numbers: [16, 19, 32, 33, 42, 46], extra_number: 34},
            {draw_number: "22/058", draw_date: "23/08/2022", numbers: [4, 8, 9, 10, 30, 42], extra_number: 22},
            {draw_number: "22/057", draw_date: "20/08/2022", numbers: [8, 17, 19, 28, 31, 35], extra_number: 46},
            {draw_number: "22/056", draw_date: "18/08/2022", numbers: [2, 8, 19, 21, 24, 47], extra_number: 4},
            {draw_number: "22/055", draw_date: "16/08/2022", numbers: [7, 20, 31, 35, 41, 47], extra_number: 42},
            {draw_number: "22/054", draw_date: "13/08/2022", numbers: [6, 22, 25, 33, 38, 47], extra_number: 10},
            {draw_number: "22/053", draw_date: "11/08/2022", numbers: [7, 12, 22, 26, 43, 49], extra_number: 5},
            {draw_number: "22/052", draw_date: "09/08/2022", numbers: [1, 12, 25, 28, 36, 46], extra_number: 13},
            {draw_number: "22/051", draw_date: "04/08/2022", numbers: [13, 24, 30, 35, 36, 39], extra_number: 29},
            {draw_number: "22/050", draw_date: "02/08/2022", numbers: [4, 8, 9, 11, 42, 46], extra_number: 47},
            {draw_number: "22/049", draw_date: "30/07/2022", numbers: [21, 25, 34, 37, 41, 46], extra_number: 14},
            {draw_number: "22/048", draw_date: "28/07/2022", numbers: [8, 13, 16, 21, 23, 49], extra_number: 44},
            {draw_number: "22/047", draw_date: "26/07/2022", numbers: [6, 14, 23, 31, 38, 48], extra_number: 1},
            {draw_number: "22/046", draw_date: "22/07/2022", numbers: [5, 12, 21, 30, 34, 38], extra_number: 3},
            {draw_number: "22/045", draw_date: "15/07/2022", numbers: [19, 20, 25, 29, 46, 47], extra_number: 35},
            {draw_number: "22/044", draw_date: "12/07/2022", numbers: [4, 13, 22, 27, 43, 47], extra_number: 23},
            {draw_number: "22/043", draw_date: "08/07/2022", numbers: [7, 10, 28, 30, 32, 36], extra_number: 27},
            {draw_number: "22/042", draw_date: "05/07/2022", numbers: [9, 30, 31, 32, 37, 40], extra_number: 25},
            {draw_number: "22/041", draw_date: "03/07/2022", numbers: [19, 21, 23, 26, 37, 39], extra_number: 13},
            {draw_number: "22/040", draw_date: "27/06/2022", numbers: [1, 13, 19, 26, 29, 37], extra_number: 15},
            {draw_number: "22/039", draw_date: "21/06/2022", numbers: [2, 15, 20, 30, 47, 48], extra_number: 44},
            {draw_number: "22/038", draw_date: "17/06/2022", numbers: [9, 17, 24, 27, 33, 39], extra_number: 48},
            {draw_number: "22/037", draw_date: "14/06/2022", numbers: [7, 16, 21, 30, 34, 38], extra_number: 41},
            {draw_number: "22/036", draw_date: "10/06/2022", numbers: [11, 17, 24, 26, 37, 41], extra_number: 34},
            {draw_number: "22/035", draw_date: "07/06/2022", numbers: [9, 16, 21, 35, 47, 48], extra_number: 36},
            {draw_number: "22/034", draw_date: "03/06/2022", numbers: [1, 27, 32, 35, 38, 44], extra_number: 24},
            {draw_number: "22/033", draw_date: "31/05/2022", numbers: [2, 13, 35, 39, 43, 48], extra_number: 9},
            {draw_number: "22/032", draw_date: "27/05/2022", numbers: [1, 17, 25, 29, 42, 46], extra_number: 8},
            {draw_number: "22/031", draw_date: "24/05/2022", numbers: [5, 7, 8, 17, 47, 49], extra_number: 34},
            {draw_number: "22/030", draw_date: "20/05/2022", numbers: [27, 30, 36, 38, 45, 46], extra_number: 34},
            {draw_number: "22/029", draw_date: "17/05/2022", numbers: [4, 7, 29, 35, 40, 46], extra_number: 17},
            {draw_number: "22/028", draw_date: "13/05/2022", numbers: [1, 5, 10, 22, 30, 34], extra_number: 42},
            {draw_number: "22/027", draw_date: "10/05/2022", numbers: [12, 14, 19, 39, 41, 48], extra_number: 33},
            {draw_number: "22/026", draw_date: "06/05/2022", numbers: [2, 15, 41, 42, 44, 46], extra_number: 40},
            {draw_number: "22/025", draw_date: "03/05/2022", numbers: [3, 8, 11, 15, 18, 40], extra_number: 41},
            {draw_number: "22/024", draw_date: "29/04/2022", numbers: [1, 7, 16, 28, 31, 48], extra_number: 18},
            {draw_number: "22/023", draw_date: "26/04/2022", numbers: [9, 23, 30, 32, 34, 40], extra_number: 25},
            {draw_number: "22/022", draw_date: "22/04/2022", numbers: [8, 11, 15, 19, 34, 37], extra_number: 25},
            {draw_number: "22/021", draw_date: "19/04/2022", numbers: [12, 23, 28, 34, 39, 46], extra_number: 44},
            {draw_number: "22/020", draw_date: "15/04/2022", numbers: [21, 25, 30, 36, 37, 47], extra_number: 42},
            {draw_number: "22/019", draw_date: "12/04/2022", numbers: [8, 11, 12, 20, 26, 30], extra_number: 28},
            {draw_number: "22/018", draw_date: "08/04/2022", numbers: [10, 20, 36, 38, 43, 48], extra_number: 30},
            {draw_number: "22/017", draw_date: "05/04/2022", numbers: [9, 11, 12, 22, 29, 42], extra_number: 3},
            {draw_number: "22/016", draw_date: "01/04/2022", numbers: [4, 8, 21, 40, 46, 49], extra_number: 34},
            {draw_number: "22/015", draw_date: "29/03/2022", numbers: [8, 18, 21, 35, 37, 38], extra_number: 10},
            {draw_number: "22/014", draw_date: "25/03/2022", numbers: [15, 20, 26, 28, 29, 46], extra_number: 12},
            {draw_number: "22/013", draw_date: "22/03/2022", numbers: [6, 28, 32, 33, 40, 45], extra_number: 1},
            {draw_number: "22/012", draw_date: "18/03/2022", numbers: [12, 18, 22, 30, 40, 49], extra_number: 15},
            {draw_number: "22/011", draw_date: "15/03/2022", numbers: [3, 10, 12, 28, 39, 48], extra_number: 17},
            {draw_number: "22/010", draw_date: "11/03/2022", numbers: [11, 20, 23, 29, 38, 47], extra_number: 12},
            {draw_number: "22/009", draw_date: "08/03/2022", numbers: [1, 5, 23, 42, 46, 49], extra_number: 11},
            {draw_number: "22/008", draw_date: "03/03/2022", numbers: [12, 19, 21, 22, 40, 43], extra_number: 46},
            {draw_number: "22/007", draw_date: "24/02/2022", numbers: [2, 9, 11, 12, 16, 24], extra_number: 43},
            {draw_number: "22/006", draw_date: "17/02/2022", numbers: [6, 7, 22, 34, 35, 46], extra_number: 8},
            {draw_number: "22/005", draw_date: "10/02/2022", numbers: [6, 13, 17, 28, 35, 44], extra_number: 5},
            {draw_number: "22/004", draw_date: "05/02/2022", numbers: [15, 18, 21, 25, 39, 43], extra_number: 33},
            {draw_number: "22/003", draw_date: "27/01/2022", numbers: [10, 18, 20, 29, 32, 33], extra_number: 2},
            {draw_number: "22/002", draw_date: "20/01/2022", numbers: [1, 3, 10, 11, 30, 42], extra_number: 39},
            {draw_number: "22/001", draw_date: "04/01/2022", numbers: [2, 8, 12, 14, 20, 47], extra_number: 36}
        ];
console.log('lotteryData', lotteryData.length);

        // 標籤切換功能
        function switchTab(tabName) {
            // 隱藏所有標籤頁
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // 移除所有按鈕的active類別
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 顯示選中的標籤頁
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // 載入對應數據
            if (tabName === 'results') {
                loadResults();
            } else if (tabName === 'statistics') {
                // 初始化範圍選擇介面
                initializeRangeSelection();
                updateStatsWithRange(1, 100); // 預設顯示第1期至第100期
            } else if (tabName === 'verification') {
                // 初始化號碼選擇介面和範圍選擇
                initializeNumberSelection();
                initializeVerificationRangeSelection();
                // 如果是膽腳投注模式，也初始化膽腳網格
                if (currentBettingMode === 'banker') {
                    initializeBankerGrids();
                }
                // 預設載入統計分析結果
                loadVerification();
            } else if (tabName === 'gann-square') {
                // 初始化江恩螺旋四方圖
                initializeGannSquare();
            }
        }

        // 載入開獎結果
        function loadResults() {
            const resultsContent = document.getElementById('results-content');
            
            try {
                let html = `
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>期號</th>
                                <th>開獎日期</th>
                                <th>開獎號碼</th>
                                <th>特別號</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                lotteryData.forEach(row => {
                    const numbers = row.numbers.map(num => 
                        `<span class="number-ball">${num}</span>`
                    ).join('');
                    
                    html += `
                        <tr>
                            <td>${row.draw_number}</td>
                            <td>${row.draw_date}</td>
                            <td>${numbers}</td>
                            <td><span class="number-ball extra-number-ball">${row.extra_number}</span></td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                resultsContent.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading results:', error);
                resultsContent.innerHTML = '<div class="error">載入開獎結果時出現錯誤</div>';
            }
        }

        // 計算數字共現矩陣
        function calculateCoOccurrence(selectedData) {
            const coMatrix = {};
            
            // 初始化共現矩陣
            for (let i = 1; i <= 49; i++) {
                coMatrix[i] = {};
                for (let j = 1; j <= 49; j++) {
                    if (i !== j) coMatrix[i][j] = 0;
                }
            }
            
            // 計算共現次數
            selectedData.forEach(row => {
                const allNumbers = [...row.numbers, row.extra_number];
                
                // 對每一對數字計算共現
                for (let i = 0; i < allNumbers.length; i++) {
                    for (let j = i + 1; j < allNumbers.length; j++) {
                        const num1 = allNumbers[i];
                        const num2 = allNumbers[j];
                        coMatrix[num1][num2]++;
                        coMatrix[num2][num1]++;
                    }
                }
            });
            
            return coMatrix;
        }

        // 獲取與指定數字最常共現的其他數字
        function getTopCoOccurring(number, coMatrix, topN = 5) {
            const coOccurrences = [];
            
            for (let otherNum = 1; otherNum <= 49; otherNum++) {
                if (otherNum !== number) {
                    coOccurrences.push({
                        number: otherNum,
                        frequency: coMatrix[number][otherNum] || 0
                    });
                }
            }
            
            // 按頻率降序排序
            coOccurrences.sort((a, b) => b.frequency - a.frequency);
            
            return coOccurrences.slice(0, topN);
        }

        // 初始化範圍選擇介面
        function initializeRangeSelection() {
            // 設置最大期數限制
            const maxPeriods = lotteryData.length;
            document.getElementById('start-period').max = maxPeriods;
            document.getElementById('end-period').max = maxPeriods;

            // 添加輸入事件監聽器
            document.getElementById('start-period').addEventListener('input', updateRangeInfo);
            document.getElementById('end-period').addEventListener('input', updateRangeInfo);

            // 初始化範圍資訊
            updateRangeInfo();
        }

        // 設置快速範圍選擇
        function setQuickRange(start, end) {
            document.getElementById('start-period').value = start;
            document.getElementById('end-period').value = end;
            updateRangeInfo();
            // 自動執行篩選並更新隨機核心號碼
            filterHighFrequencyNumbers();
        }

        // 下10期按鈕功能 - 將範圍向前移動1期
        function shiftRangeForward(type) {
            let startInput, endInput, updateFunc;
            
            if (type === 'stats') {
                startInput = document.getElementById('start-period');
                endInput = document.getElementById('end-period');
                updateFunc = updateRangeInfo;
            } else if (type === 'verification') {
                startInput = document.getElementById('verification-start-period');
                endInput = document.getElementById('verification-end-period');
                updateFunc = updateVerificationRangeInfo;
            }
            
            const currentStart = parseInt(startInput.value) || 1;
            const currentEnd = parseInt(endInput.value) || 1;
            const maxPeriods = lotteryData.length;
            
            // 計算新的範圍（向前移動1期）
            const newStart = currentStart + 1;
            const newEnd = currentEnd + 1;
            
            // 檢查是否超出範圍
            if (newEnd > maxPeriods) {
                alert(`已達到最大期數範圍！目前最大期數為 ${maxPeriods}`);
                return;
            }
            
            // 更新輸入框的值
            startInput.value = newStart;
            endInput.value = newEnd;
            
            // 更新範圍資訊
            updateFunc();
            
            // 如果是核對中獎頁面，立即更新統計
            if (type === 'verification' && document.getElementById('verification').classList.contains('active')) {
                loadVerification();
            }

            filterHighFrequencyNumbers();
        }

        // 更新篩選模式說明
        function updateFilterModeDescription() {
            const modeSelect = document.getElementById('filter-mode-select');
            const countSelect = document.getElementById('filter-count-select');
            
            const mode = modeSelect.value;
            
            // 預設模式下禁用數量選擇
            if (mode === 'default') {
                countSelect.disabled = true;
                countSelect.style.opacity = '0.5';
            } else {
                countSelect.disabled = false;
                countSelect.style.opacity = '1';
            }
        }

        // 更新範圍資訊顯示
        function updateRangeInfo() {
            const startPeriod = parseInt(document.getElementById('start-period').value) || 1;
            const endPeriod = parseInt(document.getElementById('end-period').value) || 1;

            const periodCount = Math.max(0, endPeriod - startPeriod + 1);

            document.getElementById('period-count').textContent = `統計期數：${periodCount}期`;
            document.getElementById('period-range').textContent = `範圍：第${startPeriod}期 至 第${endPeriod}期`;

            // 驗證範圍
            const applyBtn = document.querySelector('.apply-btn');
            if (startPeriod > endPeriod || periodCount <= 0) {
                applyBtn.disabled = true;
                applyBtn.textContent = '❌ 範圍無效';
            } else if (endPeriod > lotteryData.length) {
                applyBtn.disabled = true;
                applyBtn.textContent = `❌ 超出資料範圍 (最大${lotteryData.length}期)`;
            } else {
                applyBtn.disabled = false;
                applyBtn.textContent = '🔍 應用範圍統計';
            }
        }

        // 應用範圍選擇
        function applyRangeSelection() {
            const startPeriod = parseInt(document.getElementById('start-period').value) || 1;
            const endPeriod = parseInt(document.getElementById('end-period').value) || 1;

            if (startPeriod > endPeriod) {
                alert('開始期數不能大於結束期數！');
                return;
            }

            if (endPeriod > lotteryData.length) {
                alert(`結束期數不能超過資料範圍！目前最大期數為 ${lotteryData.length}`);
                return;
            }

            updateStatsWithRange(startPeriod, endPeriod);
        }

        // 更新統計數據（範圍版本）
        function updateStatsWithRange(startPeriod, endPeriod) {
            const statsContent = document.getElementById('stats-content');

            try {
                // 計算號碼統計
                const numberFreq = {};

                // 初始化1-49的頻率為0
                for (let i = 1; i <= 49; i++) {
                    numberFreq[i] = 0;
                }

                // 計算選定範圍內的號碼頻率
                // 注意：陣列索引從0開始，但期數從1開始，所以需要調整
                const startIndex = startPeriod - 1;
                const endIndex = endPeriod;
                const selectedData = lotteryData.slice(startIndex, endIndex);

                selectedData.forEach(row => {
                    row.numbers.forEach(num => {
                        numberFreq[num]++;
                    });
                    // 特別號也計入統計
                    numberFreq[row.extra_number]++;
                });

                // 計算數字共現矩陣
                const coMatrix = calculateCoOccurrence(selectedData);

                // 轉換為陣列並按頻率排序
                const sortedNumbers = Object.entries(numberFreq)
                    .map(([num, freq]) => ({
                        number: parseInt(num),
                        frequency: freq
                    }))
                    .sort((a, b) => b.frequency - a.frequency);

                // 生成統計網格
                let html = '<div class="stats-grid">';

                sortedNumbers.forEach((item, index) => {
                    const rank = index + 1;
                    let rankClass = '';

                    if (rank <= 7) rankClass = `rank-${rank}`;
                    else if (rank <= 14) rankClass = 'rank-7';
                    else rankClass = 'rank-7';

                    // 獲取與此數字最常共現的其他數字
                    const topCoOccurring = getTopCoOccurring(item.number, coMatrix, 48);

                    html += `
                        <div class="number-stat">
                            <div class="stat-header">
                                <div class="stat-number">${item.number}</div>
                                <div class="stat-info">
                                    <div class="stat-frequency">${item.frequency}次</div>
                                    <div class="stat-rank ${rankClass}">第${rank}名</div>
                                </div>
                            </div>
                            <div class="co-occurrence">
                                <div class="co-occurrence-title">常與以下數字同時出現：</div>
                                <div class="co-numbers">
                    `;

                    if (topCoOccurring.length > 0) {
                        topCoOccurring.forEach(co => {
                            html += `
                                <div class="co-number">
                                    <div class="co-number-ball">${co.number}</div>
                                    <span class="co-frequency">${co.frequency}次</span>
                                </div>
                            `;
                        });
                    } else {
                        html += '<div class="co-number"><span class="co-frequency">暫無共現數據</span></div>';
                    }

                    html += `
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';

                const periodCount = endPeriod - startPeriod + 1;
                statsContent.innerHTML = `
                    <p class="stats-summary">
                        第${startPeriod}期至第${endPeriod}期號碼出現頻率統計與共現分析 (包含特別號)<br>
                        <small>統計期數：${periodCount}期 | 資料範圍：${selectedData.length}筆開獎記錄</small>
                    </p>
                    ${html}
                `;

            } catch (error) {
                console.error('Error updating stats:', error);
                statsContent.innerHTML = '<div class="error">載入統計數據時出現錯誤</div>';
            }
        }

        // 保持向後相容性的舊版 updateStats 函數
        function updateStats(periods) {
            updateStatsWithRange(1, periods);
        }

        // 投注模式切換
        function switchBettingMode(mode) {
            currentBettingMode = mode;

            // 更新標籤頁樣式
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 切換顯示內容
            if (mode === 'complex') {
                document.getElementById('complex-betting-mode').classList.remove('hidden');
                document.getElementById('banker-betting-mode').classList.add('hidden');
            } else {
                document.getElementById('complex-betting-mode').classList.add('hidden');
                document.getElementById('banker-betting-mode').classList.remove('hidden');
                // 初始化膽腳投注網格
                initializeBankerGrids();
            }

            // 更新統計分析
            if (document.getElementById('verification').classList.contains('active')) {
                loadVerification();
            }
        }

        // 初始化膽腳投注網格
        function initializeBankerGrids() {
            const bankerGrid = document.getElementById('banker-grid');
            const runnerGrid = document.getElementById('runner-grid');

            bankerGrid.innerHTML = '';
            runnerGrid.innerHTML = '';

            // 生成膽碼網格
            for (let i = 1; i <= 49; i++) {
                const bankerCell = document.createElement('div');
                bankerCell.className = 'number-cell';
                bankerCell.textContent = i;
                bankerCell.onclick = () => toggleBankerNumber(i);
                bankerGrid.appendChild(bankerCell);

                const runnerCell = document.createElement('div');
                runnerCell.className = 'number-cell';
                runnerCell.textContent = i;
                runnerCell.onclick = () => toggleRunnerNumber(i);
                runnerGrid.appendChild(runnerCell);
            }

            updateBankerDisplay();
        }

        // 切換膽碼選擇
        function toggleBankerNumber(number) {
            const index = bankerNumbers.indexOf(number);

            if (index > -1) {
                // 取消選擇膽碼
                bankerNumbers.splice(index, 1);
            } else {
                // 選擇膽碼
                if (bankerNumbers.length >= maxBankerNumbers) {
                    alert(`膽碼最多只能選擇${maxBankerNumbers}個！`);
                    return;
                }

                // 檢查是否已在腳碼中
                if (runnerNumbers.includes(number)) {
                    alert('該號碼已在腳碼中，不能重複選擇！');
                    return;
                }

                bankerNumbers.push(number);
            }

            updateBankerDisplay();
            updateBankerStatus();
        }

        // 切換腳碼選擇
        function toggleRunnerNumber(number) {
            const index = runnerNumbers.indexOf(number);

            if (index > -1) {
                // 取消選擇腳碼
                runnerNumbers.splice(index, 1);
            } else {
                // 選擇腳碼
                // 檢查是否已在膽碼中
                if (bankerNumbers.includes(number)) {
                    alert('該號碼已在膽碼中，不能重複選擇！');
                    return;
                }

                runnerNumbers.push(number);
            }

            updateBankerDisplay();
            updateBankerStatus();
        }

        // 更新膽腳投注顯示
        function updateBankerDisplay() {
            // 更新膽碼顯示
            const bankerCells = document.querySelectorAll('#banker-grid .number-cell');
            bankerCells.forEach(cell => {
                const number = parseInt(cell.textContent);
                if (bankerNumbers.includes(number)) {
                    cell.classList.add('selected');
                } else {
                    cell.classList.remove('selected');
                }

                // 如果在腳碼中，禁用膽碼選擇
                if (runnerNumbers.includes(number)) {
                    cell.classList.add('disabled');
                } else {
                    cell.classList.remove('disabled');
                }
            });

            // 更新腳碼顯示
            const runnerCells = document.querySelectorAll('#runner-grid .number-cell');
            runnerCells.forEach(cell => {
                const number = parseInt(cell.textContent);
                if (runnerNumbers.includes(number)) {
                    cell.classList.add('selected');
                } else {
                    cell.classList.remove('selected');
                }

                // 如果在膽碼中，禁用腳碼選擇
                if (bankerNumbers.includes(number)) {
                    cell.classList.add('disabled');
                } else {
                    cell.classList.remove('disabled');
                }
            });
        }

        // 更新膽腳投注狀態
        function updateBankerStatus() {
            const bankerCount = bankerNumbers.length;
            const runnerCount = runnerNumbers.length;

            // 計算組合數：C(腳碼數, 6-膽碼數)
            let combinationCount = 0;
            if (bankerCount >= 1 && bankerCount <= 5 && runnerCount >= 1) {
                const needFromRunner = 6 - bankerCount;
                if (needFromRunner <= runnerCount) {
                    combinationCount = getCombinationCount(runnerCount, needFromRunner);
                }
            }

            document.getElementById('banker-count').textContent = `膽碼：${bankerCount}個`;
            document.getElementById('runner-count').textContent = `腳碼：${runnerCount}個`;
            document.getElementById('banker-combination-count').textContent = `總組合：${combinationCount.toLocaleString()}注`;

            // 如果當前在核對中獎標籤頁，自動更新統計分析
            if (document.getElementById('verification').classList.contains('active')) {
                loadVerification();
            }
        }

        // 初始化號碼選擇介面
        function initializeNumberSelection() {
            const numberGrid = document.getElementById('number-grid');
            numberGrid.innerHTML = '';

            // 生成1-49的號碼格子
            for (let i = 1; i <= 49; i++) {
                const numberCell = document.createElement('div');
                numberCell.className = 'number-cell';
                numberCell.textContent = i;
                numberCell.onclick = () => toggleNumber(i);
                numberGrid.appendChild(numberCell);
            }

            // 載入保存的選擇
            loadSavedSelection();
            updateSelectionStatus();
        }

        // 切換號碼選擇狀態
        function toggleNumber(number) {
            const index = selectedNumbers.indexOf(number);

            if (index > -1) {
                // 取消選擇
                selectedNumbers.splice(index, 1);
            } else {
                // 選擇號碼
                if (selectedNumbers.length < maxSelections) {
                    selectedNumbers.push(number);
                } else {
                    alert(`最多只能選擇${maxSelections}個號碼！`);
                    return;
                }
            }

            updateNumberDisplay();
            updateSelectionStatus();
        }

        // 更新號碼顯示狀態
        function updateNumberDisplay() {
            const numberCells = document.querySelectorAll('.number-cell');
            numberCells.forEach(cell => {
                const number = parseInt(cell.textContent);
                if (selectedNumbers.includes(number)) {
                    cell.classList.add('selected');
                } else {
                    cell.classList.remove('selected');
                }
            });
        }

        // 更新選擇狀態顯示
        function updateSelectionStatus() {
            const selectedCount = selectedNumbers.length;
            const combinationCount = selectedCount >= 6 ? getCombinationCount(selectedCount, 6) : 0;

            document.getElementById('selected-count').textContent = `已選擇：${selectedCount}個號碼`;
            document.getElementById('combination-count').textContent = `可組合：${combinationCount.toLocaleString()}注`;

            // 如果當前在核對中獎標籤頁，自動更新統計分析
            if (document.getElementById('verification').classList.contains('active')) {
                loadVerification();
            }
        }

        // 計算組合數
        function getCombinationCount(n, r) {
            if (n < r) return 0;
            if (r === 0 || r === n) return 1;

            let result = 1;
            for (let i = 0; i < r; i++) {
                result = result * (n - i) / (i + 1);
            }
            return Math.round(result);
        }

        // 重置選擇
        function resetSelection() {
            if (currentBettingMode === 'banker') {
                bankerNumbers = [];
                runnerNumbers = [];
                updateBankerDisplay();
                updateBankerStatus();
            } else {
                selectedNumbers = [];
                updateNumberDisplay();
                updateSelectionStatus();
            }
        }

        // 保存選擇到localStorage
        function saveSelection() {
            if (currentBettingMode === 'banker') {
                if (bankerNumbers.length === 0 && runnerNumbers.length === 0) {
                    alert('請先選擇膽碼和腳碼！');
                    return;
                }

                const bankerData = {
                    mode: 'banker',
                    bankerNumbers: [...bankerNumbers],
                    runnerNumbers: [...runnerNumbers]
                };
                localStorage.setItem('savedBankerNumbers', JSON.stringify(bankerData));
                alert(`已保存膽腳投注組合到「我的保存」！`);
            } else {
                if (selectedNumbers.length === 0) {
                    // 如果沒有手動選擇號碼，保存當前統計分析的熱門號碼
                    const startPeriod = parseInt(document.getElementById('verification-start-period').value) || 1;
                    const endPeriod = parseInt(document.getElementById('verification-end-period').value) || 40;
                    
                    const startIndex = startPeriod - 1;
                    const endIndex = endPeriod;
                    const analysisData = lotteryData.slice(startIndex, endIndex);
                    const numberFreq = {};

                    // 初始化1-49的頻率為0
                    for (let i = 1; i <= 49; i++) {
                        numberFreq[i] = 0;
                    }

                    // 計算號碼頻率（包含特別號）
                    analysisData.forEach(row => {
                        row.numbers.forEach(num => {
                            numberFreq[num]++;
                        });
                        // 特別號也計入統計
                        numberFreq[row.extra_number]++;
                    });

                    // 轉換為陣列並按頻率排序，取前10名
                    const sortedNumbers = Object.entries(numberFreq)
                        .map(([num, freq]) => ({
                            number: parseInt(num),
                            frequency: freq
                        }))
                        .sort((a, b) => b.frequency - a.frequency)
                        .slice(0, 10);

                    const analysisNumbers = sortedNumbers.map(item => item.number);
                    
                    localStorage.setItem('savedLotteryNumbers', JSON.stringify(analysisNumbers));
                    quickSelections.saved = [...analysisNumbers];
                    alert(`已保存統計分析的${analysisNumbers.length}個熱門號碼到「我的保存」！\n號碼：${analysisNumbers.sort((a, b) => a - b).join(', ')}`);
                } else {
                    localStorage.setItem('savedLotteryNumbers', JSON.stringify(selectedNumbers));
                    quickSelections.saved = [...selectedNumbers];
                    alert(`已保存${selectedNumbers.length}個號碼到「我的保存」！`);
                }
            }
        }

        // 載入保存的選擇
        function loadSavedSelection() {
            const saved = localStorage.getItem('savedLotteryNumbers');
            if (saved) {
                quickSelections.saved = JSON.parse(saved);
            }
        }

        // 載入保存的膽腳投注
        function loadSavedBankerSelection() {
            const saved = localStorage.getItem('savedBankerNumbers');
            if (saved) {
                return JSON.parse(saved);
            }
            return null;
        }

        // 快速選擇預設組合
        function loadQuickSelection(type) {
            if (currentBettingMode === 'banker') {
                if (type === 'saved') {
                    const savedBanker = loadSavedBankerSelection();
                    if (!savedBanker) {
                        alert('尚未保存任何膽腳投注組合！');
                        return;
                    }
                    bankerNumbers = [...savedBanker.bankerNumbers];
                    runnerNumbers = [...savedBanker.runnerNumbers];
                    updateBankerDisplay();
                    updateBankerStatus();
                } else {
                    // 為膽腳投注模式適配其他快速選擇
                    const numbers = quickSelections[type];
                    if (!numbers || numbers.length === 0) {
                        alert('該組合暫無數據！');
                        return;
                    }

                    // 將前3個作為膽碼，其餘作為腳碼
                    bankerNumbers = numbers.slice(0, Math.min(3, numbers.length));
                    runnerNumbers = numbers.slice(3);

                    // 如果腳碼不足，將部分膽碼移到腳碼
                    if (runnerNumbers.length === 0 && bankerNumbers.length > 1) {
                        runnerNumbers = bankerNumbers.slice(1);
                        bankerNumbers = bankerNumbers.slice(0, 1);
                    }

                    updateBankerDisplay();
                    updateBankerStatus();
                }
            } else {
                if (type === 'saved') {
                    // 從 localStorage 重新載入保存的號碼
                    const saved = localStorage.getItem('savedLotteryNumbers');
                    if (!saved) {
                        alert('尚未保存任何號碼組合！');
                        return;
                    }
                    const savedNumbers = JSON.parse(saved);
                    quickSelections.saved = [...savedNumbers];
                    selectedNumbers = [...savedNumbers];
                    updateNumberDisplay();
                    updateSelectionStatus();
                    alert(`已載入保存的${savedNumbers.length}個號碼：${savedNumbers.sort((a, b) => a - b).join(', ')}`);
                } else {
                    const numbers = quickSelections[type];
                    if (!numbers || numbers.length === 0) {
                        alert('該組合暫無數據！');
                        return;
                    }

                    selectedNumbers = [...numbers];
                    updateNumberDisplay();
                    updateSelectionStatus(); // 這會自動觸發統計分析更新
                }
            }
        }

        // 初始化核對中獎頁面的範圍選擇介面
        function initializeVerificationRangeSelection() {
            // 設置最大期數限制
            const maxPeriods = lotteryData.length;
            document.getElementById('verification-start-period').max = maxPeriods;
            document.getElementById('verification-end-period').max = maxPeriods;

            // 添加輸入事件監聽器
            document.getElementById('verification-start-period').addEventListener('input', updateVerificationRangeInfo);
            document.getElementById('verification-end-period').addEventListener('input', updateVerificationRangeInfo);

            // 初始化範圍資訊
            updateVerificationRangeInfo();
        }

        // 設置核對中獎頁面的快速範圍選擇
        function setVerificationQuickRange(start, end) {
            document.getElementById('verification-start-period').value = start;
            document.getElementById('verification-end-period').value = end;
            updateVerificationRangeInfo();

            // 立即更新統計分析（快速選擇不需要延遲）
            if (document.getElementById('verification').classList.contains('active')) {
                loadVerification();
            }
        }

        // 更新核對中獎頁面的範圍資訊顯示
        function updateVerificationRangeInfo() {
            const startPeriod = parseInt(document.getElementById('verification-start-period').value) || 1;
            const endPeriod = parseInt(document.getElementById('verification-end-period').value) || 1;

            const periodCount = Math.max(0, endPeriod - startPeriod + 1);

            document.getElementById('verification-period-count').textContent = `統計期數：${periodCount}期`;
            document.getElementById('verification-period-range').textContent = `範圍：第${startPeriod}期 至 第${endPeriod}期`;
        }

        // 新的複式中獎計算函數
        function calculateComplexWinnings() {
            let allCombinations;
            let totalCombinations;
            let analysisNumbers;

            // 根據投注模式驗證和生成組合
            if (currentBettingMode === 'banker') {
                // 膽腳投注模式驗證
                if (bankerNumbers.length < 1 || bankerNumbers.length > 5) {
                    alert('請選擇1-5個膽碼！');
                    return;
                }
                if (runnerNumbers.length < 1) {
                    alert('請至少選擇1個腳碼！');
                    return;
                }
                const needFromRunner = 6 - bankerNumbers.length;
                if (needFromRunner > runnerNumbers.length) {
                    alert('膽碼和腳碼組合不足6個號碼！');
                    return;
                }

                analysisNumbers = [...bankerNumbers, ...runnerNumbers].sort((a, b) => a - b);
                allCombinations = generateBankerCombinations(bankerNumbers, runnerNumbers);
                totalCombinations = allCombinations.length;
            } else {
                // 複式投注模式驗證
                if (selectedNumbers.length < 6) {
                    alert('請至少選擇6個號碼！');
                    return;
                }

                analysisNumbers = [...selectedNumbers];
                allCombinations = getCombinations(selectedNumbers, 6);
                totalCombinations = allCombinations.length;
            }

            // 獲取期數範圍
            const startPeriod = parseInt(document.getElementById('verification-start-period').value) || 1;
            const endPeriod = parseInt(document.getElementById('verification-end-period').value) || 40;

            if (startPeriod > endPeriod) {
                alert('開始期數不能大於結束期數！');
                return;
            }

            if (endPeriod > lotteryData.length) {
                alert(`結束期數不能超過資料範圍！目前最大期數為 ${lotteryData.length}`);
                return;
            }

            // 獎金標準
            const prizeAmounts = {
                first: 8000000,   // 頭獎：$8,000,000
                second: 1000000,  // 二獎：$1,000,000
                third: 35000,     // 三獎：$35,000
                fourth: 9600,     // 四獎：$9,600
                fifth: 640,       // 五獎：$640
                sixth: 320,       // 六獎：$320
                seventh: 40       // 七獎：$40
            };

            const betCost = 10; // 每注成本：$10

            // 計算選定範圍內的中獎情況
            const startIndex = startPeriod - 1;
            const endIndex = endPeriod;
            const selectedData = lotteryData.slice(startIndex, endIndex);

            let totalWinnings = {
                first: 0, second: 0, third: 0, fourth: 0, fifth: 0, sixth: 0, seventh: 0
            };

            let totalWinCount = {
                first: 0, second: 0, third: 0, fourth: 0, fifth: 0, sixth: 0, seventh: 0
            };

            // 檢查每期的中獎情況
            selectedData.forEach(draw => {
                const winningNumbers = draw.numbers.sort((a, b) => a - b);
                const extraNumber = draw.extra_number;

                // 檢查每個組合
                allCombinations.forEach(combo => {
                    const mainMatches = combo.filter(num => winningNumbers.includes(num)).length;
                    const extraMatch = combo.includes(extraNumber);

                    // 判定獎項
                    if (mainMatches === 6) {
                        totalWinCount.first++;
                        totalWinnings.first += prizeAmounts.first;
                    } else if (mainMatches === 5 && extraMatch) {
                        totalWinCount.second++;
                        totalWinnings.second += prizeAmounts.second;
                    } else if (mainMatches === 5) {
                        totalWinCount.third++;
                        totalWinnings.third += prizeAmounts.third;
                    } else if (mainMatches === 4 && extraMatch) {
                        totalWinCount.fourth++;
                        totalWinnings.fourth += prizeAmounts.fourth;
                    } else if (mainMatches === 4) {
                        totalWinCount.fifth++;
                        totalWinnings.fifth += prizeAmounts.fifth;
                    } else if (mainMatches === 3 && extraMatch) {
                        totalWinCount.sixth++;
                        totalWinnings.sixth += prizeAmounts.sixth;
                    } else if (mainMatches === 3) {
                        totalWinCount.seventh++;
                        totalWinnings.seventh += prizeAmounts.seventh;
                    }
                });
            });

            // 計算總投注成本和收益
            const totalCost = totalCombinations * selectedData.length * betCost;
            const totalPrize = Object.values(totalWinnings).reduce((sum, amount) => sum + amount, 0);
            const netProfit = totalPrize - totalCost;
            const roi = totalCost > 0 ? ((netProfit / totalCost) * 100) : 0;

            // 顯示彈窗
            showWinningsModal({
                selectedNumbers: analysisNumbers,
                totalCombinations,
                periodRange: { start: startPeriod, end: endPeriod, count: selectedData.length },
                winCount: totalWinCount,
                winnings: totalWinnings,
                prizeAmounts,
                totalCost,
                totalPrize,
                netProfit,
                roi,
                bettingMode: currentBettingMode,
                bankerNumbers: currentBettingMode === 'banker' ? bankerNumbers : null,
                runnerNumbers: currentBettingMode === 'banker' ? runnerNumbers : null
            });
        }

        // 顯示派彩獎金彈窗
        function showWinningsModal(data) {
            const modal = document.getElementById('winnings-modal');
            const detailsDiv = document.getElementById('winnings-details');

            // 生成選擇的號碼顯示
            let selectedNumbersHtml;
            if (data.bettingMode === 'banker') {
                const bankerHtml = data.bankerNumbers.map(num =>
                    `<span class="number-ball number-ball-banker">${num}</span>`
                ).join('');
                const runnerHtml = data.runnerNumbers.map(num =>
                    `<span class="number-ball number-ball-runner">${num}</span>`
                ).join('');
                selectedNumbersHtml = `
                    <div class="margin-bottom-10">
                        <strong>膽碼：</strong>${bankerHtml}
                    </div>
                    <div>
                        <strong>腳碼：</strong>${runnerHtml}
                    </div>
                `;
            } else {
                selectedNumbersHtml = data.selectedNumbers.map(num =>
                    `<span class="number-ball number-ball-margin">${num}</span>`
                ).join('');
            }

            // 生成獎項明細表格
            const prizeDetails = [
                { name: '頭獎', condition: '中6個正選號碼', count: data.winCount.first, amount: data.prizeAmounts.first, total: data.winnings.first },
                { name: '二獎', condition: '中5個正選號碼 + 特別號', count: data.winCount.second, amount: data.prizeAmounts.second, total: data.winnings.second },
                { name: '三獎', condition: '中5個正選號碼', count: data.winCount.third, amount: data.prizeAmounts.third, total: data.winnings.third },
                { name: '四獎', condition: '中4個正選號碼 + 特別號', count: data.winCount.fourth, amount: data.prizeAmounts.fourth, total: data.winnings.fourth },
                { name: '五獎', condition: '中4個正選號碼', count: data.winCount.fifth, amount: data.prizeAmounts.fifth, total: data.winnings.fifth },
                { name: '六獎', condition: '中3個正選號碼 + 特別號', count: data.winCount.sixth, amount: data.prizeAmounts.sixth, total: data.winnings.sixth },
                { name: '七獎', condition: '中3個正選號碼', count: data.winCount.seventh, amount: data.prizeAmounts.seventh, total: data.winnings.seventh }
            ];

            let prizeTableHtml = '';
            prizeDetails.forEach(prize => {
                const rowClass = prize.count > 0 ? 'class="winnings-row-highlight"' : '';
                const countClass = prize.count > 0 ? 'winnings-cell-success' : 'winnings-cell-muted';
                const totalClass = prize.total > 0 ? 'winnings-cell-success' : 'winnings-cell-muted';
                prizeTableHtml += `
                    <tr ${rowClass}>
                        <td class="winnings-cell-bold">${prize.name}</td>
                        <td>${prize.condition}</td>
                        <td class="${countClass}">${prize.count}</td>
                        <td>$${prize.amount.toLocaleString()}</td>
                        <td class="${totalClass}">$${prize.total.toLocaleString()}</td>
                    </tr>
                `;
            });

            // 計算總中獎注數
            const totalWinCount = Object.values(data.winCount).reduce((sum, count) => sum + count, 0);
            const profitClass = data.netProfit >= 0 ? 'winnings-summary-positive' : 'winnings-summary-negative';
            const roiClass = data.roi >= 0 ? 'winnings-summary-positive' : 'winnings-summary-negative';

            detailsDiv.innerHTML = `
                <div class="winnings-section">
                    <h3 class="winnings-section-title">📋 投注詳情</h3>
                    <div class="winnings-info-box">
                        <p><strong>${data.bettingMode === 'banker' ? '膽腳號碼：' : '選擇號碼：'}</strong>${selectedNumbersHtml}</p>
                        <p><strong>${data.bettingMode === 'banker' ? '膽腳組合：' : '複式組合：'}</strong>${data.bettingMode === 'banker' ?
                            `膽碼${data.bankerNumbers.length}個 + 腳碼${data.runnerNumbers.length}個選${6-data.bankerNumbers.length}個 = ${data.totalCombinations.toLocaleString()}注` :
                            `從${data.selectedNumbers.length}個號碼中選6個 = ${data.totalCombinations.toLocaleString()}注`}</p>
                        <p><strong>統計期數：</strong>第${data.periodRange.start}期 至 第${data.periodRange.end}期 (共${data.periodRange.count}期)</p>
                        <p><strong>總投注：</strong>${data.totalCombinations.toLocaleString()}注 × ${data.periodRange.count}期 × $10 = $${data.totalCost.toLocaleString()}</p>
                    </div>
                </div>

                <div class="winnings-section">
                    <h3 class="winnings-section-title">🏆 中獎明細</h3>
                    <table class="winnings-table">
                        <thead>
                            <tr class="winnings-table-header">
                                <th>獎項</th>
                                <th>中獎條件</th>
                                <th>中獎注數</th>
                                <th>單注獎金</th>
                                <th>小計</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${prizeTableHtml}
                        </tbody>
                    </table>
                </div>

                <div class="winnings-summary">
                    <h3 class="winnings-summary-title">💰 收益總結</h3>
                    <div class="winnings-summary-grid">
                        <div>
                            <div class="winnings-summary-label">總投注成本</div>
                            <div class="winnings-summary-value">$${data.totalCost.toLocaleString()}</div>
                        </div>
                        <div>
                            <div class="winnings-summary-label">總中獎金額</div>
                            <div class="winnings-summary-value">$${data.totalPrize.toLocaleString()}</div>
                        </div>
                        <div>
                            <div class="winnings-summary-label">淨收益</div>
                            <div class="winnings-summary-value ${profitClass}">
                                ${data.netProfit >= 0 ? '+' : ''}$${data.netProfit.toLocaleString()}
                            </div>
                        </div>
                        <div>
                            <div class="winnings-summary-label">投資回報率</div>
                            <div class="winnings-summary-value ${roiClass}">
                                ${data.roi >= 0 ? '+' : ''}${data.roi.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                    <div class="winnings-summary-footer">
                        <p class="winnings-summary-note">
                            總中獎注數：${totalWinCount.toLocaleString()}注 |
                            中獎率：${((totalWinCount / (data.totalCombinations * data.periodRange.count)) * 100).toFixed(4)}%
                        </p>
                    </div>
                </div>
            `;

            modal.style.display = 'block';
        }

        // 關閉派彩獎金彈窗
        function closeWinningsModal() {
            document.getElementById('winnings-modal').style.display = 'none';
        }

        // 點擊彈窗外部關閉
        window.onclick = function(event) {
            const modal = document.getElementById('winnings-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // 計算組合數（從n個數字中選r個的組合數）
        function getCombinations(arr, size) {
            function combine(start, combo) {
                if (combo.length === size) {
                    return [combo.slice()];
                }
                
                let combinations = [];
                for (let i = start; i < arr.length; i++) {
                    combo.push(arr[i]);
                    combinations = combinations.concat(combine(i + 1, combo));
                    combo.pop();
                }
                return combinations;
            }
            
            return combine(0, []);
        }

        // 生成膽腳投注組合
        function generateBankerCombinations(bankerNumbers, runnerNumbers) {
            const needFromRunner = 6 - bankerNumbers.length;
            const runnerCombinations = getCombinations(runnerNumbers, needFromRunner);

            return runnerCombinations.map(runnerCombo => {
                return [...bankerNumbers, ...runnerCombo].sort((a, b) => a - b);
            });
        }

        // 複式投注計算功能
        function calculateCustomComplex() {
            const verificationContent = document.getElementById('verification-content');
            
            try {
                // 複式投注號碼（16個號碼）
                // const complexNumbers = [5, 6, 9, 13, 19, 25, 26, 30, 32, 35, 36, 39, 40, 44, 45, 46];
                // [29,26,13,17,35,6,12,45,34,9,5,23]
                // const complexNumbers = [3, 7, 11, 12, 13, 20, 21, 22, 23, 24, 27, 30];
                // const complexNumbers = [25,6,12,19,22,26,27,29,32,34,46];
                //  const complexNumbers = [22,11,23,25,26,29,32,34,19,31,35];
                const complexNumbers = [3, 7, 11, 13, 20, 21, 22, 23, 24, 27, 30];

                // 生成所有複式組合（從16個號碼中選6個）
                const allCombinations = getCombinations(complexNumbers, 6);
                
                const totalCombinations = allCombinations.length; // 應該是8008注
                
                // 檢查最新10期的中獎情況
                const latestData = lotteryData.slice(0, 40); // 最新10期
                const prizeResults = [];
                
                latestData.forEach((draw, drawIndex) => {
                    const winningNumbers = draw.numbers.sort((a, b) => a - b);
                    const extraNumber = draw.extra_number;
                    
                    let firstPrize = 0;  // 頭獎：6個正選號碼全中
                    let secondPrize = 0; // 二獎：5個正選號碼 + 特別號
                    let thirdPrize = 0;  // 三獎：5個正選號碼
                    let fourPrize = 0;  // 四獎：4個正選號碼 + 特別號
                    let fivePrize = 0;  // 五獎：4個正選號碼 + 特別號
                    let sixPrize = 0;  // 六獎：4個正選號碼 + 特別號
                    let sevenPrize = 0;  // 七獎：4個正選號碼 + 特別號
                    
                    // 檢查每個組合
                    allCombinations.forEach(combo => {
                        // 計算正選號碼匹配數
                        const mainMatches = combo.filter(num => winningNumbers.includes(num)).length;
                        
                        // 計算特別號匹配
                        const extraMatch = combo.includes(extraNumber);
                        
                        // 判定獎項
                        if (mainMatches === 6) {
                            firstPrize++;
                        } else if (mainMatches === 5 && extraMatch) {
                            secondPrize++;
                        } else if (mainMatches === 5) {
                            thirdPrize++;
                        } else if (mainMatches === 4 && extraMatch) {
                            fourPrize++;
                        } else if (mainMatches === 4) {
                            fivePrize++;
                        } else if (mainMatches === 3 && extraMatch) {
                            sixPrize++;
                        }else if (mainMatches === 3) {
                            sevenPrize++;
                        }
                    });
                    
                    prizeResults.push({
                        drawNumber: draw.draw_number,
                        drawDate: draw.draw_date,
                        winningNumbers: winningNumbers,
                        extraNumber: extraNumber,
                        firstPrize,
                        secondPrize,
                        thirdPrize,
                        fourPrize,
                        fivePrize,
                        sixPrize,
                        sevenPrize
                    });
                });
                
                // 計算總中獎統計
                const totalStats = {
                    firstPrize: prizeResults.reduce((sum, result) => sum + result.firstPrize, 0),
                    secondPrize: prizeResults.reduce((sum, result) => sum + result.secondPrize, 0),
                    thirdPrize: prizeResults.reduce((sum, result) => sum + result.thirdPrize, 0),
                    fourPrize: prizeResults.reduce((sum, result) => sum + result.fourPrize, 0),
                    fivePrize: prizeResults.reduce((sum, result) => sum + result.fivePrize, 0),
                    sixPrize: prizeResults.reduce((sum, result) => sum + result.sixPrize, 0),
                    sevenPrize: prizeResults.reduce((sum, result) => sum + result.sevenPrize, 0)
                };
                
                // 生成顯示內容
                let html = `
                    <div class="stats-intro">
                        <p class="stats-intro-text">
                            複式投注結果：從11個號碼中選6個的所有組合<br>
                            總共${totalCombinations}注，檢查最新10期的中獎情況
                        </p>
                        <div class="stats-highlight-box">
                            <strong>投注詳情：</strong> 
                            <span class="stats-highlight-primary">11個號碼複式投注</span> 
                            <span class="stats-highlight-success">C(11,6) = ${totalCombinations}注</span>
                        </div>
                    </div>
                    
                    <!-- 總統計 -->
                    <div class="stats-cards-container">
                        <div class="stats-card stats-card-first">
                            <div class="stats-card-value">${totalStats.firstPrize}</div>
                            <div class="stats-card-label">頭獎次數</div>
                        </div>
                        <div class="stats-card stats-card-second">
                            <div class="stats-card-value">${totalStats.secondPrize}</div>
                            <div class="stats-card-label">二獎次數</div>
                        </div>
                        <div class="stats-card stats-card-third">
                            <div class="stats-card-value">${totalStats.thirdPrize}</div>
                            <div class="stats-card-label">三獎次數</div>
                        </div>
                        <div class="stats-card stats-card-fourth">
                            <div class="stats-card-value">${totalStats.fourPrize}</div>
                            <div class="stats-card-label">四獎次數</div>
                        </div>
                        <div class="stats-card stats-card-fifth">
                            <div class="stats-card-value">${totalStats.fivePrize}</div>
                            <div class="stats-card-label">五獎次數</div>
                        </div>
                        <div class="stats-card stats-card-sixth">
                            <div class="stats-card-value">${totalStats.sixPrize}</div>
                            <div class="stats-card-label">六獎次數</div>
                        </div>
                        <div class="stats-card stats-card-seventh">
                            <div class="stats-card-value">${totalStats.sevenPrize}</div>
                            <div class="stats-card-label">七獎次數</div>
                        </div>
                        <div class="stats-card stats-card-total">
                            <div class="stats-card-value">${totalCombinations}</div>
                            <div class="stats-card-label">總注數</div>
                        </div>
                    </div>
                    
                    <!-- 詳細結果 -->
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>期號</th>
                                <th>開獎日期</th>
                                <th>開獎號碼</th>
                                <th>特別號</th>
                                <th>頭獎</th>
                                <th>二獎</th>
                                <th>三獎</th>
                                <th>四獎</th>
                                <th>五獎</th>
                                <th>六獎</th>
                                <th>七獎</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                prizeResults.forEach(result => {
                    const numbers = result.winningNumbers.map(num => 
                        `<span class="number-ball">${num}</span>`
                    ).join('');
                    
                    html += `
                        <tr>
                            <td>${result.drawNumber}</td>
                            <td>${result.drawDate}</td>
                            <td>${numbers}</td>
                            <td><span class="number-ball extra-number-ball">${result.extraNumber}</span></td>
                            <td class="${result.firstPrize > 0 ? 'result-first-prize' : 'result-no-prize'}">${result.firstPrize}</td>
                            <td class="${result.secondPrize > 0 ? 'result-second-prize' : 'result-no-prize'}">${result.secondPrize}</td>
                            <td class="${result.thirdPrize > 0 ? 'result-other-prize' : 'result-no-prize'}">${result.thirdPrize}</td>
                            <td class="${result.fourPrize > 0 ? 'result-first-prize' : 'result-no-prize'}">${result.fourPrize}</td>
                            <td class="${result.fivePrize > 0 ? 'result-second-prize' : 'result-no-prize'}">${result.fivePrize}</td>
                            <td class="${result.sixPrize > 0 ? 'result-other-prize' : 'result-no-prize'}">${result.sixPrize}</td>
                            <td class="${result.sevenPrize > 0 ? 'result-other-prize' : 'result-no-prize'}">${result.sevenPrize}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                
                verificationContent.innerHTML = html;
                
            } catch (error) {
                console.error('Error calculating complex:', error);
                verificationContent.innerHTML = '<div class="error">計算複式投注時出現錯誤</div>';
            }
        }

        // 核對中獎功能 - 統計分析
        function loadVerification() {
            const verificationContent = document.getElementById('verification-content');

            try {
                // 獲取用戶設定的期數範圍
                const startPeriod = parseInt(document.getElementById('verification-start-period').value) || 1;
                const endPeriod = parseInt(document.getElementById('verification-end-period').value) || 40;

                if (startPeriod > endPeriod) {
                    verificationContent.innerHTML = '<div class="error">開始期數不能大於結束期數！</div>';
                    return;
                }

                if (endPeriod > lotteryData.length) {
                    verificationContent.innerHTML = `<div class="error">結束期數不能超過資料範圍！目前最大期數為 ${lotteryData.length}</div>`;
                    return;
                }

                // 根據投注模式獲取分析號碼
                let analysisNumbers;
                let allCombinations;
                let totalCombinations;

                if (currentBettingMode === 'banker') {
                    // 膽腳投注模式
                    if (bankerNumbers.length >= 1 && bankerNumbers.length <= 5 && runnerNumbers.length >= 1) {
                        const needFromRunner = 6 - bankerNumbers.length;
                        if (needFromRunner <= runnerNumbers.length) {
                            analysisNumbers = [...bankerNumbers, ...runnerNumbers].sort((a, b) => a - b);
                            // 生成膽腳組合
                            allCombinations = generateBankerCombinations(bankerNumbers, runnerNumbers);
                            totalCombinations = allCombinations.length;
                            
                            // 驗證組合數計算是否正確
                            const expectedCombinations = getCombinationCount(runnerNumbers.length, needFromRunner);
                            if (totalCombinations !== expectedCombinations) {
                                console.warn(`膽腳投注組合數不一致：實際=${totalCombinations}, 理論=${expectedCombinations}`);
                                // 使用理論值確保正確性
                                totalCombinations = expectedCombinations;
                            }
                        } else {
                            verificationContent.innerHTML = '<div class="error">膽碼和腳碼組合不足6個號碼！</div>';
                            return;
                        }
                    } else {
                        verificationContent.innerHTML = '<div class="error">請選擇1-5個膽碼和至少1個腳碼！</div>';
                        return;
                    }
                } else if (selectedNumbers.length >= 6) {
                    // 複式投注模式 - 使用用戶選擇的號碼
                    analysisNumbers = [...selectedNumbers];
                    allCombinations = getCombinations(analysisNumbers, 6);
                    totalCombinations = allCombinations.length;
                } else {
                    // 根據指定期數範圍統計選出最熱門的10個號碼
                    const startIndex = startPeriod - 1;
                    const endIndex = endPeriod;
                    const analysisData = lotteryData.slice(startIndex, endIndex);
                    const numberFreq = {};

                    // 初始化1-49的頻率為0
                    for (let i = 1; i <= 49; i++) {
                        numberFreq[i] = 0;
                    }

                    // 計算號碼頻率（包含特別號）
                    analysisData.forEach(row => {
                        row.numbers.forEach(num => {
                            numberFreq[num]++;
                        });
                        // 特別號也計入統計
                        numberFreq[row.extra_number]++;
                    });

                    // 轉換為陣列並按頻率排序，取前10名
                    const sortedNumbers = Object.entries(numberFreq)
                        .map(([num, freq]) => ({
                            number: parseInt(num),
                            frequency: freq
                        }))
                        .sort((a, b) => b.frequency - a.frequency)
                        .slice(0, 10);

                    analysisNumbers = sortedNumbers.map(item => item.number);
                    // 生成所有可能的6個號碼組合
                    allCombinations = getCombinations(analysisNumbers, 6);
                    totalCombinations = allCombinations.length;
                }

                // 計算指定期數範圍內的中獎情況
                const startIndex = startPeriod - 1;
                const endIndex = endPeriod;
                const selectedData = lotteryData.slice(startIndex, endIndex);
                const prizeResults = [];

                // 獎金標準
                const prizeAmounts = {
                    first: 8000000,   // 頭獎：$8,000,000
                    second: 1000000,  // 二獎：$1,000,000
                    third: 35000,     // 三獎：$35,000
                    fourth: 9600,     // 四獎：$9,600
                    fifth: 640,       // 五獎：$640
                    sixth: 320,       // 六獎：$320
                    seventh: 40       // 七獎：$40
                };

                selectedData.forEach((draw, drawIndex) => {
                    const winningNumbers = draw.numbers.sort((a, b) => a - b);
                    const extraNumber = draw.extra_number;

                    let firstPrize = 0;   // 頭獎：6個正選號碼全中
                    let secondPrize = 0;  // 二獎：5個正選號碼 + 特別號
                    let thirdPrize = 0;   // 三獎：5個正選號碼
                    let fourthPrize = 0;  // 四獎：4個正選號碼 + 特別號
                    let fifthPrize = 0;   // 五獎：4個正選號碼
                    let sixthPrize = 0;   // 六獎：3個正選號碼 + 特別號
                    let seventhPrize = 0; // 七獎：3個正選號碼

                    // 檢查每個組合
                    allCombinations.forEach(combo => {
                        const sortedCombo = combo.sort((a, b) => a - b);

                        // 計算正選號碼匹配數
                        const mainMatches = sortedCombo.filter(num => winningNumbers.includes(num)).length;

                        // 計算特別號匹配
                        const extraMatch = sortedCombo.includes(extraNumber);

                        // 判定獎項
                        if (mainMatches === 6) {
                            firstPrize++;
                        } else if (mainMatches === 5 && extraMatch) {
                            secondPrize++;
                        } else if (mainMatches === 5) {
                            thirdPrize++;
                        } else if (mainMatches === 4 && extraMatch) {
                            fourthPrize++;
                        } else if (mainMatches === 4) {
                            fifthPrize++;
                        } else if (mainMatches === 3 && extraMatch) {
                            sixthPrize++;
                        } else if (mainMatches === 3) {
                            seventhPrize++;
                        }
                    });

                    prizeResults.push({
                        drawNumber: draw.draw_number,
                        drawDate: draw.draw_date,
                        winningNumbers: winningNumbers,
                        extraNumber: extraNumber,
                        firstPrize,
                        secondPrize,
                        thirdPrize,
                        fourthPrize,
                        fifthPrize,
                        sixthPrize,
                        seventhPrize
                    });
                });

                // 計算總中獎次數和總獎金
                const totals = {
                    first: prizeResults.reduce((sum, result) => sum + result.firstPrize, 0),
                    second: prizeResults.reduce((sum, result) => sum + result.secondPrize, 0),
                    third: prizeResults.reduce((sum, result) => sum + result.thirdPrize, 0),
                    fourth: prizeResults.reduce((sum, result) => sum + result.fourthPrize, 0),
                    fifth: prizeResults.reduce((sum, result) => sum + result.fifthPrize, 0),
                    sixth: prizeResults.reduce((sum, result) => sum + result.sixthPrize, 0),
                    seventh: prizeResults.reduce((sum, result) => sum + result.seventhPrize, 0)
                };

                const totalWinnings =
                    totals.first * prizeAmounts.first +
                    totals.second * prizeAmounts.second +
                    totals.third * prizeAmounts.third +
                    totals.fourth * prizeAmounts.fourth +
                    totals.fifth * prizeAmounts.fifth +
                    totals.sixth * prizeAmounts.sixth +
                    totals.seventh * prizeAmounts.seventh;

                const totalCost = totalCombinations * selectedData.length * 10; // 每注$10
                const netProfit = totalWinnings - totalCost;

                // 生成顯示內容
                const profitClass = netProfit >= 0 ? 'profit-positive' : 'profit-negative';
                let html = `
                    <div class="verification-intro">
                        <p class="verification-text">
                            ${currentBettingMode === 'banker' ? '使用您選擇的膽腳投注號碼' :
                              (selectedNumbers.length >= 6 ? '使用您選擇的號碼' : `根據第${startPeriod}期至第${endPeriod}期統計選出最熱門的${analysisNumbers.length}個號碼`)}<br>
                            模擬${currentBettingMode === 'banker' ? '膽腳' : '複式'}投注（${totalCombinations.toLocaleString()}注），統計第${startPeriod}期至第${endPeriod}期的中獎情況
                        </p>
                        <div class="stats-highlight-box">
                            <strong>分析號碼：</strong>
                `;

                // 將分析號碼排序後顯示
                analysisNumbers.sort((a, b) => a - b).forEach(num => {
                    html += `<span class="number-ball number-ball-margin">${num}</span>`;
                });

                html += `
                        </div>
                        <div class="verification-details">
                            <strong>統計範圍：</strong>第${startPeriod}期 至 第${endPeriod}期 (共${selectedData.length}期) |
                            <strong>總投注成本：</strong>$${totalCost.toLocaleString()} |
                            <strong>總獎金：</strong>$${totalWinnings.toLocaleString()} |
                            <strong>淨收益：</strong><span class="${profitClass}">${netProfit >= 0 ? '+' : ''}$${netProfit.toLocaleString()}</span>
                        </div>
                    </div>
                `;

                // 統計摘要 - 七個獎項
                html += `
                    <div class="stats-grid-compact">
                        <div class="stat-card-compact stat-card-compact-first">
                            <div class="stat-card-value-lg">${totals.first}</div>
                            <div class="stat-card-label-sm">頭獎次數</div>
                        </div>
                        <div class="stat-card-compact stat-card-compact-second">
                            <div class="stat-card-value-lg">${totals.second}</div>
                            <div class="stat-card-label-sm">二獎次數</div>
                        </div>
                        <div class="stat-card-compact stat-card-compact-third">
                            <div class="stat-card-value-lg">${totals.third}</div>
                            <div class="stat-card-label-sm">三獎次數</div>
                        </div>
                        <div class="stat-card-compact stat-card-compact-fourth">
                            <div class="stat-card-value-lg">${totals.fourth}</div>
                            <div class="stat-card-label-sm">四獎次數</div>
                        </div>
                        <div class="stat-card-compact stat-card-compact-fifth">
                            <div class="stat-card-value-lg">${totals.fifth}</div>
                            <div class="stat-card-label-sm">五獎次數</div>
                        </div>
                        <div class="stat-card-compact stat-card-compact-sixth">
                            <div class="stat-card-value-lg">${totals.sixth}</div>
                            <div class="stat-card-label-sm">六獎次數</div>
                        </div>
                        <div class="stat-card-compact stat-card-compact-seventh">
                            <div class="stat-card-value-lg">${totals.seventh}</div>
                            <div class="stat-card-label-sm">七獎次數</div>
                        </div>
                    </div>
                `;

                // 詳細結果表格
                html += `
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>期號</th>
                                <th>開獎日期</th>
                                <th>開獎號碼</th>
                                <th>特別號</th>
                                <th>頭獎</th>
                                <th>二獎</th>
                                <th>三獎</th>
                                <th>四獎</th>
                                <th>五獎</th>
                                <th>六獎</th>
                                <th>七獎</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                prizeResults.forEach(result => {
                    const numbers = result.winningNumbers.map(num =>
                        `<span class="number-ball">${num}</span>`
                    ).join('');

                    html += `
                        <tr>
                            <td>${result.drawNumber}</td>
                            <td>${result.drawDate}</td>
                            <td>${numbers}</td>
                            <td><span class="number-ball extra-number-ball">${result.extraNumber}</span></td>
                            <td class="${result.firstPrize > 0 ? 'result-prize-first-alt' : 'result-no-prize'}">${result.firstPrize}</td>
                            <td class="${result.secondPrize > 0 ? 'result-prize-second-alt' : 'result-no-prize'}">${result.secondPrize}</td>
                            <td class="${result.thirdPrize > 0 ? 'result-prize-third-alt' : 'result-no-prize'}">${result.thirdPrize}</td>
                            <td class="${result.fourthPrize > 0 ? 'result-prize-fourth-alt' : 'result-no-prize'}">${result.fourthPrize}</td>
                            <td class="${result.fifthPrize > 0 ? 'result-prize-fifth-alt' : 'result-no-prize'}">${result.fifthPrize}</td>
                            <td class="${result.sixthPrize > 0 ? 'result-prize-sixth-alt' : 'result-no-prize'}">${result.sixthPrize}</td>
                            <td class="${result.seventhPrize > 0 ? 'result-prize-seventh-alt' : 'result-no-prize'}">${result.seventhPrize}</td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';

                verificationContent.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading verification:', error);
                verificationContent.innerHTML = '<div class="error">載入核對數據時出現錯誤</div>';
            }
        }

        // 頁面載入完成後初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadResults();
            // 如果當前在統計標籤頁，初始化範圍選擇
            if (document.getElementById('statistics').classList.contains('active')) {
                initializeRangeSelection();
            }
            // 如果當前在核對中獎標籤頁，初始化號碼選擇和範圍選擇
            if (document.getElementById('verification').classList.contains('active')) {
                initializeNumberSelection();
                initializeVerificationRangeSelection();
                // 如果是膽腳投注模式，也初始化膽腳網格
                if (currentBettingMode === 'banker') {
                    initializeBankerGrids();
                }
                loadVerification();
            }
            // 如果當前在江恩螺旋四方圖標籤頁，初始化江恩圖
            if (document.getElementById('gann-square').classList.contains('active')) {
                initializeGannSquare();
            }
        });

        // ========================================
        // 高頻號碼篩選功能
        // ========================================
        
        let currentFilteredNumbers = []; // 儲存當前篩選結果
        let filterHistory = []; // 儲存篩選歷史記錄
        
        // getRandom6 函數：從陣列中隨機抽取 6 個號碼
        function getRandom6(arr) {
            if (!Array.isArray(arr)) return [];
            if (arr.length <= 6) return [...arr]; // 如果少於等於6個，直接回傳全部

            const copy = [...arr]; // 複製一份，避免修改原陣列
            // Fisher-Yates 洗牌（從後往前）
            for (let i = copy.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [copy[i], copy[j]] = [copy[j], copy[i]];
            }
            return copy.slice(0, 6); // 取洗牌後的前6個
        }
        
        // 篩選高頻號碼主函數
        function filterHighFrequencyNumbers() {
            // 取得當前選擇的期數範圍
            const startPeriod = parseInt(document.getElementById('start-period').value) || 1;
            const endPeriod = parseInt(document.getElementById('end-period').value) || 1;

            if (startPeriod > endPeriod) {
                alert('開始期數不能大於結束期數！');
                return;
            }

            if (endPeriod > lotteryData.length) {
                alert(`結束期數不能超過資料範圍！目前最大期數為 ${lotteryData.length}`);
                return;
            }

            // 取得篩選模式
            const filterMode = document.getElementById('filter-mode-select').value;
            const filterCount = parseInt(document.getElementById('filter-count-select').value) || 6;

            // 計算號碼統計
            const numberFreq = {};

            // 初始化1-49的頻率為0
            for (let i = 1; i <= 49; i++) {
                numberFreq[i] = 0;
            }

            // 計算選定範圍內的號碼頻率
            const startIndex = startPeriod - 1;
            const endIndex = endPeriod;
            const selectedData = lotteryData.slice(startIndex, endIndex);

            selectedData.forEach(row => {
                row.numbers.forEach(num => {
                    numberFreq[num]++;
                });
                // 特別號也計入統計
                numberFreq[row.extra_number]++;
            });

            // 找出出現次數最多的號碼次數
            let maxFrequency = 0;
            for (let num in numberFreq) {
                if (numberFreq[num] > maxFrequency) {
                    maxFrequency = numberFreq[num];
                }
            }

            // 計算門檻值（一半次數）
            const threshold = Math.floor(maxFrequency / 2);

            // 根據模式篩選號碼
            currentFilteredNumbers = [];
            let modeDescription = '';

            if (filterMode === 'default') {
                // 預設模式：篩選出現次數 >= 門檻值的號碼
                for (let num = 1; num <= 49; num++) {
                    if (numberFreq[num] >= threshold) {
                        currentFilteredNumbers.push(num);
                    }
                }
                // 排序（按號碼大小）
                currentFilteredNumbers.sort((a, b) => a - b);
                modeDescription = `預設模式 - 門檻值 ${threshold} 次`;
            } else if (filterMode === 'rank') {
                // 排名模式：按頻率排名選取指定數量的號碼
                const sortedNumbers = Object.entries(numberFreq)
                    .map(([num, freq]) => ({ number: parseInt(num), frequency: freq }))
                    .sort((a, b) => b.frequency - a.frequency);
                
                // 取前N個號碼
                currentFilteredNumbers = sortedNumbers.slice(0, filterCount).map(item => item.number);
                // 按號碼大小排序以便顯示
                currentFilteredNumbers.sort((a, b) => a - b);
                modeDescription = `排名模式 - 選取頻率前 ${filterCount} 名`;
            } else if (filterMode === 'rank_with_pair') {
                // 排名+搭配模式：先選取排名前N的號碼，再加上常搭配的號碼（不重複）
                const sortedNumbers = Object.entries(numberFreq)
                    .map(([num, freq]) => ({ number: parseInt(num), frequency: freq }))
                    .sort((a, b) => b.frequency - a.frequency);
                
                // 計算共現矩陣
                const coMatrix = calculateCoOccurrence(selectedData);
                
                // 先取前N個排名號碼
                const rankNumbers = sortedNumbers.slice(0, filterCount).map(item => item.number);
                const resultSet = new Set(rankNumbers);
                
                // 記錄每個排名號碼的最佳搭配
                const pairingInfo = [];
                
                // 為每個排名號碼找到最常搭配的號碼（不重複）
                for (const rankNum of rankNumbers) {
                    const topCoOccurring = getTopCoOccurring(rankNum, coMatrix, 49);
                    let bestPair = null;
                    
                    // 找到第一個不在結果集中的搭配號碼
                    for (const co of topCoOccurring) {
                        if (!resultSet.has(co.number)) {
                            bestPair = co.number;
                            resultSet.add(co.number);
                            break;
                        }
                    }
                    
                    pairingInfo.push({
                        rankNumber: rankNum,
                        pairNumber: bestPair
                    });
                }
                
                currentFilteredNumbers = Array.from(resultSet);
                // 按號碼大小排序以便顯示
                currentFilteredNumbers.sort((a, b) => a - b);
                
                // 儲存搭配資訊供顯示使用
                window.lastPairingInfo = pairingInfo;
                
                modeDescription = `排名+搭配模式 - 前 ${filterCount} 名 + 常搭配號碼`;
            }

            // 顯示結果
            displayFilterResults(startPeriod, endPeriod, maxFrequency, threshold, currentFilteredNumbers, filterMode, modeDescription);
            
            // 更新隨機核心號碼（每次篩選時都更新）
            updateRandomCoreNumber();
        }

        // 計算組合數 C(n, k)
        function combination(n, k) {
            if (k > n || k < 0) return 0;
            if (k === 0 || k === n) return 1;
            if (k > n - k) k = n - k; // 優化：利用對稱性
            
            let result = 1;
            for (let i = 0; i < k; i++) {
                result = result * (n - i) / (i + 1);
            }
            return Math.round(result);
        }

        // 計算概率：從 total 個中選 6 個，中到 matchedCount 個的概率
        function calculateProbability(total, matchedCount) {
            if (matchedCount > 6 || matchedCount < 0) return 0;
            if (total < 6) return 0;
            
            // 計算：C(matchedCount, k) * C(total - matchedCount, 6 - k) / C(total, 6)
            // 這裡簡化為：中到至少 matchedCount 個的概率
            // 實際計算：中到 exactly matchedCount 個的概率
            let probability = 0;
            
            // 計算中到 exactly matchedCount 個的概率
            if (matchedCount <= 6 && matchedCount <= total) {
                const numerator = combination(matchedCount, matchedCount) * combination(total - matchedCount, 6 - matchedCount);
                const denominator = combination(total, 6);
                if (denominator > 0) {
                    probability = numerator / denominator;
                }
            }
            
            return probability;
        }

        // 計算上一期中獎概率
        function calculatePreviousPeriodProbability(previousPeriodData, filteredNumbers, filteredCount) {
            if (!previousPeriodData || filteredNumbers.length === 0) return null;
            
            const regularNumbers = previousPeriodData.numbers;
            const extraNumber = previousPeriodData.extra_number;
            const filteredNumbersSet = new Set(filteredNumbers);
            
            // 計算符合條件的普通號碼（這些號碼必須在filteredNumbers中）
            const matchedRegularNumbers = regularNumbers.filter(num => filteredNumbersSet.has(num));
            const matchedRegularCount = matchedRegularNumbers.length;
            // 特別號碼是否符合條件
            const isExtraMatched = filteredNumbersSet.has(extraNumber);
            
            // 總符合數量（特別號碼算0.5個）
            const totalMatched = matchedRegularCount + (isExtraMatched ? 0.5 : 0);
            
            if (totalMatched === 0) return null;
            
            // 概率1：從 filteredCount 個中選 6 個，恰好中到 matchedRegularCount 個特定號碼的概率
            // 前提：這 matchedRegularCount 個號碼都在 filteredNumbers 中
            let prob1 = 0;
            let prob1Regular = 0; // 普通號碼的概率
            if (matchedRegularCount > 0 && matchedRegularCount <= 6 && matchedRegularCount <= filteredCount && filteredCount >= 6) {
                // 情況1：特別號碼不在篩選號碼中，或者特別號碼在但我們只計算普通號碼的概率
                // 從 filteredCount 個中選 6 個，恰好包含這 matchedRegularCount 個特定號碼
                // 計算公式：C(filteredCount - matchedRegularCount, 6 - matchedRegularCount) / C(filteredCount, 6)
                // 解釋：從剩餘的 (filteredCount - matchedRegularCount) 個號碼中選 (6 - matchedRegularCount) 個
                const numerator = combination(filteredCount - matchedRegularCount, 6 - matchedRegularCount);
                const denominator = combination(filteredCount, 6);
                if (denominator > 0 && numerator >= 0) {
                    prob1Regular = numerator / denominator;
                    prob1 = prob1Regular;

                    // 情況2：特別號碼也在篩選號碼中，且符合條件
                    // 從 filteredCount 個中選 6 個，恰好包含 matchedRegularCount 個特定攪出號碼 + 特別號碼
                    // 必須選中這 (matchedRegularCount + 1) 個號碼，剩餘從其他號碼中選
                    // 公式：C(filteredCount - matchedRegularCount - 1, 6 - matchedRegularCount - 1) / C(filteredCount, 6)
                    // 注意：如果 matchedRegularCount = 5，則需要選中 5個普通號碼 + 1個特別號碼 = 6個，剩餘從其他號碼中選0個
                    if (isExtraMatched) {
                        const remainingCount = filteredCount - matchedRegularCount - 1; // 扣除已匹配的普通號碼和特別號碼
                        const needFromRemaining = 6 - matchedRegularCount - 1; // 還需要從剩餘號碼中選的數量
                        if (remainingCount >= 0 && needFromRemaining >= 0 && remainingCount >= needFromRemaining) {
                            prob1 = combination(remainingCount, needFromRemaining) / combination(filteredCount, 6);
                        } else {
                            prob1 = 0; // 無法滿足條件
                        }
                    }
                }
            }
            
            // 概率2：從 49 個中選 6 個，恰好中到 matchedRegularCount 個特定號碼的概率
            // 根據六合彩規則：這 matchedRegularCount 個特定號碼必須是從6個「攪出號碼」中選出的
            // 正確公式：C(6, matchedRegularCount) * C(42, 6-matchedRegularCount) / C(49, 6)
            // 說明：49個號碼 - 6個攪出號碼 - 1個特別號碼 = 42個其他號碼
            let prob2 = 0;
            let prob2Regular = 0; // 普通號碼的概率
            if (matchedRegularCount > 0 && matchedRegularCount <= 6) {
                // 從6個「攪出號碼」中選 matchedRegularCount 個，從剩餘42個中選 (6-matchedRegularCount) 個
                // 注意：剩餘號碼是 49-6-1=42 個（扣除6個攪出號碼和1個特別號碼）
                const numerator = combination(6, matchedRegularCount) * combination(42, 6 - matchedRegularCount);
                const denominator = combination(49, 6);
                if (denominator > 0 && numerator >= 0) {
                    prob2Regular = numerator / denominator;
                    prob2 = prob2Regular;

                    // 如果特別號碼也符合條件，需要計算包含特別號碼的概率
                    // 根據六合彩規則：
                    // - 沒有特別號碼時，概率 = C(6, k) * C(42, 6-k) / C(49, 6)
                    // - 有特別號碼時，概率 = C(6, k) * C(42, 5-k) / C(49, 6)（選中k個攪出號碼 + 1個特別號碼 + (5-k)個其他號碼）
                    if (isExtraMatched) {
                        // 有特別號碼時：從6個攪出號碼中選k個，從42個其他號碼中選(5-k)個（因為特別號碼佔了1個位置）
                        // 公式：C(6, k) * C(42, 5-k) / C(49, 6)
                        const numeratorWithExtra = combination(6, matchedRegularCount) * combination(42, 5 - matchedRegularCount);
                        if (numeratorWithExtra >= 0 && 5 - matchedRegularCount >= 0 && 42 >= 5 - matchedRegularCount) {
                            prob2 = numeratorWithExtra / combination(49, 6);
                        } else {
                            prob2 = 0; // 無法滿足條件
                        }
                    }
                }
            }
            
            // 特別號碼的概率（如果符合條件）
            let extraProb = 0;
            if (isExtraMatched) {
                // 特別號碼是從剩餘的43個中抽取的（因為已經抽了6個普通號碼），概率是 1/43
                extraProb = 1 / 43;
            }
            
            return {
                matchedRegularCount,
                matchedRegularNumbers,
                isExtraMatched,
                totalMatched,
                probFromFiltered: prob1,
                probFrom49: prob2,
                extraProb: extraProb
            };
        }

        // 顯示篩選結果
        function displayFilterResults(startPeriod, endPeriod, maxFrequency, threshold, filteredNumbers, filterMode = 'default', modeDescription = '') {
            const resultDiv = document.getElementById('high-frequency-result');
            const thresholdInfo = document.getElementById('filter-threshold-info');
            const filteredNumbersDiv = document.getElementById('filtered-numbers');
            const filteredNumbersCountDiv = document.getElementById('filtered-numbers-count');
            const previousPeriodNumbersDiv = document.getElementById('previous-period-numbers');
            const random6Div = document.getElementById('random-6-numbers');

            // 顯示結果區域
            resultDiv.style.display = 'block';

            // 根據模式顯示不同的篩選條件信息
            let infoText = `期數範圍：第 ${startPeriod} 期 ~ 第 ${endPeriod} 期（共 ${endPeriod - startPeriod + 1} 期）`;
            
            if (filterMode === 'default') {
                infoText += `｜最高出現次數：${maxFrequency} 次｜門檻值：${threshold} 次｜篩選出 ${filteredNumbers.length} 個號碼`;
            } else if (filterMode === 'rank') {
                infoText += `｜${modeDescription}｜篩選出 ${filteredNumbers.length} 個號碼`;
            } else if (filterMode === 'rank_with_pair') {
                infoText += `｜${modeDescription}｜篩選出 ${filteredNumbers.length} 個號碼`;
            }
            
            thresholdInfo.textContent = infoText;

            // 顯示篩選出數字的數量
            filteredNumbersCountDiv.textContent = `（共 ${filteredNumbers.length} 個）`;

            // 顯示上一期的號碼
            const probabilityInfoDiv = document.getElementById('probability-info');
            if (startPeriod === 1) {
                // 第1期沒有上一期
                previousPeriodNumbersDiv.innerHTML = '<span class="hf-text--muted">無上一期</span>';
                probabilityInfoDiv.innerHTML = '';
            } else {
                // 獲取上一期的數據（startPeriod - 1 對應 lotteryData 的索引是 startPeriod - 2）
                const previousPeriodIndex = startPeriod - 2;
                if (previousPeriodIndex >= 0 && previousPeriodIndex < lotteryData.length) {
                    const previousPeriodData = lotteryData[previousPeriodIndex];
                    const previousPeriodNumber = previousPeriodIndex + 1; // 期數從1開始
                    const regularNumbers = [...previousPeriodData.numbers].sort((a, b) => a - b);
                    const extraNumber = previousPeriodData.extra_number;
                    
                    // 創建一個 Set 來快速檢查號碼是否在篩選結果中
                    const filteredNumbersSet = new Set(filteredNumbers);
                    
                    // 計算符合條件的號碼
                    const matchedRegularNumbers = regularNumbers.filter(num => filteredNumbersSet.has(num));
                    const isExtraMatched = filteredNumbersSet.has(extraNumber);
                    const totalMatched = matchedRegularNumbers.length + (isExtraMatched ? 0.5 : 0);
                    
                    // 顯示普通號碼（用逗號分隔）
                    const regularNumbersHtml = regularNumbers.map(num => {
                        const isMatched = filteredNumbersSet.has(num);
                        const ballClass = isMatched ? 'hf-ball hf-ball--md hf-ball--primary-glow' : 'hf-ball hf-ball--md hf-ball--success';
                        return `<span class="${ballClass}">${num}</span>`;
                    }).join('');
                    
                    // 顯示特別號碼（用 + 號連接）- 使用橙色系區分
                    const extraBallClass = isExtraMatched ? 'hf-ball hf-ball--md hf-ball--warning-glow' : 'hf-ball hf-ball--md hf-ball--warning';
                    const extraNumberHtml = `<span class="hf-separator">+</span><span class="${extraBallClass}">${extraNumber}</span>`;
                    
                    previousPeriodNumbersDiv.innerHTML = `第 ${previousPeriodNumber} 期：` + regularNumbersHtml + extraNumberHtml;
                    
                    // 計算並顯示概率
                    if (totalMatched > 0 && filteredNumbers.length > 0) {
                        const probResult = calculatePreviousPeriodProbability(previousPeriodData, filteredNumbers, filteredNumbers.length);
                        if (probResult) {
                            const matchedDesc = `${matchedRegularNumbers.join(',')}${isExtraMatched ? '+' + extraNumber : ''}`;
                            const matchedRegularCount = matchedRegularNumbers.length; // 獲取符合條件的普通號碼數量
                            
                            // 計算篩選號碼中缺少的攪出號碼
                            const missingRegularNumbers = previousPeriodData.numbers.filter(num => !filteredNumbersSet.has(num));
                            const missingCount = missingRegularNumbers.length;
                            
                            // 判斷從篩選號碼中選是否更容易
                            const isFilteredEasier = probResult.probFromFiltered > probResult.probFrom49;
                            
                            // 計算100注的概率（至少中一注的概率）
                            const prob100 = 1 - Math.pow(1 - probResult.probFromFiltered, 100);
                            
                            let probInfoHtml = `
                                <div class="hf-prob-item">
                                    <strong>中獎號碼：</strong>${matchedDesc}（共 ${totalMatched} 個）
                                </div>
                                <div class="hf-prob-item">
                                    <strong>從 ${filteredNumbers.length} 個中選 6 個，中到符合中獎的概率：</strong>
                                    <span class="${isFilteredEasier ? 'hf-text--success' : 'hf-text--danger'}">${(probResult.probFromFiltered * 100).toFixed(6)}%</span>
                                    <span class="hf-text--secondary">(1/${Math.round(1 / probResult.probFromFiltered).toLocaleString()}次)</span>
                                </div>
                                <div class="hf-prob-item">
                                    <strong>從 49 個中選 6 個，中到符合中獎的概率：</strong>
                                    <span class="${!isFilteredEasier ? 'hf-text--success' : 'hf-text--danger'}">${(probResult.probFrom49 * 100).toFixed(6)}%</span>
                                    <span class="hf-text--secondary">(1/${Math.round(1 / probResult.probFrom49).toLocaleString()}次)</span>
                                </div>
                                <div class="hf-prob-box">
                                    <div class="hf-prob-title"><strong>📊 計算說明：</strong></div>
                                    <div class="hf-prob-text"><strong>從 ${filteredNumbers.length} 個中選 6 個：</strong></div>
                                    <div class="hf-prob-indent">• 恰好包含 ${matchedRegularCount} 個特定號碼（${matchedRegularNumbers.join(',')}）${isExtraMatched ? ` + 特別號碼${extraNumber}` : ''}</div>
                                    ${missingCount > 0 ? `<div class="hf-prob-indent hf-text--danger">• ⚠️ 缺少攪出號碼：${missingRegularNumbers.join(',')}（共${missingCount}個不在篩選號碼中）</div>` : ''}
                                    ${isExtraMatched ? `
                                        <div class="hf-prob-indent">• 公式：C(${matchedRegularCount}, ${matchedRegularCount}) × C(${filteredNumbers.length - matchedRegularCount - 1}, ${5 - matchedRegularCount}) / C(${filteredNumbers.length}, 6)</div>
                                        <div class="hf-prob-indent">• 說明：從${matchedRegularCount}個在池中的攪出號碼中選${matchedRegularCount}個，從剩餘${filteredNumbers.length - matchedRegularCount - 1}個中選${5 - matchedRegularCount}個</div>
                                    ` : `
                                        <div class="hf-prob-indent">• 公式：C(${matchedRegularCount}, ${matchedRegularCount}) × C(${filteredNumbers.length - matchedRegularCount}, ${6 - matchedRegularCount}) / C(${filteredNumbers.length}, 6)</div>
                                        <div class="hf-prob-indent">• 說明：從${matchedRegularCount}個在池中的攪出號碼中選${matchedRegularCount}個，從剩餘${filteredNumbers.length - matchedRegularCount}個中選${6 - matchedRegularCount}個</div>
                                    `}
                                    <div class="hf-prob-section"><strong>從 49 個中選 6 個：</strong></div>
                                    <div class="hf-prob-indent">• 恰好中 ${matchedRegularCount} 個攪出號碼${isExtraMatched ? ` + 特別號碼` : ''}（可從6個攪出號碼中任選${matchedRegularCount}個）</div>
                                    ${isExtraMatched ? `
                                        <div class="hf-prob-indent">• 公式：C(6, ${matchedRegularCount}) × C(42, ${5 - matchedRegularCount}) / C(49, 6)</div>
                                        <div class="hf-prob-indent">• 說明：有 C(6,${matchedRegularCount})=${combination(6, matchedRegularCount)} 種方式選${matchedRegularCount}個攪出號碼，從42個其他號碼中選${5 - matchedRegularCount}個</div>
                                    ` : `
                                        <div class="hf-prob-indent">• 公式：C(6, ${matchedRegularCount}) × C(42, ${6 - matchedRegularCount}) / C(49, 6)</div>
                                        <div class="hf-prob-indent">• 說明：有 C(6,${matchedRegularCount})=${combination(6, matchedRegularCount)} 種方式選${matchedRegularCount}個攪出號碼，從42個其他號碼中選${6 - matchedRegularCount}個</div>
                                    `}
                                    ${isFilteredEasier ? `
                                        <div class="hf-prob-divider hf-text--success">
                                            <strong>💡 為什麼從 ${filteredNumbers.length} 個中選的概率更高？</strong><br>
                                            因為篩選號碼池較小，選中特定號碼的機率更高。<br>
                                            篩選號碼中包含了全部${matchedRegularCount + (isExtraMatched ? 1 : 0)}個中獎號碼。
                                        </div>
                                    ` : `
                                        <div class="hf-prob-divider hf-text--danger">
                                            <strong>⚠️ 為什麼從 ${filteredNumbers.length} 個中選的概率反而更低？</strong><br>
                                            因為篩選號碼中缺少 ${missingCount} 個攪出號碼（${missingRegularNumbers.join(',')}）！<br>
                                            從49個中選：有 C(6,${matchedRegularCount})=${combination(6, matchedRegularCount)} 種方式中${matchedRegularCount}個攪出號碼<br>
                                            從${filteredNumbers.length}個中選：只有 C(${matchedRegularCount},${matchedRegularCount})=1 種方式（因為池中只有這${matchedRegularCount}個攪出號碼）
                                        </div>
                                    `}
                                    <div class="hf-prob-divider">
                                        <strong>💡 100注說明：</strong><br>
                                        買100注（每注都是從${filteredNumbers.length}個中隨機選6個），<br>
                                        <strong>至少中一注的概率：${(prob100 * 100).toFixed(2)}%</strong><br>
                                        <span class="hf-text--small">（不是簡單的 ${(probResult.probFromFiltered * 100).toFixed(6)}% × 100）</span>
                                    </div>
                                </div>
                            `;
                            probabilityInfoDiv.innerHTML = probInfoHtml;
                        } else {
                            probabilityInfoDiv.innerHTML = '';
                        }
                    } else {
                        probabilityInfoDiv.innerHTML = '<span class="hf-text--muted">無符合中獎號碼</span>';
                    }
                } else {
                    previousPeriodNumbersDiv.innerHTML = '<span class="hf-text--muted">無法獲取上一期數據</span>';
                    probabilityInfoDiv.innerHTML = '';
                }
            }

            // 顯示符合條件的號碼
            if (filteredNumbers.length === 0) {
                filteredNumbersDiv.innerHTML = '<span class="hf-text--muted">無符合條件的號碼</span>';
                random6Div.innerHTML = '<span class="hf-text--muted">無法抽取</span>';
            } else {
                // 根據模式顯示號碼
                if (filterMode === 'rank_with_pair' && window.lastPairingInfo) {
                    // 排名+搭配模式：顯示排名號碼及其搭配號碼
                    let numbersHtml = '<div class="hf-pairing-display">';
                    numbersHtml += '<div class="hf-pairing-title">🏆 排名號碼與搭配號碼：</div>';
                    numbersHtml += '<div class="hf-pairing-list">';
                    
                    window.lastPairingInfo.forEach((info, index) => {
                        numbersHtml += `
                            <div class="hf-pairing-item">
                                <span class="hf-pairing-rank">第${index + 1}名</span>
                                <span class="hf-ball hf-ball--md hf-ball--primary">${info.rankNumber}</span>
                                ${info.pairNumber ? `
                                    <span class="hf-pairing-arrow">→</span>
                                    <span class="hf-ball hf-ball--md hf-ball--success">${info.pairNumber}</span>
                                ` : '<span class="hf-pairing-no-pair">無可用搭配</span>'}
                            </div>
                        `;
                    });
                    
                    numbersHtml += '</div>';
                    numbersHtml += '<div class="hf-pairing-summary">';
                    numbersHtml += '<strong>所有篩選號碼（去重後）：</strong>';
                    numbersHtml += filteredNumbers.map(num => 
                        `<span class="hf-ball hf-ball--md hf-ball--primary">${num}</span>`
                    ).join('');
                    numbersHtml += '</div></div>';
                    
                    filteredNumbersDiv.innerHTML = numbersHtml;
                } else {
                    // 其他模式：直接顯示號碼
                    filteredNumbersDiv.innerHTML = filteredNumbers.map(num => 
                        `<span class="hf-ball hf-ball--md hf-ball--primary">${num}</span>`
                    ).join('');
                }

                // 更新核心號碼選項
                updateSmartCoreOptions();
                
                // 根據抽獎模式抽取號碼
                const drawMode = document.getElementById('draw-mode-select').value;
                const drawResultTitle = document.getElementById('draw-result-title');
                let drawnNumbers = [];
                let displayHtml = '';
                let drawModeInfo = null;
                
                if (drawMode === 'single') {
                    // 單式：抽取6個號碼
                    drawnNumbers = getRandom6(filteredNumbers);
                    drawResultTitle.textContent = '隨機抽取 6 個號碼：';
                    displayHtml = drawnNumbers.map(num => 
                        `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
                    ).join('');
                    drawModeInfo = { mode: 'single' };
                } else if (drawMode === 'complex') {
                    // 復式：抽取7-15個號碼
                    const count = parseInt(document.getElementById('complex-count-select').value);
                    drawnNumbers = getRandomNumbers(filteredNumbers, count);
                    drawResultTitle.textContent = `隨機抽取 ${count} 個號碼（復式）：`;
                    displayHtml = drawnNumbers.map(num => 
                        `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
                    ).join('');
                    drawModeInfo = { mode: 'complex', count: count };
                } else if (drawMode === 'smart') {
                    // 聰明組合：生成多注
                    const hasCoreNumber = document.getElementById('smart-core-checkbox').checked;
                    const coreNumber = getCurrentCoreNumber();
                    const isRandomCore = document.getElementById('smart-core-number').value === 'random';
                    
                    const bets = generateSmartBets(filteredNumbers, hasCoreNumber, coreNumber);
                    
                    // 顯示標題，如果是隨機核心號碼則顯示當前選中的號碼
                    let titleText = `聰明組合（共 ${bets.length} 注）`;
                    if (hasCoreNumber && coreNumber && isRandomCore) {
                        titleText += ` 🎲膽=${coreNumber}`;
                    }
                    titleText += '：';
                    drawResultTitle.textContent = titleText;
                    
                    displayHtml = '<div class="smart-bets-container">';
                    bets.forEach((bet, index) => {
                        const rowClass = bet.isRemainder ? 'smart-bet-row has-remainder' : 'smart-bet-row';
                        const labelText = bet.isRemainder ? `第${index + 1}注 *` : `第${index + 1}注`;
                        
                        displayHtml += `<div class="${rowClass}">`;
                        displayHtml += `<span class="smart-bet-label">${labelText}</span>`;
                        displayHtml += '<div class="smart-bet-numbers">';
                        
                        bet.numbers.forEach(num => {
                            const ballClass = (bet.coreNumber !== null && num === bet.coreNumber) 
                                ? 'hf-ball hf-ball--md hf-ball--core' 
                                : 'hf-ball hf-ball--md hf-ball--secondary';
                            displayHtml += `<span class="${ballClass}">${num}</span>`;
                        });
                        
                        displayHtml += '</div>';
                        if (bet.isRemainder) {
                            displayHtml += `<span style="font-size: 0.75rem; color: #888;">(*含補充號碼)</span>`;
                        }
                        displayHtml += '</div>';
                    });
                    displayHtml += '</div>';
                    
                    // 對於聰明組合，drawnNumbers 保存所有不重複的號碼
                    drawnNumbers = [...new Set(bets.flatMap(b => b.numbers))].sort((a, b) => a - b);
                    drawModeInfo = { mode: 'smart', bets: bets, hasCoreNumber: hasCoreNumber, coreNumber: coreNumber };
                } else if (drawMode === 'smartComplex') {
                    // 聰明組合+復式：生成多注（每注可選7-10個號碼）
                    const numbersPerBet = parseInt(document.getElementById('smart-complex-count-select').value);
                    const hasCoreNumber = document.getElementById('smart-core-checkbox').checked;
                    const coreNumber = getCurrentCoreNumber();
                    const isRandomCore = document.getElementById('smart-core-number').value === 'random';
                    
                    const bets = generateSmartComplexBets(filteredNumbers, numbersPerBet, hasCoreNumber, coreNumber);
                    
                    // 顯示標題，如果是隨機核心號碼則顯示當前選中的號碼
                    let titleText = `聰明組合+復式（每注${numbersPerBet}個，共 ${bets.length} 注）`;
                    if (hasCoreNumber && coreNumber && isRandomCore) {
                        titleText += ` 🎲膽=${coreNumber}`;
                    }
                    titleText += '：';
                    drawResultTitle.textContent = titleText;
                    
                    displayHtml = '<div class="smart-bets-container">';
                    bets.forEach((bet, index) => {
                        let rowClass = 'smart-bet-row';
                        let labelText = `第${index + 1}注`;
                        let noteText = '';
                        
                        if (bet.isExtraRandom) {
                            labelText += ' 🎲';
                            noteText = '<span style="font-size: 0.75rem; color: #888;">(隨機注)</span>';
                        } else if (bet.isRemainder) {
                            rowClass += ' has-remainder';
                            labelText += ' *';
                            noteText = `<span style="font-size: 0.75rem; color: #888;">(*餘${bet.remainderOriginal}+補${numbersPerBet - bet.remainderOriginal})</span>`;
                        }
                        
                        displayHtml += `<div class="${rowClass}">`;
                        displayHtml += `<span class="smart-bet-label">${labelText}</span>`;
                        displayHtml += '<div class="smart-bet-numbers">';
                        
                        bet.numbers.forEach(num => {
                            const ballClass = (bet.coreNumber !== null && num === bet.coreNumber) 
                                ? 'hf-ball hf-ball--md hf-ball--core' 
                                : 'hf-ball hf-ball--md hf-ball--secondary';
                            displayHtml += `<span class="${ballClass}">${num}</span>`;
                        });
                        
                        displayHtml += '</div>';
                        displayHtml += noteText;
                        displayHtml += '</div>';
                    });
                    displayHtml += '</div>';
                    
                    // 對於聰明組合+復式，drawnNumbers 保存所有不重複的號碼
                    drawnNumbers = [...new Set(bets.flatMap(b => b.numbers))].sort((a, b) => a - b);
                    drawModeInfo = { mode: 'smartComplex', bets: bets, numbersPerBet: numbersPerBet, hasCoreNumber: hasCoreNumber, coreNumber: coreNumber };
                } else if (drawMode === 'fiveBankerFullMeal') {
                    // 5膽拖全餐：從高頻號碼中隨機選5個做膽，剩下的做腳
                    if (filteredNumbers.length < 6) {
                        drawResultTitle.textContent = '號碼不足（至少需要6個號碼）';
                        displayHtml = '<span class="hf-text--muted">篩選號碼不足，無法使用5膽拖全餐</span>';
                        drawModeInfo = { mode: 'fiveBankerFullMeal', error: 'insufficient' };
                    } else {
                        // 隨機選5個膽
                        const bankers = getRandomNumbers(filteredNumbers, 5);
                        // 剩下的作為腳
                        const runners = filteredNumbers.filter(num => !bankers.includes(num));

                        // 生成注數：每注 = 5個膽 + 1個腳
                        const bets = runners.map(runner => ({
                            numbers: [...bankers.sort((a, b) => a - b), runner],
                            bankers: bankers,
                            runner: runner
                        }));

                        console.log('5膽拖全餐 - 篩選號碼:', filteredNumbers.length, filteredNumbers);
                        console.log('5膽拖全餐 - 膽碼:', bankers.length, bankers);
                        console.log('5膽拖全餐 - 腳碼:', runners.length, runners);
                        console.log('5膽拖全餐 - 總注數:', bets.length);

                        drawResultTitle.textContent = `5膽拖全餐（共 ${bets.length} 注）：`;

                        // 顯示膽碼信息
                        displayHtml = '<div class="five-banker-info">';
                        displayHtml += '<div class="five-banker-title">🎯 膽碼（固定5個）：</div>';
                        displayHtml += '<div class="five-banker-numbers">';
                        bankers.forEach(num => {
                            displayHtml += `<span class="hf-ball hf-ball--md hf-ball--secondary">${num}</span>`;
                        });
                        displayHtml += '</div>';
                        displayHtml += `<div class="five-banker-stats">`;
                        displayHtml += `📊 篩選號碼: ${filteredNumbers.length}個 | 膽: ${bankers.length}個 | 腳: ${runners.length}個 | 共 ${bets.length} 注<br>`;
                        displayHtml += `💰 每注成本：$10（全注）或 $5（半注） | 全注總成本：$${bets.length * 10} | 半注總成本：$${bets.length * 5}`;
                        displayHtml += `</div>`;
                        displayHtml += '</div>';

                        // 顯示所有注數
                        displayHtml += '<div class="five-banker-bets-container">';
                        bets.forEach((bet, index) => {
                            displayHtml += `<div class="five-banker-bet-row">`;
                            displayHtml += `<span class="five-banker-bet-label">第${index + 1}注</span>`;
                            displayHtml += '<div class="five-banker-bet-numbers">';

                            bet.numbers.forEach(num => {
                                displayHtml += `<span class="hf-ball hf-ball--md hf-ball--secondary">${num}</span>`;
                            });

                            displayHtml += '</div>';
                            displayHtml += '</div>';
                        });
                        displayHtml += '</div>';

                        // drawnNumbers 保存所有號碼（膽+腳）
                        drawnNumbers = filteredNumbers;
                        drawModeInfo = {
                            mode: 'fiveBankerFullMeal',
                            bets: bets,
                            bankers: bankers,
                            runners: runners
                        };
                    }
                }

                // 檢查是否勾選隨機注數
                const hasRandomBet = document.getElementById('random-bet-checkbox').checked;
                if (hasRandomBet) {
                    // 從1-49中隨機抽取6個號碼
                    const fullPool = Array.from({length: 49}, (_, i) => (i + 1).toString().padStart(2, '0'));
                    const randomBetNumbers = getRandomNumbers(fullPool, 6);
                    
                    displayHtml += `
                        <div class="random-bet-section">
                            <div class="random-bet-title">
                                <span>🎰</span> 隨機注數（1-49全號池）
                            </div>
                            <div class="random-bet-numbers">
                                ${randomBetNumbers.map(num => 
                                    `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                    
                    // 將隨機注數信息添加到 drawModeInfo
                    if (drawModeInfo) {
                        drawModeInfo.randomBet = randomBetNumbers;
                    }
                }
                
                random6Div.innerHTML = displayHtml;
                
                // 添加到歷史記錄
                addToFilterHistory(startPeriod, endPeriod, maxFrequency, threshold, filteredNumbers, drawnNumbers, filterMode, drawModeInfo);
            }

            // 滾動到結果區域
            // resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 更新抽獎模式UI
        function updateDrawModeUI() {
            const drawMode = document.getElementById('draw-mode-select').value;
            const complexContainer = document.getElementById('complex-count-container');
            const smartCoreContainer = document.getElementById('smart-core-container');
            const smartComplexContainer = document.getElementById('smart-complex-container');
            const drawResultTitle = document.getElementById('draw-result-title');
            
            // 隱藏所有選項容器
            complexContainer.style.display = 'none';
            smartCoreContainer.style.display = 'none';
            smartComplexContainer.style.display = 'none';
            
            // 根據模式顯示對應的選項
            if (drawMode === 'single') {
                drawResultTitle.textContent = '隨機抽取 6 個號碼：';
            } else if (drawMode === 'complex') {
                complexContainer.style.display = 'flex';
                const count = document.getElementById('complex-count-select').value;
                drawResultTitle.textContent = `隨機抽取 ${count} 個號碼（復式）：`;
            } else if (drawMode === 'smart') {
                smartCoreContainer.style.display = 'flex';
                drawResultTitle.textContent = '聰明組合（多注）：';
                // 更新核心號碼選項
                updateSmartCoreOptions();
            } else if (drawMode === 'smartComplex') {
                smartComplexContainer.style.display = 'flex';
                smartCoreContainer.style.display = 'flex';
                const count = document.getElementById('smart-complex-count-select').value;
                drawResultTitle.textContent = `聰明組合+復式（每注${count}個）：`;
                // 更新核心號碼選項
                updateSmartCoreOptions();
            } else if (drawMode === 'fiveBankerFullMeal') {
                drawResultTitle.textContent = '5膽拖全餐：';
            }
            
            // 如果有篩選結果，立即刷新顯示
            if (currentFilteredNumbers.length > 0) {
                refreshRandom6();
            }
        }
        
        // 更新聰明組合核心號碼UI
        function updateSmartCoreUI() {
            const checkbox = document.getElementById('smart-core-checkbox');
            const coreNumberSelect = document.getElementById('smart-core-number');
            
            coreNumberSelect.style.display = checkbox.checked ? 'inline-block' : 'none';
            
            // 如果有篩選結果，立即刷新顯示
            if (currentFilteredNumbers.length > 0) {
                refreshRandom6();
            }
        }
        
        // 復式模式數量改變時
        function onComplexCountChange() {
            const count = document.getElementById('complex-count-select').value;
            const drawResultTitle = document.getElementById('draw-result-title');
            drawResultTitle.textContent = `隨機抽取 ${count} 個號碼（復式）：`;
            
            // 如果有篩選結果，立即刷新顯示
            if (currentFilteredNumbers.length > 0) {
                refreshRandom6();
            }
        }
        
        // 聰明組合核心號碼改變時
        function onSmartCoreNumberChange() {
            // 如果有篩選結果，立即刷新顯示
            if (currentFilteredNumbers.length > 0) {
                refreshRandom6();
            }
        }
        
        // 隨機注數 checkbox 改變時
        function onRandomBetChange() {
            // 如果有篩選結果，立即刷新顯示
            if (currentFilteredNumbers.length > 0) {
                refreshRandom6();
            }
        }
        
        // 聰明組合+復式 數量改變時
        function onSmartComplexCountChange() {
            const count = document.getElementById('smart-complex-count-select').value;
            const drawResultTitle = document.getElementById('draw-result-title');
            drawResultTitle.textContent = `聰明組合+復式（每注${count}個）：`;
            
            // 如果有篩選結果，立即刷新顯示
            if (currentFilteredNumbers.length > 0) {
                refreshRandom6();
            }
        }
        
        // 更新核心號碼選項（根據高頻號碼）
        function updateSmartCoreOptions() {
            const coreNumberSelect = document.getElementById('smart-core-number');
            
            // 保存當前選中的值
            const previousValue = coreNumberSelect.value;
            
            coreNumberSelect.innerHTML = '';
            
            // 添加"隨機"選項
            const randomOption = document.createElement('option');
            randomOption.value = 'random';
            randomOption.textContent = '🎲 隨機';
            coreNumberSelect.appendChild(randomOption);
            
            if (currentFilteredNumbers.length > 0) {
                currentFilteredNumbers.forEach(num => {
                    const option = document.createElement('option');
                    option.value = num;
                    option.textContent = num;
                    coreNumberSelect.appendChild(option);
                });
                
                // 如果之前選中的值仍然在新的選項中，恢復選擇（但不是隨機）
                if (previousValue && previousValue !== 'random' && currentFilteredNumbers.includes(parseInt(previousValue))) {
                    coreNumberSelect.value = previousValue;
                } else if (previousValue === 'random') {
                    coreNumberSelect.value = 'random';
                }
            }
            
            // 如果是隨機模式，更新當前隨機核心號碼
            if (coreNumberSelect.value === 'random') {
                updateRandomCoreNumber();
            }
        }
        
        // 當前隨機選中的核心號碼
        let currentRandomCoreNumber = null;
        
        // 更新隨機核心號碼（從高頻號碼中隨機抽取一個）
        function updateRandomCoreNumber() {
            if (currentFilteredNumbers.length > 0) {
                const randomIndex = Math.floor(Math.random() * currentFilteredNumbers.length);
                currentRandomCoreNumber = currentFilteredNumbers[randomIndex];
            } else {
                currentRandomCoreNumber = null;
            }
            return currentRandomCoreNumber;
        }
        
        // 獲取當前核心號碼（處理隨機選項）
        function getCurrentCoreNumber() {
            const coreNumberSelect = document.getElementById('smart-core-number');
            const selectedValue = coreNumberSelect.value;
            
            if (selectedValue === 'random') {
                // 如果沒有隨機核心號碼，則生成一個
                if (currentRandomCoreNumber === null) {
                    updateRandomCoreNumber();
                }
                return currentRandomCoreNumber;
            }
            return selectedValue;
        }
        
        // 從號碼池中隨機抽取指定數量的號碼
        function getRandomNumbers(pool, count) {
            if (pool.length < count) {
                return [...pool]; // 如果池中號碼不夠，返回全部
            }
            const copy = [...pool];
            // Fisher-Yates 洗牌算法
            for (let i = copy.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [copy[i], copy[j]] = [copy[j], copy[i]];
            }
            return copy.slice(0, count).sort((a, b) => a - b);
        }
        
        // 生成聰明組合注數
        function generateSmartBets(pool, hasCoreNumber, coreNumber) {
            const poolSize = pool.length;
            const betsPerGroup = 6;
            const bets = [];
            
            if (poolSize < 6) {
                // 號碼不夠，直接返回一注
                return [{ numbers: [...pool], isRemainder: true, coreNumber: null }];
            }
            
            // 複製並打亂號碼池
            const shuffled = [...pool];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            // 如果有核心號碼，先從洗牌後的號碼中移除核心號碼
            let coreNum = null;
            if (hasCoreNumber && coreNumber) {
                coreNum = parseInt(coreNumber);
                const coreIndex = shuffled.indexOf(coreNum);
                if (coreIndex !== -1) {
                    shuffled.splice(coreIndex, 1);
                }
            }
            
            // 根據是否有核心號碼計算每注需要從池中取的號碼數
            const numbersPerBetFromPool = coreNum !== null ? (betsPerGroup - 1) : betsPerGroup;
            
            // 計算可以組成多少完整注
            const fullBetCount = Math.floor(shuffled.length / numbersPerBetFromPool);
            
            let usedNumbers = [];
            
            // 生成完整注數
            for (let i = 0; i < fullBetCount; i++) {
                let betNumbers;
                const startIdx = i * numbersPerBetFromPool;
                const endIdx = (i + 1) * numbersPerBetFromPool;
                
                if (coreNum !== null) {
                    // 如果有核心號碼，每注都要包含核心號碼
                    const otherNumbers = shuffled.slice(startIdx, endIdx);
                    betNumbers = [coreNum, ...otherNumbers];
                } else {
                    betNumbers = shuffled.slice(startIdx, endIdx);
                }
                usedNumbers = usedNumbers.concat(betNumbers);
                bets.push({
                    numbers: betNumbers.sort((a, b) => a - b),
                    isRemainder: false,
                    coreNumber: coreNum
                });
            }
            
            // 處理剩餘號碼
            const remainingNumbers = shuffled.slice(fullBetCount * numbersPerBetFromPool);
            
            if (remainingNumbers.length > 0) {
                // 需要補足到6個的數量
                const currentCount = remainingNumbers.length + (coreNum !== null ? 1 : 0);
                const needCount = betsPerGroup - currentCount;
                
                // 只有當需要補充時才補充
                let supplementNumbers = [];
                if (needCount > 0) {
                    // 從原池中找出未在剩餘號碼中的號碼（排除核心號碼）
                    const availableForSupplement = pool.filter(n => 
                        !remainingNumbers.includes(n) && n !== coreNum
                    );
                    
                    // 隨機選取補足號碼
                    supplementNumbers = getRandomNumbers(availableForSupplement, needCount);
                }
                
                let finalBet;
                if (coreNum !== null) {
                    finalBet = [coreNum, ...remainingNumbers, ...supplementNumbers];
                } else {
                    finalBet = [...remainingNumbers, ...supplementNumbers];
                }
                
                bets.push({
                    numbers: finalBet.sort((a, b) => a - b),
                    isRemainder: true,
                    remainderOriginal: currentCount,
                    coreNumber: coreNum
                });
            }
            
            return bets;
        }
        
        // 生成聰明組合+復式注數
        // 例：18個號碼 / 7 = 2注 + 餘數4
        // 第1注：隨機7個不重複號碼（含核心號碼如有）
        // 第2注：另外7個不重複號碼（從剩餘中，含核心號碼如有）
        // 第3注：餘數4 + 隨機3個（從18個中抽取補足，含核心號碼如有）
        // 第4注：從全部18個中完全隨機抽7個（額外隨機注，含核心號碼如有）
        function generateSmartComplexBets(pool, numbersPerBet, hasCoreNumber, coreNumber) {
            const poolSize = pool.length;
            const bets = [];
            
            // 處理核心號碼
            let coreNum = null;
            if (hasCoreNumber && coreNumber) {
                coreNum = parseInt(coreNumber);
            }
            
            if (poolSize < numbersPerBet) {
                // 號碼不夠，直接返回一注
                return [{ numbers: [...pool], isRemainder: true, isExtraRandom: false, coreNumber: coreNum }];
            }
            
            // 複製並打亂號碼池
            const shuffled = [...pool];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            // 如果有核心號碼，先從洗牌後的號碼中移除核心號碼
            if (coreNum !== null) {
                const coreIndex = shuffled.indexOf(coreNum);
                if (coreIndex !== -1) {
                    shuffled.splice(coreIndex, 1);
                }
            }
            
            // 根據是否有核心號碼計算每注需要從池中取的號碼數
            const numbersPerBetFromPool = coreNum !== null ? (numbersPerBet - 1) : numbersPerBet;
            
            // 計算可以組成多少完整注
            const fullBetCount = Math.floor(shuffled.length / numbersPerBetFromPool);
            
            // 生成完整注數（不重複）
            for (let i = 0; i < fullBetCount; i++) {
                const startIdx = i * numbersPerBetFromPool;
                const endIdx = (i + 1) * numbersPerBetFromPool;
                let betNumbers;
                
                if (coreNum !== null) {
                    const otherNumbers = shuffled.slice(startIdx, endIdx);
                    betNumbers = [coreNum, ...otherNumbers];
                } else {
                    betNumbers = shuffled.slice(startIdx, endIdx);
                }
                
                bets.push({
                    numbers: betNumbers.sort((a, b) => a - b),
                    isRemainder: false,
                    isExtraRandom: false,
                    coreNumber: coreNum
                });
            }
            
            // 處理餘數（如果有）
            const remainingNumbers = shuffled.slice(fullBetCount * numbersPerBetFromPool);
            if (remainingNumbers.length > 0) {
                const currentCount = remainingNumbers.length + (coreNum !== null ? 1 : 0);
                const needCount = numbersPerBet - currentCount;
                
                // 從原始號碼池中隨機補足（可以與前面的注重複，排除核心號碼）
                let supplementNumbers = [];
                if (needCount > 0) {
                    const availableForSupplement = pool.filter(n => 
                        !remainingNumbers.includes(n) && n !== coreNum
                    );
                    supplementNumbers = getRandomNumbers(availableForSupplement, needCount);
                }
                
                let finalBet;
                if (coreNum !== null) {
                    finalBet = [coreNum, ...remainingNumbers, ...supplementNumbers];
                } else {
                    finalBet = [...remainingNumbers, ...supplementNumbers];
                }
                
                bets.push({
                    numbers: finalBet.sort((a, b) => a - b),
                    isRemainder: true,
                    remainderOriginal: currentCount,
                    isExtraRandom: false,
                    coreNumber: coreNum
                });
            }
            
            // 額外隨機注：從全部號碼池中完全隨機抽取（含核心號碼如有）
            let extraRandomBet;
            if (coreNum !== null) {
                // 從池中隨機抽取 numbersPerBet - 1 個，再加上核心號碼
                const poolWithoutCore = pool.filter(n => n !== coreNum);
                const randomPart = getRandomNumbers(poolWithoutCore, numbersPerBet - 1);
                extraRandomBet = [coreNum, ...randomPart];
            } else {
                extraRandomBet = getRandomNumbers(pool, numbersPerBet);
            }
            bets.push({
                numbers: extraRandomBet.sort((a, b) => a - b),
                isRemainder: false,
                isExtraRandom: true,
                coreNumber: coreNum
            });
            
            return bets;
        }

        // 重新隨機抽取號碼
        function refreshRandom6() {
            if (currentFilteredNumbers.length === 0) {
                alert('請先執行「篩選高頻號碼」！');
                return;
            }

            const random6Div = document.getElementById('random-6-numbers');
            const drawResultTitle = document.getElementById('draw-result-title');
            const drawMode = document.getElementById('draw-mode-select').value;
            
            let drawnNumbers = [];
            let displayHtml = '';
            let drawModeInfo = null;
            let bets = null; // 用於聰明組合
            
            if (drawMode === 'single') {
                // 單式：抽取6個號碼
                drawnNumbers = getRandom6(currentFilteredNumbers);
                drawResultTitle.textContent = '隨機抽取 6 個號碼：';
                displayHtml = drawnNumbers.map(num => 
                    `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
                ).join('');
                drawModeInfo = { mode: 'single' };
            } else if (drawMode === 'complex') {
                // 復式：抽取7-15個號碼
                const count = parseInt(document.getElementById('complex-count-select').value);
                drawnNumbers = getRandomNumbers(currentFilteredNumbers, count);
                drawResultTitle.textContent = `隨機抽取 ${count} 個號碼（復式）：`;
                displayHtml = drawnNumbers.map(num => 
                    `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
                ).join('');
                drawModeInfo = { mode: 'complex', count: count };
            } else if (drawMode === 'smart') {
                // 聰明組合：生成多注
                const hasCoreNumber = document.getElementById('smart-core-checkbox').checked;
                const coreNumber = getCurrentCoreNumber();
                const isRandomCore = document.getElementById('smart-core-number').value === 'random';
                
                bets = generateSmartBets(currentFilteredNumbers, hasCoreNumber, coreNumber);
                
                // 顯示標題，如果是隨機核心號碼則顯示當前選中的號碼
                let titleText = `聰明組合（共 ${bets.length} 注）`;
                if (hasCoreNumber && coreNumber && isRandomCore) {
                    titleText += ` 🎲膽=${coreNumber}`;
                }
                titleText += '：';
                drawResultTitle.textContent = titleText;
                
                displayHtml = '<div class="smart-bets-container">';
                bets.forEach((bet, index) => {
                    const rowClass = bet.isRemainder ? 'smart-bet-row has-remainder' : 'smart-bet-row';
                    const labelText = bet.isRemainder ? `第${index + 1}注 *` : `第${index + 1}注`;
                    
                    displayHtml += `<div class="${rowClass}">`;
                    displayHtml += `<span class="smart-bet-label">${labelText}</span>`;
                    displayHtml += '<div class="smart-bet-numbers">';
                    
                    bet.numbers.forEach(num => {
                        const ballClass = (bet.coreNumber !== null && num === bet.coreNumber) 
                            ? 'hf-ball hf-ball--md hf-ball--core' 
                            : 'hf-ball hf-ball--md hf-ball--secondary';
                        displayHtml += `<span class="${ballClass}">${num}</span>`;
                    });
                    
                    displayHtml += '</div>';
                    if (bet.isRemainder) {
                        displayHtml += `<span style="font-size: 0.75rem; color: #888;">(*含補充號碼)</span>`;
                    }
                    displayHtml += '</div>';
                });
                displayHtml += '</div>';
                
                // 對於聰明組合，drawnNumbers 保存所有不重複的號碼
                drawnNumbers = [...new Set(bets.flatMap(b => b.numbers))].sort((a, b) => a - b);
                drawModeInfo = { mode: 'smart', bets: bets, hasCoreNumber: hasCoreNumber, coreNumber: coreNumber };
            } else if (drawMode === 'smartComplex') {
                // 聰明組合+復式：生成多注（每注可選7-10個號碼）
                const numbersPerBet = parseInt(document.getElementById('smart-complex-count-select').value);
                const hasCoreNumber = document.getElementById('smart-core-checkbox').checked;
                const coreNumber = getCurrentCoreNumber();
                const isRandomCore = document.getElementById('smart-core-number').value === 'random';
                
                bets = generateSmartComplexBets(currentFilteredNumbers, numbersPerBet, hasCoreNumber, coreNumber);
                
                // 顯示標題，如果是隨機核心號碼則顯示當前選中的號碼
                let titleText = `聰明組合+復式（每注${numbersPerBet}個，共 ${bets.length} 注）`;
                if (hasCoreNumber && coreNumber && isRandomCore) {
                    titleText += ` 🎲膽=${coreNumber}`;
                }
                titleText += '：';
                drawResultTitle.textContent = titleText;
                
                displayHtml = '<div class="smart-bets-container">';
                bets.forEach((bet, index) => {
                    let rowClass = 'smart-bet-row';
                    let labelText = `第${index + 1}注`;
                    let noteText = '';
                    
                    if (bet.isExtraRandom) {
                        labelText += ' 🎲';
                        noteText = '<span style="font-size: 0.75rem; color: #888;">(隨機注)</span>';
                    } else if (bet.isRemainder) {
                        rowClass += ' has-remainder';
                        labelText += ' *';
                        noteText = `<span style="font-size: 0.75rem; color: #888;">(*餘${bet.remainderOriginal}+補${numbersPerBet - bet.remainderOriginal})</span>`;
                    }
                    
                    displayHtml += `<div class="${rowClass}">`;
                    displayHtml += `<span class="smart-bet-label">${labelText}</span>`;
                    displayHtml += '<div class="smart-bet-numbers">';
                    
                    bet.numbers.forEach(num => {
                        const ballClass = (bet.coreNumber !== null && num === bet.coreNumber) 
                            ? 'hf-ball hf-ball--md hf-ball--core' 
                            : 'hf-ball hf-ball--md hf-ball--secondary';
                        displayHtml += `<span class="${ballClass}">${num}</span>`;
                    });
                    
                    displayHtml += '</div>';
                    displayHtml += noteText;
                    displayHtml += '</div>';
                });
                displayHtml += '</div>';
                
                // 對於聰明組合+復式，drawnNumbers 保存所有不重複的號碼
                drawnNumbers = [...new Set(bets.flatMap(b => b.numbers))].sort((a, b) => a - b);
                drawModeInfo = { mode: 'smartComplex', bets: bets, numbersPerBet: numbersPerBet, hasCoreNumber: hasCoreNumber, coreNumber: coreNumber };
            } else if (drawMode === 'fiveBankerFullMeal') {
                // 5膽拖全餐：從高頻號碼中隨機選5個做膽，剩下的做腳
                if (currentFilteredNumbers.length < 6) {
                    drawResultTitle.textContent = '號碼不足（至少需要6個號碼）';
                    displayHtml = '<span class="hf-text--muted">篩選號碼不足，無法使用5膽拖全餐</span>';
                    drawModeInfo = { mode: 'fiveBankerFullMeal', error: 'insufficient' };
                } else {
                    // 隨機選5個膽
                    const bankers = getRandomNumbers(currentFilteredNumbers, 5);
                    // 剩下的作為腳
                    const runners = currentFilteredNumbers.filter(num => !bankers.includes(num));

                    // 生成注數：每注 = 5個膽 + 1個腳
                    bets = runners.map(runner => ({
                        numbers: [...bankers.sort((a, b) => a - b), runner],
                        bankers: bankers,
                        runner: runner
                    }));

                    console.log('5膽拖全餐(重抽) - 篩選號碼:', currentFilteredNumbers.length, currentFilteredNumbers);
                    console.log('5膽拖全餐(重抽) - 膽碼:', bankers.length, bankers);
                    console.log('5膽拖全餐(重抽) - 腳碼:', runners.length, runners);
                    console.log('5膽拖全餐(重抽) - 總注數:', bets.length);

                    drawResultTitle.textContent = `5膽拖全餐（共 ${bets.length} 注）：`;

                    // 顯示膽碼信息
                    displayHtml = '<div class="five-banker-info">';
                    displayHtml += '<div class="five-banker-title">🎯 膽碼（固定5個）：</div>';
                    displayHtml += '<div class="five-banker-numbers">';
                    bankers.forEach(num => {
                        displayHtml += `<span class="hf-ball hf-ball--md hf-ball--secondary">${num}</span>`;
                    });
                    displayHtml += '</div>';
                    displayHtml += `<div class="five-banker-stats">`;
                    displayHtml += `📊 篩選號碼: ${currentFilteredNumbers.length}個 | 膽: ${bankers.length}個 | 腳: ${runners.length}個 | 共 ${bets.length} 注<br>`;
                    displayHtml += `💰 每注成本：$10（全注）或 $5（半注） | 全注總成本：$${bets.length * 10} | 半注總成本：$${bets.length * 5}`;
                    displayHtml += `</div>`;
                    displayHtml += '</div>';

                    // 顯示所有注數
                    displayHtml += '<div class="five-banker-bets-container">';
                    bets.forEach((bet, index) => {
                        displayHtml += `<div class="five-banker-bet-row">`;
                        displayHtml += `<span class="five-banker-bet-label">第${index + 1}注</span>`;
                        displayHtml += '<div class="five-banker-bet-numbers">';

                        bet.numbers.forEach(num => {
                            displayHtml += `<span class="hf-ball hf-ball--md hf-ball--secondary">${num}</span>`;
                        });

                        displayHtml += '</div>';
                        displayHtml += '</div>';
                    });
                    displayHtml += '</div>';

                    // drawnNumbers 保存所有號碼（膽+腳）
                    drawnNumbers = currentFilteredNumbers;
                    drawModeInfo = {
                        mode: 'fiveBankerFullMeal',
                        bets: bets,
                        bankers: bankers,
                        runners: runners
                    };
                }
            }

            // 檢查是否勾選隨機注數
            const hasRandomBet = document.getElementById('random-bet-checkbox').checked;
            if (hasRandomBet) {
                // 從1-49中隨機抽取6個號碼
                const fullPool = Array.from({length: 49}, (_, i) => (i + 1).toString().padStart(2, '0'));
                const randomBetNumbers = getRandomNumbers(fullPool, 6);
                
                displayHtml += `
                    <div class="random-bet-section">
                        <div class="random-bet-title">
                            <span>🎰</span> 隨機注數（1-49全號池）
                        </div>
                        <div class="random-bet-numbers">
                            ${randomBetNumbers.map(num => 
                                `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
                
                // 將隨機注數信息添加到 drawModeInfo
                if (drawModeInfo) {
                    drawModeInfo.randomBet = randomBetNumbers;
                }
            }
            
            random6Div.innerHTML = displayHtml;
            
            // 取得當前的篩選參數（從最新的歷史記錄或當前顯示的資訊）
            if (filterHistory.length > 0) {
                const latestItem = filterHistory[0];
                // 添加新的隨機結果到歷史記錄
                addToFilterHistory(
                    latestItem.startPeriod, 
                    latestItem.endPeriod, 
                    latestItem.maxFrequency, 
                    latestItem.threshold, 
                    currentFilteredNumbers, 
                    drawnNumbers,
                    'default',
                    drawModeInfo
                );
            }
        }

        // 添加到歷史記錄
        function addToFilterHistory(startPeriod, endPeriod, maxFrequency, threshold, filteredNumbers, random6, filterMode = 'default', drawModeInfo = null) {
            const timestamp = new Date().toLocaleString('zh-TW', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            
            const historyItem = {
                timestamp,
                startPeriod,
                endPeriod,
                maxFrequency,
                threshold,
                filteredNumbers: [...filteredNumbers],
                random6: [...random6],
                drawModeInfo: drawModeInfo // 包含抽號模式和多注數據
            };
            
            // 添加到歷史記錄陣列（最新的在前面）
            filterHistory.unshift(historyItem);
            
            // 限制歷史記錄數量（最多保留 20 筆）
            if (filterHistory.length > 20) {
                filterHistory = filterHistory.slice(0, 20);
            }
            
            // 更新歷史記錄顯示
            updateFilterHistoryDisplay();
        }

        // 更新歷史記錄顯示
        function updateFilterHistoryDisplay() {
            const historyDiv = document.getElementById('filter-history');
            
            if (filterHistory.length === 0) {
                historyDiv.innerHTML = '<p class="hf-empty">尚無篩選記錄</p>';
                updateHistoricalHighFrequencyNumbers(); // 更新歷史高頻號碼
                return;
            }
            
            let html = '';
            filterHistory.forEach((item, index) => {
                // 獲取上一期的中獎號碼（如果存在）
                let previousPeriodRegularNumbers = new Set();
                let previousPeriodExtraNumber = null;
                if (item.startPeriod > 1) {
                    const previousPeriodIndex = item.startPeriod - 2;
                    if (previousPeriodIndex >= 0 && previousPeriodIndex < lotteryData.length) {
                        const previousPeriodData = lotteryData[previousPeriodIndex];
                        previousPeriodData.numbers.forEach(num => previousPeriodRegularNumbers.add(num));
                        previousPeriodExtraNumber = previousPeriodData.extra_number;
                    }
                }
                
                // 生成號碼顯示（根據抽號模式）
                let randomNumbersHtml = '';
                let modeLabel = '隨機 6 碼：';
                
                if (item.drawModeInfo && item.drawModeInfo.mode === 'smart' && item.drawModeInfo.bets) {
                    // 聰明組合：顯示多注
                    modeLabel = `聰明組合（${item.drawModeInfo.bets.length} 注）：`;
                    randomNumbersHtml = '<div class="hf-history-smart-bets">';
                    item.drawModeInfo.bets.forEach((bet, betIndex) => {
                        const rowClass = bet.isRemainder ? 'hf-history-bet-row hf-history-bet-row--remainder' : 'hf-history-bet-row';
                        randomNumbersHtml += `<div class="${rowClass}">`;
                        randomNumbersHtml += `<span class="hf-history-bet-label">第${betIndex + 1}注${bet.isRemainder ? '*' : ''}</span>`;
                        
                        bet.numbers.forEach(num => {
                            const isRegularMatched = previousPeriodRegularNumbers.has(num);
                            const isExtraMatched = (previousPeriodExtraNumber !== null && num === previousPeriodExtraNumber);
                            const isCoreNumber = (bet.coreNumber !== null && num === bet.coreNumber);
                            
                            let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary';
                            if (isCoreNumber) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--core';
                            } else if (isExtraMatched) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight';
                            } else if (isRegularMatched) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight';
                            }
                            
                            randomNumbersHtml += `<span class="${ballClass}">${num}</span>`;
                        });
                        
                        randomNumbersHtml += '</div>';
                    });
                    randomNumbersHtml += '</div>';
                } else if (item.drawModeInfo && item.drawModeInfo.mode === 'smartComplex' && item.drawModeInfo.bets) {
                    // 聰明組合+復式：顯示多注
                    const numbersPerBet = item.drawModeInfo.numbersPerBet || 7;
                    modeLabel = `聰明組合+復式（每注${numbersPerBet}個，${item.drawModeInfo.bets.length} 注）：`;
                    randomNumbersHtml = '<div class="hf-history-smart-bets">';
                    item.drawModeInfo.bets.forEach((bet, betIndex) => {
                        let rowClass = 'hf-history-bet-row';
                        let labelSuffix = '';
                        
                        if (bet.isExtraRandom) {
                            labelSuffix = ' 🎲';
                        } else if (bet.isRemainder) {
                            rowClass += ' hf-history-bet-row--remainder';
                            labelSuffix = '*';
                        }
                        
                        randomNumbersHtml += `<div class="${rowClass}">`;
                        randomNumbersHtml += `<span class="hf-history-bet-label">第${betIndex + 1}注${labelSuffix}</span>`;
                        
                        bet.numbers.forEach(num => {
                            const isRegularMatched = previousPeriodRegularNumbers.has(num);
                            const isExtraMatched = (previousPeriodExtraNumber !== null && num === previousPeriodExtraNumber);
                            const isCoreNumber = (bet.coreNumber !== null && num === bet.coreNumber);
                            
                            let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary';
                            if (isCoreNumber) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--core';
                            } else if (isExtraMatched) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight';
                            } else if (isRegularMatched) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight';
                            }
                            
                            randomNumbersHtml += `<span class="${ballClass}">${num}</span>`;
                        });
                        
                        randomNumbersHtml += '</div>';
                    });
                    randomNumbersHtml += '</div>';
                } else if (item.drawModeInfo && item.drawModeInfo.mode === 'fiveBankerFullMeal' && item.drawModeInfo.bets) {
                    // 5膽拖全餐：顯示膽碼和多注
                    const bankers = item.drawModeInfo.bankers || [];
                    modeLabel = `5膽拖全餐（${item.drawModeInfo.bets.length} 注）：`;

                    randomNumbersHtml = '<div class="hf-history-five-banker">';
                    // 顯示膽碼
                    randomNumbersHtml += '<div style="margin-bottom: 8px;">';
                    randomNumbersHtml += '<strong style="color: #495057; font-size: 0.85rem;">🎯 膽碼：</strong>';
                    bankers.forEach(num => {
                        const isRegularMatched = previousPeriodRegularNumbers.has(num);
                        const isExtraMatched = (previousPeriodExtraNumber !== null && num === previousPeriodExtraNumber);

                        let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary';
                        if (isExtraMatched) {
                            ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight';
                        } else if (isRegularMatched) {
                            ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight';
                        }

                        randomNumbersHtml += `<span class="${ballClass}">${num}</span>`;
                    });
                    randomNumbersHtml += '</div>';

                    // 顯示所有注數（不限制高度，顯示全部）
                    randomNumbersHtml += '<div class="hf-history-smart-bets">';
                    item.drawModeInfo.bets.forEach((bet, betIndex) => {
                        randomNumbersHtml += `<div class="hf-history-bet-row">`;
                        randomNumbersHtml += `<span class="hf-history-bet-label">第${betIndex + 1}注</span>`;

                        bet.numbers.forEach(num => {
                            const isRegularMatched = previousPeriodRegularNumbers.has(num);
                            const isExtraMatched = (previousPeriodExtraNumber !== null && num === previousPeriodExtraNumber);

                            let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary';
                            if (isExtraMatched) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight';
                            } else if (isRegularMatched) {
                                ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight';
                            }

                            randomNumbersHtml += `<span class="${ballClass}">${num}</span>`;
                        });

                        randomNumbersHtml += '</div>';
                    });
                    randomNumbersHtml += '</div>';
                    randomNumbersHtml += '</div>';
                } else if (item.drawModeInfo && item.drawModeInfo.mode === 'complex') {
                    // 復式：顯示號碼數量
                    const count = item.random6.length;
                    modeLabel = `復式 ${count} 碼：`;
                    randomNumbersHtml = item.random6.map(num => {
                        const isRegularMatched = previousPeriodRegularNumbers.has(num);
                        const isExtraMatched = (previousPeriodExtraNumber !== null && num === previousPeriodExtraNumber);

                        let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary';
                        if (isExtraMatched) {
                            ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight';
                        } else if (isRegularMatched) {
                            ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight';
                        }

                        return `<span class="${ballClass}">${num}</span>`;
                    }).join('');
                } else {
                    // 單式或舊格式
                    randomNumbersHtml = item.random6.map(num => {
                        const isRegularMatched = previousPeriodRegularNumbers.has(num);
                        const isExtraMatched = (previousPeriodExtraNumber !== null && num === previousPeriodExtraNumber);

                        let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary';
                        if (isExtraMatched) {
                            ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight';
                        } else if (isRegularMatched) {
                            ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight';
                        }

                        return `<span class="${ballClass}">${num}</span>`;
                    }).join('');
                }
                
                // 處理隨機注數
                let randomBetHtml = '';
                if (item.drawModeInfo && item.drawModeInfo.randomBet && item.drawModeInfo.randomBet.length > 0) {
                    randomBetHtml = `
                        <div class="hf-history-random-bet">
                            <strong class="hf-history-random-label hf-history-random-label--green">🎰 隨機注數：</strong>
                            ${item.drawModeInfo.randomBet.map(num => {
                                // 將字符串號碼轉換為數字進行比對（lotteryData中的號碼是數字類型）
                                const numAsInt = parseInt(num, 10);
                                const isRegularMatched = previousPeriodRegularNumbers.has(numAsInt);
                                const isExtraMatched = (previousPeriodExtraNumber !== null && numAsInt === previousPeriodExtraNumber);
                                
                                // 使用與其他注數相同的顏色邏輯
                                let ballClass = 'hf-ball hf-ball--sm hf-ball--secondary'; // 沒中：紫色
                                if (isExtraMatched) {
                                    ballClass = 'hf-ball hf-ball--sm hf-ball--orange hf-ball--highlight'; // 中特別號碼：橙色
                                } else if (isRegularMatched) {
                                    ballClass = 'hf-ball hf-ball--sm hf-ball--primary hf-ball--highlight'; // 中正式號碼：藍紫色
                                }
                                
                                return `<span class="${ballClass}">${num}</span>`;
                            }).join('')}
                        </div>
                    `;
                }
                
                html += `
                    <div class="hf-history-card ${index === 0 ? 'hf-history-card--active' : ''}">
                        <div class="hf-history-header">
                            <span class="hf-history-time">🕐 ${item.timestamp}</span>
                            <div class="hf-history-actions">
                                <button onclick="loadHistoryItem(${index})" class="hf-history-btn hf-history-btn--load">載入</button>
                                <button onclick="removeHistoryItem(${index})" class="hf-history-btn hf-history-btn--remove">移除</button>
                            </div>
                        </div>
                        <div class="hf-history-meta">
                            期數：第 ${item.startPeriod} ~ ${item.endPeriod} 期 | 門檻：${item.threshold} 次
                        </div>
                        <div class="hf-history-random">
                            <strong class="hf-history-random-label">${modeLabel}</strong>
                            ${randomNumbersHtml}
                        </div>
                        ${randomBetHtml}
                        <div class="hf-history-count">
                            符合條件：${item.filteredNumbers.length} 個號碼
                        </div>
                    </div>
                `;
            });
            
            historyDiv.innerHTML = html;
            
            // 更新歷史高頻號碼
            updateHistoricalHighFrequencyNumbers();
        }
        
        // 計算並更新歷史高頻號碼
        function updateHistoricalHighFrequencyNumbers() {
            const displayDiv = document.getElementById('historical-high-frequency');
            
            if (filterHistory.length === 0) {
                displayDiv.innerHTML = '<p class="hf-empty--inline">尚無歷史數據</p>';
                return;
            }
            
            // 統計所有歷史記錄中隨機6碼的號碼出現次數
            const numberFrequency = {};
            
            filterHistory.forEach(item => {
                item.random6.forEach(num => {
                    numberFrequency[num] = (numberFrequency[num] || 0) + 1;
                });
            });
            
            // 轉換為陣列並按頻率排序
            let sortedNumbers = Object.entries(numberFrequency)
                .map(([num, freq]) => ({
                    number: parseInt(num),
                    frequency: freq
                }))
                .sort((a, b) => {
                    // 如果頻率相同，需要根據當前期數範圍的統計排名來決定
                    if (b.frequency === a.frequency) {
                        return sortByGlobalRank(a.number, b.number);
                    }
                    return b.frequency - a.frequency;
                });
            
            // 取前6個不同的號碼
            const top6Numbers = sortedNumbers.slice(0, 6);
            
            if (top6Numbers.length === 0) {
                displayDiv.innerHTML = '<p class="hf-empty--inline">尚無數據</p>';
                return;
            }
            
            // 顯示高頻號碼
            let html = '';
            const gradientClasses = [
                'hf-ball--gradient-1',
                'hf-ball--gradient-2',
                'hf-ball--gradient-3',
                'hf-ball--gradient-4',
                'hf-ball--gradient-5',
                'hf-ball--gradient-6'
            ];
            top6Numbers.forEach((item, colorIndex) => {
                const gradientClass = gradientClasses[colorIndex] || gradientClasses[5];
                
                html += `
                    <div class="hf-top-item">
                        <span class="hf-ball hf-ball--xl ${gradientClass}">${item.number}</span>
                        <span class="hf-top-freq">${item.frequency}次</span>
                    </div>
                `;
            });
            
            displayDiv.innerHTML = html;
        }
        
        // 根據全局統計排名來排序（當頻率相同時使用）
        function sortByGlobalRank(num1, num2) {
            // 取得當前選擇的期數範圍
            const startPeriod = parseInt(document.getElementById('start-period').value) || 1;
            const endPeriod = parseInt(document.getElementById('end-period').value) || lotteryData.length;
            
            // 計算該範圍內的號碼頻率
            const numberFreq = {};
            for (let i = 1; i <= 49; i++) {
                numberFreq[i] = 0;
            }
            
            const startIndex = startPeriod - 1;
            const endIndex = endPeriod;
            const selectedData = lotteryData.slice(startIndex, endIndex);
            
            selectedData.forEach(row => {
                row.numbers.forEach(num => {
                    numberFreq[num]++;
                });
                numberFreq[row.extra_number]++;
            });
            
            // 比較兩個號碼的頻率
            const freq1 = numberFreq[num1] || 0;
            const freq2 = numberFreq[num2] || 0;
            
            if (freq2 !== freq1) {
                return freq2 - freq1; // 頻率高的排前面
            }
            
            // 如果頻率也相同，按號碼大小排序
            return num1 - num2;
        }

        // 載入歷史記錄項目
        function loadHistoryItem(index) {
            const item = filterHistory[index];
            if (!item) return;
            
            // 更新當前篩選結果
            currentFilteredNumbers = [...item.filteredNumbers];
            
            // 顯示結果區域
            const resultDiv = document.getElementById('high-frequency-result');
            resultDiv.style.display = 'block';
            
            // 更新篩選條件（包含篩選出數字的數量）
            const thresholdInfo = document.getElementById('filter-threshold-info');
            thresholdInfo.textContent = `期數範圍：第 ${item.startPeriod} 期 ~ 第 ${item.endPeriod} 期（共 ${item.endPeriod - item.startPeriod + 1} 期）｜最高出現次數：${item.maxFrequency} 次｜門檻值：${item.threshold} 次｜篩選出 ${item.filteredNumbers.length} 個號碼`;
            
            // 更新篩選出數字的數量
            const filteredNumbersCountDiv = document.getElementById('filtered-numbers-count');
            filteredNumbersCountDiv.textContent = `（共 ${item.filteredNumbers.length} 個）`;
            
            // 顯示上一期的號碼
            const previousPeriodNumbersDiv = document.getElementById('previous-period-numbers');
            const probabilityInfoDiv = document.getElementById('probability-info');
            if (item.startPeriod === 1) {
                // 第1期沒有上一期
                previousPeriodNumbersDiv.innerHTML = '<span class="hf-text--muted">無上一期</span>';
                probabilityInfoDiv.innerHTML = '';
            } else {
                // 獲取上一期的數據（startPeriod - 1 對應 lotteryData 的索引是 startPeriod - 2）
                const previousPeriodIndex = item.startPeriod - 2;
                if (previousPeriodIndex >= 0 && previousPeriodIndex < lotteryData.length) {
                    const previousPeriodData = lotteryData[previousPeriodIndex];
                    const previousPeriodNumber = previousPeriodIndex + 1; // 期數從1開始
                    const regularNumbers = [...previousPeriodData.numbers].sort((a, b) => a - b);
                    const extraNumber = previousPeriodData.extra_number;
                    
                    // 創建一個 Set 來快速檢查號碼是否在篩選結果中
                    const filteredNumbersSet = new Set(item.filteredNumbers);
                    
                    // 計算符合條件的號碼
                    const matchedRegularNumbers = regularNumbers.filter(num => filteredNumbersSet.has(num));
                    const isExtraMatched = filteredNumbersSet.has(extraNumber);
                    const totalMatched = matchedRegularNumbers.length + (isExtraMatched ? 0.5 : 0);
                    
                    // 顯示普通號碼（用逗號分隔）
                    const regularNumbersHtml = regularNumbers.map(num => {
                        const isMatched = filteredNumbersSet.has(num);
                        const ballClass = isMatched ? 'hf-ball hf-ball--md hf-ball--primary-glow' : 'hf-ball hf-ball--md hf-ball--success';
                        return `<span class="${ballClass}">${num}</span>`;
                    }).join('');
                    
                    // 顯示特別號碼（用 + 號連接）- 使用橙色系區分
                    const extraBallClass = isExtraMatched ? 'hf-ball hf-ball--md hf-ball--warning-glow' : 'hf-ball hf-ball--md hf-ball--warning';
                    const extraNumberHtml = `<span class="hf-separator">+</span><span class="${extraBallClass}">${extraNumber}</span>`;
                    
                    previousPeriodNumbersDiv.innerHTML = `第 ${previousPeriodNumber} 期：` + regularNumbersHtml + extraNumberHtml;
                    
                    // 計算並顯示概率
                    if (totalMatched > 0 && item.filteredNumbers.length > 0) {
                        const probResult = calculatePreviousPeriodProbability(previousPeriodData, item.filteredNumbers, item.filteredNumbers.length);
                        if (probResult) {
                            const matchedDesc = `${matchedRegularNumbers.join(',')}${isExtraMatched ? '+' + extraNumber : ''}`;
                            
                            // 計算篩選號碼中缺少的攪出號碼
                            const missingRegularNumbers = regularNumbers.filter(num => !filteredNumbersSet.has(num));
                            const missingCount = missingRegularNumbers.length;
                            
                            // 判斷從篩選號碼中選是否更容易
                            const isFilteredEasier = probResult.probFromFiltered > probResult.probFrom49;
                            
                            // 計算100注的概率（至少中一注的概率）
                            const prob100 = 1 - Math.pow(1 - probResult.probFromFiltered, 100);
                            
                            let probInfoHtml = `
                                <div class="hf-prob-item">
                                    <strong>中獎號碼：</strong>${matchedDesc}（共 ${totalMatched} 個）
                                </div>
                                <div class="hf-prob-item">
                                    <strong>從 ${item.filteredNumbers.length} 個中選 6 個，中到符合中獎的概率：</strong>
                                    <span class="${isFilteredEasier ? 'hf-text--success' : 'hf-text--danger'}">${(probResult.probFromFiltered * 100).toFixed(6)}%</span>
                                    <span class="hf-text--secondary">(1/${Math.round(1 / probResult.probFromFiltered).toLocaleString()}次)</span>
                                </div>
                                <div class="hf-prob-item">
                                    <strong>從 49 個中選 6 個，中到符合中獎的概率：</strong>
                                    <span class="${!isFilteredEasier ? 'hf-text--success' : 'hf-text--danger'}">${(probResult.probFrom49 * 100).toFixed(6)}%</span>
                                    <span class="hf-text--secondary">(1/${Math.round(1 / probResult.probFrom49).toLocaleString()}次)</span>
                                </div>
                                <div class="hf-prob-box">
                                    <div class="hf-prob-title"><strong>📊 計算說明：</strong></div>
                                    <div class="hf-prob-text"><strong>從 ${item.filteredNumbers.length} 個中選 6 個：</strong></div>
                                    <div class="hf-prob-indent">• 恰好包含 ${matchedRegularNumbers.length} 個特定號碼（${matchedRegularNumbers.join(',')}）${isExtraMatched ? ` + 特別號碼${extraNumber}` : ''}</div>
                                    ${missingCount > 0 ? `<div class="hf-prob-indent hf-text--danger">• ⚠️ 缺少攪出號碼：${missingRegularNumbers.join(',')}（共${missingCount}個不在篩選號碼中）</div>` : ''}
                                    ${isExtraMatched ? `
                                        <div class="hf-prob-indent">• 公式：C(${matchedRegularNumbers.length}, ${matchedRegularNumbers.length}) × C(${item.filteredNumbers.length - matchedRegularNumbers.length - 1}, ${5 - matchedRegularNumbers.length}) / C(${item.filteredNumbers.length}, 6)</div>
                                        <div class="hf-prob-indent">• 說明：從${matchedRegularNumbers.length}個在池中的攪出號碼中選${matchedRegularNumbers.length}個，從剩餘${item.filteredNumbers.length - matchedRegularNumbers.length - 1}個中選${5 - matchedRegularNumbers.length}個</div>
                                    ` : `
                                        <div class="hf-prob-indent">• 公式：C(${matchedRegularNumbers.length}, ${matchedRegularNumbers.length}) × C(${item.filteredNumbers.length - matchedRegularNumbers.length}, ${6 - matchedRegularNumbers.length}) / C(${item.filteredNumbers.length}, 6)</div>
                                        <div class="hf-prob-indent">• 說明：從${matchedRegularNumbers.length}個在池中的攪出號碼中選${matchedRegularNumbers.length}個，從剩餘${item.filteredNumbers.length - matchedRegularNumbers.length}個中選${6 - matchedRegularNumbers.length}個</div>
                                    `}
                                    <div class="hf-prob-section"><strong>從 49 個中選 6 個：</strong></div>
                                    <div class="hf-prob-indent">• 恰好中 ${matchedRegularNumbers.length} 個攪出號碼${isExtraMatched ? ` + 特別號碼` : ''}（可從6個攪出號碼中任選${matchedRegularNumbers.length}個）</div>
                                    ${isExtraMatched ? `
                                        <div class="hf-prob-indent">• 公式：C(6, ${matchedRegularNumbers.length}) × C(42, ${5 - matchedRegularNumbers.length}) / C(49, 6)</div>
                                        <div class="hf-prob-indent">• 說明：有 C(6,${matchedRegularNumbers.length})=${combination(6, matchedRegularNumbers.length)} 種方式選${matchedRegularNumbers.length}個攪出號碼，從42個其他號碼中選${5 - matchedRegularNumbers.length}個</div>
                                    ` : `
                                        <div class="hf-prob-indent">• 公式：C(6, ${matchedRegularNumbers.length}) × C(42, ${6 - matchedRegularNumbers.length}) / C(49, 6)</div>
                                        <div class="hf-prob-indent">• 說明：有 C(6,${matchedRegularNumbers.length})=${combination(6, matchedRegularNumbers.length)} 種方式選${matchedRegularNumbers.length}個攪出號碼，從42個其他號碼中選${6 - matchedRegularNumbers.length}個</div>
                                    `}
                                    ${isFilteredEasier ? `
                                        <div class="hf-prob-divider hf-text--success">
                                            <strong>💡 為什麼從 ${item.filteredNumbers.length} 個中選的概率更高？</strong><br>
                                            因為篩選號碼池較小，選中特定號碼的機率更高。<br>
                                            篩選號碼中包含了全部${matchedRegularNumbers.length + (isExtraMatched ? 1 : 0)}個中獎號碼。
                                        </div>
                                    ` : `
                                        <div class="hf-prob-divider hf-text--danger">
                                            <strong>⚠️ 為什麼從 ${item.filteredNumbers.length} 個中選的概率反而更低？</strong><br>
                                            因為篩選號碼中缺少 ${missingCount} 個攪出號碼（${missingRegularNumbers.join(',')}）！<br>
                                            從49個中選：有 C(6,${matchedRegularNumbers.length})=${combination(6, matchedRegularNumbers.length)} 種方式中${matchedRegularNumbers.length}個攪出號碼<br>
                                            從${item.filteredNumbers.length}個中選：只有 C(${matchedRegularNumbers.length},${matchedRegularNumbers.length})=1 種方式（因為池中只有這${matchedRegularNumbers.length}個攪出號碼）
                                        </div>
                                    `}
                                    <div class="hf-prob-divider">
                                        <strong>💡 100注說明：</strong><br>
                                        買100注（每注都是從${item.filteredNumbers.length}個中隨機選6個），<br>
                                        <strong>至少中一注的概率：${(prob100 * 100).toFixed(2)}%</strong><br>
                                        <span class="hf-text--small">（不是簡單的 ${(probResult.probFromFiltered * 100).toFixed(6)}% × 100）</span>
                                    </div>
                                </div>
                            `;
                            probabilityInfoDiv.innerHTML = probInfoHtml;
                        } else {
                            probabilityInfoDiv.innerHTML = '';
                        }
                    } else {
                        probabilityInfoDiv.innerHTML = '<span class="hf-text--muted">無符合中獎號碼</span>';
                    }
                } else {
                    previousPeriodNumbersDiv.innerHTML = '<span class="hf-text--muted">無法獲取上一期數據</span>';
                    probabilityInfoDiv.innerHTML = '';
                }
            }
            
            // 更新符合條件的號碼
            const filteredNumbersDiv = document.getElementById('filtered-numbers');
            filteredNumbersDiv.innerHTML = item.filteredNumbers.map(num => 
                `<span class="hf-ball hf-ball--md hf-ball--primary">${num}</span>`
            ).join('');
            
            // 更新隨機 6 個號碼
            const random6Div = document.getElementById('random-6-numbers');
            random6Div.innerHTML = item.random6.map(num => 
                `<span class="hf-ball hf-ball--lg hf-ball--secondary">${num}</span>`
            ).join('');
            
            // 滾動到結果區域
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 移除單筆歷史記錄
        function removeHistoryItem(index) {
            if (index < 0 || index >= filterHistory.length) {
                alert('無效的記錄索引！');
                return;
            }
            
            if (confirm('確定要移除這筆篩選歷史記錄嗎？')) {
                filterHistory.splice(index, 1);
                updateFilterHistoryDisplay();
            }
        }

        // 清除歷史記錄
        function clearFilterHistory() {
            if (filterHistory.length === 0) {
                alert('目前沒有歷史記錄！');
                return;
            }
            
            if (confirm('確定要清除所有篩選歷史記錄嗎？')) {
                filterHistory = [];
                updateFilterHistoryDisplay();
            }
        }

        // ========================================
        // 江恩螺旋四方圖功能
        // ========================================

        // 生成螺旋矩陣（從中心向外順時針旋轉：右→下→左→上）
        function generateSpiralMatrix(size) {
            const matrix = Array.from({ length: size }, () => Array(size).fill(0));
            
            // 從中心開始
            const center = Math.floor(size / 2);
            let row = center;
            let col = center;
            let num = 1;
            
            matrix[row][col] = num++;
            
            // 螺旋方向：右(0)→下(1)→左(2)→上(3)
            // 方向向量：[行變化, 列變化]
            const directions = [
                [0, 1],   // 右
                [1, 0],   // 下
                [0, -1],  // 左
                [-1, 0]   // 上
            ];
            
            let steps = 1; // 當前方向需要走的步數
            let dirIndex = 0; // 當前方向索引
            
            while (num <= size * size) {
                // 每個方向走兩次後，步數增加
                for (let i = 0; i < 2; i++) {
                    const [dr, dc] = directions[dirIndex];
                    
                    for (let step = 0; step < steps; step++) {
                        row += dr;
                        col += dc;
                        
                        if (row >= 0 && row < size && col >= 0 && col < size) {
                            matrix[row][col] = num++;
                        }
                        
                        if (num > size * size) break;
                    }
                    
                    if (num > size * size) break;
                    
                    // 切換到下一個方向
                    dirIndex = (dirIndex + 1) % 4;
                }
                
                // 每完成兩個方向，步數增加
                steps++;
            }
            
            return matrix;
        }

        // 初始化江恩螺旋四方圖
        function initializeGannSquare() {
            const gridContainer = document.getElementById('gann-square-grid');
            const periodSelect = document.getElementById('gann-period-select');
            
            // 生成7x7螺旋矩陣
            const matrix = generateSpiralMatrix(7);
            
            // 創建網格HTML
            let html = '<div class="gann-grid">';
            
            for (let i = 0; i < 7; i++) {
                for (let j = 0; j < 7; j++) {
                    const number = matrix[i][j];
                    
                    // 格式化數字為兩位數
                    const displayNumber = number.toString().padStart(2, '0');
                    
                    html += `
                        <div class="gann-cell" data-number="${number}" title="號碼: ${displayNumber}">
                            ${displayNumber}
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            gridContainer.innerHTML = html;
            
            // 初始化期數選擇器
            initializeGannPeriodSelect();
        }

        // 初始化期數選擇器
        function initializeGannPeriodSelect() {
            const periodSelect = document.getElementById('gann-period-select');
            
            if (!periodSelect || !lotteryData || lotteryData.length === 0) return;
            
            // 清空現有選項（保留第一個預設選項）
            periodSelect.innerHTML = '<option value="">請選擇期數</option>';
            
            // 取最近100期（或全部，如果少於100期）
            const periodsToShow = Math.min(100, lotteryData.length);
            
            for (let i = 0; i < periodsToShow; i++) {
                const data = lotteryData[i];
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `第 ${data.draw_number} 期 - ${data.draw_date}`;
                periodSelect.appendChild(option);
            }
        }

        // 獲取數字在螺旋矩陣中的位置
        function getNumberPosition(number) {
            const matrix = generateSpiralMatrix(7);
            for (let i = 0; i < 7; i++) {
                for (let j = 0; j < 7; j++) {
                    if (matrix[i][j] === number) {
                        return { row: i, col: j };
                    }
                }
            }
            return null;
        }

        // 檢查上一期的橫行或直行連續2個以上數字
        function getConsecutiveRowColNumbers(previousNumbers) {
            const consecutiveNumbers = new Set();
            
            // 獲取所有數字的位置（包含數字本身）
            const numberPositions = [];
            previousNumbers.forEach(num => {
                const pos = getNumberPosition(num);
                if (pos !== null) {
                    numberPositions.push({ num, row: pos.row, col: pos.col });
                }
            });
            
            // 按行分組
            const rowGroups = {};
            numberPositions.forEach(item => {
                if (!rowGroups[item.row]) {
                    rowGroups[item.row] = [];
                }
                rowGroups[item.row].push(item);
            });
            
            // 檢查每行是否有連續2個以上數字（相鄰或接近）
            Object.keys(rowGroups).forEach(row => {
                const rowNums = rowGroups[row].sort((a, b) => a.col - b.col);
                if (rowNums.length >= 2) {
                    // 檢查是否在同一行且連續或接近（列差<=1）
                    for (let i = 0; i < rowNums.length - 1; i++) {
                        if (Math.abs(rowNums[i].col - rowNums[i + 1].col) <= 1) {
                            consecutiveNumbers.add(rowNums[i].num);
                            consecutiveNumbers.add(rowNums[i + 1].num);
                        }
                    }
                }
            });
            
            // 按列分組
            const colGroups = {};
            numberPositions.forEach(item => {
                if (!colGroups[item.col]) {
                    colGroups[item.col] = [];
                }
                colGroups[item.col].push(item);
            });
            
            // 檢查每列是否有連續2個以上數字（相鄰或接近）
            Object.keys(colGroups).forEach(col => {
                const colNums = colGroups[col].sort((a, b) => a.row - b.row);
                if (colNums.length >= 2) {
                    // 檢查是否在同一列且連續或接近（行差<=1）
                    for (let i = 0; i < colNums.length - 1; i++) {
                        if (Math.abs(colNums[i].row - colNums[i + 1].row) <= 1) {
                            consecutiveNumbers.add(colNums[i].num);
                            consecutiveNumbers.add(colNums[i + 1].num);
                        }
                    }
                }
            });
            
            return Array.from(consecutiveNumbers);
        }

        // 更新江恩圖高亮顯示
        function updateGannSquareHighlight() {
            const periodSelect = document.getElementById('gann-period-select');
            const selectedInfo = document.getElementById('gann-selected-info');
            const selectedNumbersDiv = document.getElementById('gann-selected-numbers');
            
            // 移除所有現有的高亮和樣式
            document.querySelectorAll('.gann-cell').forEach(cell => {
                cell.classList.remove('highlight', 'previous-period', 'consecutive-row-col');
                cell.style.color = '';
                cell.style.background = '';
            });
            
            const selectedIndex = periodSelect.value;
            
            if (selectedIndex === '') {
                // 未選擇期數，隱藏資訊區
                selectedInfo.style.display = 'none';
                return;
            }
            
            // 獲取選中期數的開獎數據
            const drawData = lotteryData[parseInt(selectedIndex)];
            
            if (!drawData) return;
            
            // 獲取該期的所有號碼（包含特別號）
            const currentNumbers = [...drawData.numbers, drawData.extra_number];
            
            // 獲取上一期的數據（如果存在）
            let previousNumbers = [];
            let consecutiveNumbers = [];
            const previousIndex = parseInt(selectedIndex) + 1;
            if (previousIndex < lotteryData.length) {
                const previousData = lotteryData[previousIndex];
                previousNumbers = [...previousData.numbers, previousData.extra_number];
                consecutiveNumbers = getConsecutiveRowColNumbers(previousNumbers);
            }
            
            // 定義顏色方案 - 設計明顯對比色
            // 顏色1：當期數字 - 使用亮綠色/青色，在深色背景上非常明顯
            const color1Bg = 'linear-gradient(135deg, #00d4ff 0%, #00ff88 100%)';
            // 顏色2：上一期數字 - 使用亮橙色/黃色，與當期區分
            const color2Bg = 'linear-gradient(135deg, #ff9500 0%, #ffcc00 100%)';
            // 顏色3：上一期的橫行或直行連續2個以上數字 - 使用鮮明的紅色/粉紅色背景
            const color3Bg = 'linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%)';
            
            // 先處理上一期的橫行或直行連續2個以上數字（顏色3：背景顏色）- 優先級最高
            consecutiveNumbers.forEach(num => {
                const cell = document.querySelector(`.gann-cell[data-number="${num}"]`);
                if (cell) {
                    cell.style.background = color3Bg;
                    cell.style.color = 'white';
                    cell.style.fontWeight = 'bold';
                    cell.style.boxShadow = '0 0 10px rgba(255, 65, 108, 0.8)';
                    cell.classList.add('consecutive-row-col');
                }
            });
            
            // 高亮顯示上一期號碼（顏色2：背景顏色）- 如果不在連續數字中
            previousNumbers.forEach(num => {
                const cell = document.querySelector(`.gann-cell[data-number="${num}"]`);
                if (cell && !currentNumbers.includes(num) && !consecutiveNumbers.includes(num)) {
                    // 如果該號碼不在當期中且不在連續數字中，才應用上一期樣式
                    cell.style.background = color2Bg;
                    cell.style.color = '#333';
                    cell.style.fontWeight = 'bold';
                    cell.style.boxShadow = '0 0 8px rgba(255, 149, 0, 0.6)';
                    cell.classList.add('previous-period');
                }
            });
            
            // 高亮顯示當期號碼（顏色1：背景顏色）- 最後處理，優先顯示當期
            currentNumbers.forEach(num => {
                const cell = document.querySelector(`.gann-cell[data-number="${num}"]`);
                if (cell) {
                    // 當期號碼覆蓋上一期樣式
                    cell.style.background = color1Bg;
                    cell.style.color = '#333';
                    cell.style.fontWeight = 'bold';
                    cell.style.boxShadow = '0 0 10px rgba(0, 212, 255, 0.8)';
                    cell.classList.remove('previous-period', 'consecutive-row-col');
                }
            });
            
            // 顯示開獎號碼資訊
            selectedInfo.style.display = 'block';
            
            // 顯示號碼球
            let numbersHtml = '';
            drawData.numbers.forEach(num => {
                numbersHtml += `<span class="gann-ball gann-ball--regular">${num}</span>`;
            });
            numbersHtml += `<span class="gann-ball gann-ball--extra">${drawData.extra_number}</span>`;
            
            selectedNumbersDiv.innerHTML = numbersHtml;
        }

    </script>
</body>
</html> 